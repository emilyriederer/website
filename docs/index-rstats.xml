<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Emily Riederer</title>
<link>https://emilyriederer.com/index.html#category=rstats</link>
<atom:link href="https://emilyriederer.com/index-rstats.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Sat, 13 Jan 2024 06:00:00 GMT</lastBuildDate>
<item>
  <title>polars’ Rgonomic Patterns</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/py-rgo-polars/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/py-rgo-polars/featured.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Photo credit to <a href="https://unsplash.com/@hansjurgen007">Hans-Jurgen Mager</a> on Unsplash</figcaption>
</figure>
</div>
<p>A few weeks ago, I shared some <a href="../../post/py-rgo/">recommended modern python tools and libraries</a> that I believe have the most similar ergonomics for R (specifically <code>tidyverse</code>) converts. This post expands on that one with a focus on the <code>polars</code> library.</p>
<p>At the surface level, all data wrangling libraries have roughly the same functionality. Operations like selecting existing columns and making new ones, subsetting and ordering rows, and summarzing results is tablestakes.</p>
<p>However, no one falls in love with a specific library because it has the best <code>select()</code> or <code>filter()</code> function the world has ever seen. It’s the ability to easily do more complex transformations that differentiate a package expert versus novice, and the learning curve for everything that happens <em>after</em> the “Getting Started” guide ends is what can leave experts at one tool feeling so disempowered when working with another.</p>
<p>This deeper sense of intuition and fluency – when your technical brain knows intuitively how to translate in code what your analytical brain wants to see in the data – is what I aim to capture in the term “ergonomics”. In this post, I briefly discuss the surface-level comparison but spend most of the time exploring the deeper similarities in the functionality and workflows enabled by <code>polars</code> and <code>dplyr</code>.</p>
<section id="what-are-dplyrs-ergonomics" class="level2">
<h2 class="anchored" data-anchor-id="what-are-dplyrs-ergonomics">What are <code>dplyr</code>’s ergonomics?</h2>
<p>To claim <code>polars</code> has a similar aesthetic and user experience as <code>dplyr</code>, we first have to consider what the heart of <code>dplyr</code>‘s ergonomics actually is. The explicit design philosophy is described in the developers’ writings on <a href="https://design.tidyverse.org/unifying.html">tidy design principles</a>, but I’ll blend those official intended principles with my personal definitions based on the lived user experience.</p>
<ul>
<li>Consistent:
<ul>
<li>Function names are highly consistent (e.g.&nbsp;snake case verbs) with dependable inputs and outputs (mostly dataframe-in dataframe-out) to increase intuition, reduce mistakes, and eliminate surprises</li>
<li>Metaphors extend throughout the codebase. For example <code>group_by()</code> + <code>summarize()</code> or <code>group_by()</code> + <code>mutate()</code> do what one might expect (aggregation versus a window function) instead of requiring users to remember arbitrary command-specific syntax</li>
<li>Always returns a new dataframe versus modifying in-place so code is more idempotent<sup>1</sup> and less error prone</li>
</ul></li>
<li>Composable:
<ul>
<li>Functions exist at a “sweet spot” level of abstraction. We have the right primitive building blocks that users have full control to do anything they want to do with a dataframe but almost never have to write brute-force glue code. These building blocks can be layered however one choose to conduct</li>
<li>Conistency of return types leads to composability since dataframe-in dataframe-out allows for chaining</li>
</ul></li>
<li>Human-Centered:
<ul>
<li>Packages hit a comfortable level of abstraction somewhere between fully procedural (e.g.&nbsp;manually looping over array indexes without a dataframe abstraction) and fully declarative (e.g.&nbsp;SQL-style languages where you “request” the output but aspects like the order of operations may become unclear). Writing code is essentially articulating the steps of an analysis</li>
<li>This focus on code as recipe writing leads to the creation of useful optional functions and helpers (like my favorite – column selectors)</li>
<li>User’s rarely need to break the fourth wall of this abstraction-layer (versus thinking about things like indexes in <code>pandas</code>)</li>
</ul></li>
</ul>
<p>TLDR? We’ll say <code>dplyr</code>’s ergonomics allow users to express complex transformation precisely, concisely, and expressively.</p>
<p>So, with that, we will import <code>polars</code> and get started!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span></code></pre></div>
</div>
<p>This document was made with <code>polars</code> version <code>0.20.4</code>.</p>
</section>
<section id="basic-functionality" class="level2">
<h2 class="anchored" data-anchor-id="basic-functionality">Basic Functionality</h2>
<p>The similarities between <code>polars</code> and <code>dplyr</code>’s top-level API are already well-explored in many posts, including those by <a href="https://blog.tidy-intelligence.com/posts/dplyr-vs-polars/">Tidy Intelligence</a> and <a href="https://robertmitchellv.com/blog/2022-07-r-python-side-by-side/r-python-side-by-side.html">Robert Mitchell</a>.</p>
<p>We will only do the briefest of recaps of the core data wrangling functions of each and how they can be composed in order to make the latter half of the piece make sense. We will meet these functions again in-context when discussing <code>dplyr</code> and <code>polar</code>’s more advanced workflows.</p>
<section id="main-verbs" class="level3">
<h3 class="anchored" data-anchor-id="main-verbs">Main Verbs</h3>
<p><code>dplyr</code> and <code>polars</code> offer the same foundational functionality for manipulating dataframes. Their APIs for these operations are substantially similar.</p>
<p>For a single dataset:</p>
<ul>
<li>Column selection: <code>select()</code> -&gt; <code>select()</code> + <code>drop()</code></li>
<li>Creating or altering columns: <code>mutate()</code> -&gt; <code>with_columns()</code></li>
<li>Subsetting rows: <code>filter()</code> -&gt; <code>filter()</code></li>
<li>Ordering rows: <code>arrange()</code> -&gt; <code>sort()</code></li>
<li>Computing group-level summary metrics: <code>group_by()</code> + <code>summarize()</code> -&gt; <code>group_by()</code> + <code>agg()</code></li>
</ul>
<p>For multiple datasets:</p>
<ul>
<li>Merging on a shared key: <code>*_join()</code> -&gt; <code>join(strategy = '*')</code></li>
<li>Stacking datasets of the same structure: <code>union()</code> -&gt; <code>concat()</code></li>
<li>Transforming rows and columns: <code>pivot_{longer/wider}()</code><sup>2</sup> -&gt; <code>pivot()</code></li>
</ul>
</section>
<section id="main-verb-design" class="level3">
<h3 class="anchored" data-anchor-id="main-verb-design">Main Verb Design</h3>
<p>Beyond the similarity in naming, <code>dplyr</code> and <code>polars</code> top-level functions are substantially similar in their deeper design choices which impact the ergonomics of use:</p>
<ul>
<li>Referencing columns: Both make it easy to concisely references columns in a dataset without the repeated and redundant references to said dataset (as sometimes occurs in base R or python’s <code>pandas</code>). dplyr does this through nonstandard evaluation wherein a dataframe’s coumns can be reference directly within a data transformation function as if they were top-level variables; in <code>polars</code>, column names are wrapped in <code>pl.col()</code></li>
<li>Optional argument: Both tend to have a wide array of nice-to-have optional arguments. For example the joining capabilities in both libraries offer optional join validation<sup>3</sup> and column renaming by appended suffix</li>
<li>Consistent dataframe-in -&gt; dataframe-out design: <code>dplyr</code> functions take a dataframe as their first argument and return a dataframe. Similarly, <code>polars</code> methods are called on a dataframe and return a dataframe which enables the chaining workflow discussed next</li>
</ul>
</section>
<section id="chaining-piping" class="level3">
<h3 class="anchored" data-anchor-id="chaining-piping">Chaining (Piping)</h3>
<p>These methods are applied to <code>polars</code> dataframes by <em>chaining</em> which should feel very familiar to R <code>dplyr</code> fans.</p>
<p>In <code>dplyr</code> and the broad <code>tidyverse</code>, most functions take a dataframe as their first argument and return a dataframe, enabling the piping of functions. This makes it easy to write more human-readable scripts where functions are written in the order of execution and whitespace can easily be added between lines. The following lines would all be equivalent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation1</span>(df))</span>
<span id="cb2-2"></span>
<span id="cb2-3">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation1</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation2</span>()</span>
<span id="cb2-4"></span>
<span id="cb2-5">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation1</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transformation2</span>()</span></code></pre></div>
</div>
<p>Similarly, <code>polars</code>’s main transfomration methods offer a consistent dataframe-in dataframe-out design which allows <em>method chaining</em>. Here, we similarly can write commands in order where the <code>.</code> beginning the next method call serves the same purpose as R’s pipe. And for python broadly, to achieve the same affordance for whitespace, we can wrap the entire command in parentheses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">(</span>
<span id="cb3-2">  df</span>
<span id="cb3-3">  .transformation1()</span>
<span id="cb3-4">  .transformation2()</span>
<span id="cb3-5">)</span></code></pre></div>
</div>
<p>One could even say that <code>polars</code> dedication to chaining goes even deeper than <code>dplyr</code>. In <code>dplyr</code>, while core dataframe-level functions are piped, functions on specific columns are still often written in a nested fashion<sup>4</sup></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">g</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(a)))</span></code></pre></div>
</div>
<p>In contrast, most of <code>polars</code> column-level transformation methods also make it ergonomic to keep the same literate left-to-right chaining within column-level definitions with the same benefits to readability as for dataframe-level operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">df.with_columns(z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>).f().g())</span></code></pre></div>
</div>
</section>
</section>
<section id="advanced-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="advanced-wrangling">Advanced Wrangling</h2>
<p>Beyond the surface-level similarity, <code>polars</code> supports some of the more complex ergonomics that <code>dplyr</code> users may enjoy. This includes functionality like:</p>
<ul>
<li>expressive and explicit syntax for transformations across multiple rows</li>
<li>concise helpers to identify subsets of columns and apply transformations</li>
<li>consistent syntax for window functions within data transformation operations</li>
<li>the ability to work with nested data structures</li>
</ul>
<p>Below, we will examine some of this functionality with a trusty fake dataframe.<sup>5</sup> As with <code>pandas</code>, you can make a quick dataframe in <code>polars</code> by passing a dictionary to <code>pl.DataFrame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl </span>
<span id="cb6-2"></span>
<span id="cb6-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>:[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], </span>
<span id="cb6-4">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>:[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>], </span>
<span id="cb6-5">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c'</span>:[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]})</span>
<span id="cb6-6">df.head()</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3</td>
<td>7</td>
</tr>
<tr class="even">
<td>1</td>
<td>4</td>
<td>8</td>
</tr>
<tr class="odd">
<td>2</td>
<td>5</td>
<td>9</td>
</tr>
<tr class="even">
<td>2</td>
<td>6</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="explicit-api-for-row-wise-operations" class="level3">
<h3 class="anchored" data-anchor-id="explicit-api-for-row-wise-operations">Explicit API for row-wise operations</h3>
<p>While row-wise operations are relatively easy to write ad-hoc, it can still be nice semantically to have readable and stylistically consistent code for such transformations.</p>
<p><code>dplyr</code>’s <a href="https://dplyr.tidyverse.org/articles/rowwise.html"><code>rowwise()</code></a> eliminates ambiguity in whether subsequent functions should be applied element-wise or collectively. Similiarly, <code>polars</code> has explicit <code>*_horizontal()</code> functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">df.with_columns(</span>
<span id="cb7-2">  b_plus_c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.sum_horizontal(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>), pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c'</span>)) </span>
<span id="cb7-3">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">b_plus_c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3</td>
<td>7</td>
<td>10</td>
</tr>
<tr class="even">
<td>1</td>
<td>4</td>
<td>8</td>
<td>12</td>
</tr>
<tr class="odd">
<td>2</td>
<td>5</td>
<td>9</td>
<td>14</td>
</tr>
<tr class="even">
<td>2</td>
<td>6</td>
<td>0</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="column-selectors" class="level3">
<h3 class="anchored" data-anchor-id="column-selectors">Column Selectors</h3>
<p><code>dplyr</code>’s <a href="https://dplyr.tidyverse.org/reference/select.html">column selectors</a> dynamically determine a set of columns based on pattern-matching their names (e.g.&nbsp;<code>starts_with()</code>, <code>ends_with()</code>), data types, or other features. I’ve previously <a href="../../post/column-name-contracts/">written</a> and <a href="../../talk/col-names-contract/">spoken</a> at length about how transformative this functionality can be when paired with</p>
<p><code>polars</code> has a similar set of <a href="https://docs.pola.rs/py-polars/html/reference/selectors.html">column selectors</a>. We’ll import them and see a few examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> cs</span></code></pre></div>
</div>
<p>To make things more interesting, we’ll also turn one of our columns into a different data type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.with_columns(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>).cast(pl.Utf8))</span></code></pre></div>
</div>
<section id="in-select" class="level4">
<h4 class="anchored" data-anchor-id="in-select">In <code>select</code></h4>
<p>We can select columns based on name or data type and use one or more conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">df.select(cs.starts_with(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> cs.string())</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>"1"</td>
</tr>
<tr class="even">
<td>4</td>
<td>"1"</td>
</tr>
<tr class="odd">
<td>5</td>
<td>"2"</td>
</tr>
<tr class="even">
<td>6</td>
<td>"2"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Negative conditions also work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">df.select(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>cs.string())</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>7</td>
</tr>
<tr class="even">
<td>4</td>
<td>8</td>
</tr>
<tr class="odd">
<td>5</td>
<td>9</td>
</tr>
<tr class="even">
<td>6</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="in-with_columns" class="level4">
<h4 class="anchored" data-anchor-id="in-with_columns">In <code>with_columns</code></h4>
<p>Column selectors can play multiple rows in the transformation context.</p>
<p>The same transformation can be applied to multiple columns. Below, we find all integer variables, call a method to add 1 to each, and use the <code>name.suffix()</code> method to dynamically generate descriptive column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">df.with_columns(</span>
<span id="cb12-2">  cs.integer().add(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).name.suffix(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_plus1"</span>)</span>
<span id="cb12-3">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">b_plus1</th>
<th data-quarto-table-cell-role="th">c_plus1</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
<td>4</td>
<td>8</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
<td>5</td>
<td>9</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
<td>6</td>
<td>10</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
<td>7</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can also use selected variables within transformations, like the rowwise sums that we just saw earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">df.with_columns(</span>
<span id="cb13-2">  row_total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.sum_horizontal(cs.integer())</span>
<span id="cb13-3">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">row_total</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
<td>10</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
<td>12</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
<td>14</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="in-group_by-and-agg" class="level4">
<h4 class="anchored" data-anchor-id="in-group_by-and-agg">In <code>group_by</code> and <code>agg</code></h4>
<p>Column selectors can also be passed as inputs anywhere else that one or more columns is accepted, as with data aggregation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">df.group_by(cs.string()).agg(cs.integer().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>())</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>7</td>
<td>15</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>11</td>
<td>9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="consistent-api-for-window-functions" class="level3">
<h3 class="anchored" data-anchor-id="consistent-api-for-window-functions">Consistent API for Window Functions</h3>
<p>Window functions are another incredibly important tool in any data wrangling language but seem criminally undertaught in introductory analysis classes. Window functions allows you to apply aggregation <em>logic</em> over subgroups of data while preserving the original <em>grain</em> of the data (e.g.&nbsp;in a table of all customers and orders and a column for the max purchase account by customer).</p>
<p><code>dplyr</code> make window functions trivially easy with the <code>group_by()</code> + <code>mutate()</code> pattern, invoking users’ pre-existing understanding of how to write aggregation logic and how to invoke transformations that preserve a table’s grain.</p>
<p><code>polars</code> takes a slightly different but elegant approach. Similarly, it reuses the core <code>with_columns()</code> method for window functions. However, it uses a more SQL-reminiscent specification of the “window” in the column definition versus a separate grouping statement. This has the added advantage of allowing one to use multiple window functions with different windows in the same <code>with_columns()</code> call if you should so choose.</p>
<p>A simple window function tranformation can be done by calling <code>with_columns()</code>, chaining an aggregation method onto a column, and following with the <code>over()</code> method to define the window of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">df.with_columns(</span>
<span id="cb15-2">  min_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>().over(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>)</span>
<span id="cb15-3">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">min_b</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
<td>3</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
<td>3</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
<td>5</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The chaining over and aggregate and <code>over()</code> can follow any other arbitrarily complex logic. Here, it follows a basic “case when”-type statement that creates an indicator for whether column b is null.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">df.with_columns(</span>
<span id="cb16-2">  n_b_odd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.when( (pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-3">              .then(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-4">              .otherwise(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-5">              .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>().over(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>)</span>
<span id="cb16-6">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">n_b_odd</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
<td>1</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
<td>1</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="list-columns-and-nested-frames" class="level3">
<h3 class="anchored" data-anchor-id="list-columns-and-nested-frames">List Columns and Nested Frames</h3>
<p>While the R <code>tidyverse</code>’s raison d’etre was originally around the design of heavily normalize <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a>, modern data and analysis sometimes benefits from more complex and hierarchical data structures. Sometimes data comes to us in nested forms, like from an API<sup>6</sup>, and other times nesting data can help us perform analysis more effectively<sup>7</sup> Recognizing these use cases, <code>tidyr</code> provides many capability for the creation and manipulation of <a href="https://tidyr.tidyverse.org/articles/nest.html">nested data</a> in which a single cell contains values from multiple columns or sometimes even a whoel miniature dataframe.</p>
<p><code>polars</code> makes these operations similarly easy with its own version of structs (list columns) and arrays (nested dataframes).</p>
<section id="list-columns-nested-frames" class="level4">
<h4 class="anchored" data-anchor-id="list-columns-nested-frames">List Columns &amp; Nested Frames</h4>
<p>List columns that contain multiple key-value pairs (e.g.&nbsp;column-value) in a single column can be created with <code>pl.struct()</code> similar to R’s <code>list()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">df.with_columns(list_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.struct( cs.integer() ))</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">list_col</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>struct[2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
<td>{3,7}</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
<td>{4,8}</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
<td>{5,9}</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
<td>{6,0}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These structs can be further be aggregated across rows into miniature datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">df.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>).agg(list_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.struct( cs.integer() ) )</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">list_col</th>
</tr>
<tr class="odd">
<th>str</th>
<th>list[struct[2]]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2"</td>
<td>[{5,9}, {6,0}]</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>[{3,7}, {4,8}]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In fact, this could be a good use case for our column selectors! If we have many columns we want to keep unnested and many we want to next, it could be efficient to list out only the grouping variables and create our nested dataset by examining matches.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>]</span>
<span id="cb19-2">(df</span>
<span id="cb19-3">  .group_by(cs.by_name(cols))</span>
<span id="cb19-4">  .agg(list_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.struct(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>cs.by_name(cols)))</span>
<span id="cb19-5">)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">list_col</th>
</tr>
<tr class="odd">
<th>str</th>
<th>list[struct[2]]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2"</td>
<td>[{5,9}, {6,0}]</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>[{3,7}, {4,8}]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="undoing" class="level4">
<h4 class="anchored" data-anchor-id="undoing">Undoing</h4>
<p>Just as we constructed our nested data, we can denormalize it and return it to the original state in two steps. To see this, we can assign the nested structure above as <code>df_nested</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">df_nested <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>).agg(list_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.struct( cs.integer() ) )</span></code></pre></div>
</div>
<p>First <code>explode()</code> returns the table to the original grain, leaving use with a single struct in each row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">df_nested.explode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'list_col'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">list_col</th>
</tr>
<tr class="odd">
<th>str</th>
<th>struct[2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>{3,7}</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>{4,8}</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>{5,9}</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>{6,0}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Then, <code>unnest()</code> unpacks each struct and turns each element back into a column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">df_nested.explode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'list_col'</span>).unnest(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'list_col'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>3</td>
<td>7</td>
</tr>
<tr class="even">
<td>"1"</td>
<td>4</td>
<td>8</td>
</tr>
<tr class="odd">
<td>"2"</td>
<td>5</td>
<td>9</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>6</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Meaning you can’t get the same result twice because if you rerun the same code the input has already been modified↩︎</p></li>
<li id="fn2"><p>Of the <code>tidyverse</code> funtions mentioned so far, this is the only one found in <code>tidyr</code> not <code>dplyr</code>↩︎</p></li>
<li id="fn3"><p>That is, validating an assumption that joins should have been one-to-one, one-to-many, etc.↩︎</p></li>
<li id="fn4"><p>However, this is more by convention. There’s not a strong reason why they would strictly need to be.↩︎</p></li>
<li id="fn5"><p>I recently ran a <a href="https://twitter.com/EmilyRiederer/status/1744707632886095998">Twitter poll</a> on whether people prefer real, canonical, or fake datasets for learning and teaching. Fake data wasn’t the winner, but a strategy I find personally fun and useful as the unit-test analog for learning.↩︎</p></li>
<li id="fn6"><p>For example, an API payload for a LinkedIn user might have nested data structures representing professional experience and educational experience↩︎</p></li>
<li id="fn7"><p>For example, training a model on different data subsets.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>python</category>
  <category>tutorial</category>
  <guid>https://emilyriederer.com/post/py-rgo-polars/index.html</guid>
  <pubDate>Sat, 13 Jan 2024 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/py-rgo-polars/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Python Rgonomics</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/py-rgo/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/py-rgo/featured.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Photo credit to the inimitable <a href="https://allisonhorst.com/">Allison Horst</a></figcaption>
</figure>
</div>
<p>Interoperability was a key theme in open-source data languages in 2023. Ongoing innovations in <a href="https://arrow.apache.org/">Arrow</a> (a language-agnostic in-memory standard for data storage), growing adoption of <a href="https://quarto.org/">Quarto</a> (the language-agnostic heir apparent to R Markdown), and even pandas creator Wes McKinney <a href="https://posit.co/blog/welcome-wes/">joining Posit</a> (the language-agnostic rebranding of RStudio) all illustrate the ongoing investment in breaking down barriers between different programming languages and paradigms.</p>
<p>Despite these advances in <em>technical</em> interoperability, individual developers will always face more friction than state-of-the-art tools when moving between languages. Learning a new language is easily enough done; programming 101 concepts like truth tables and control flow translate seamlessly. But ergonomics of a language do not. The tips and tricks we learn to be hyper productive in a primary language are comfortable, familiar, elegant, and effective. They just <em>feel</em> good. Working in a new language, developers often face a choice between forcing their favored workflows into a new tool where they may not “fit”, writing technically correct yet plodding code to get the job done, or approaching a new language as a true beginner to learn it’s “feel” from the ground up.</p>
<p>Fortunately, some of these higher-level paradigms have begun to bleed across languages, enriching previously isolated tribes with the and enabling developers to take their advanced skillsets with them across languages. For any R users who aim to upskill in python in 2024, recent tools and versions of old favorites have made strides in converging the R and python data science stacks. In this post, I will overview some recommended tools that are both truly pythonic while capturing the comfort and familiarity of some favorite R packages of the <code>tidyverse</code> variety.<sup>1</sup></p>
<section id="what-this-post-is-not" class="level2">
<h2 class="anchored" data-anchor-id="what-this-post-is-not">What this post is not</h2>
<p>Just to be clear:</p>
<ul>
<li>This is not a post about why python is better than R so R users should switch all their work to python</li>
<li>This is not a post about why R is better than python so R semantics and conventions should be forced into python</li>
<li>This is not a post about why python <em>users</em> are better than R users so R users need coddling</li>
<li>This is not a post about why R <em>users</em> are better than python users and have superior tastes for their toolkit</li>
<li>This is not a post about why these python tools are the only good tools and others are bad tools</li>
</ul>
<p>If you told me you liked the New York’s Museum of Metropolitan Art, I might say that you might also like Chicago’s Art Institute. That doesn’t mean you should only go to the museum in Chicago or that you should never go to the Louvre in Paris. That’s not how recommendations (by human or recsys) work. This is an “opinionated” post in the sense that “I like this” and not opinionated in the sense that “you must do this”.</p>
</section>
<section id="on-picking-tools" class="level2">
<h2 class="anchored" data-anchor-id="on-picking-tools">On picking tools</h2>
<p>The tools I highlight below tend to have two competing features:</p>
<ul>
<li>They have aspects of their workflow and ergonomics that should feel very comfortable to users of favored R tools</li>
<li>They should be independently accepted, successful, and well-maintained python projects with the true pythonic spirit</li>
</ul>
<p>The former is important because otherwise there’s nothing tailored about these recommendations; the latter is important so users actually engage with the python language and community instead of dabbling around in its more peripheral edges. In short, these two principles <em>exclude</em> tools that are direct ports between languages with that as their sole or main benefit.<sup>2</sup></p>
<p>For example, <code>siuba</code> and <code>plotnine</code> were written with the direct intent of mirroring R syntax. They have seen some success and adoption, but more niche tools come with liabilities. With smaller user-bases, they tend to lack in the pace of development, community support, prior art, StackOverflow questions, blog posts, conference talks, discussions, others to collaborate with, cache in a portfolio, etc. Instead of enjoying the ergonomics of an old language or embracing the challenge of learning a new one, ports can sometimes force developers to invest energy into a “secret third thing” of learning tools that isolate them from both communities and facing inevitable snags by themselves.</p>
<p>When in Rome, do as the Romans do – but if you’re coming from the U.S. that doesn’t mean you can’t bring a universal adapter that can help charge your devices in European outlets.</p>
</section>
<section id="the-stack" class="level2">
<h2 class="anchored" data-anchor-id="the-stack">The stack</h2>
<p>WIth that preamble out of the way, below are a few recommendations for the most ergonomic tools for getting set up, conducting core data analysis, and communication results.</p>
<p>To preview these recommendations:</p>
<p><strong>Set Up</strong></p>
<ul>
<li>Installation: <a href="https://github.com/pyenv/pyenv"><code>pyenv</code></a></li>
<li>IDE: <a href="https://code.visualstudio.com/docs/languages/python">VS Code</a></li>
</ul>
<p><strong>Analysis</strong></p>
<ul>
<li>Wrangling: <a href="https://pola.rs/"><code>polars</code></a></li>
<li>Visualization: <a href="https://seaborn.pydata.org/"><code>seaborn</code></a></li>
</ul>
<p><strong>Communication</strong></p>
<ul>
<li>Tables: <a href="https://posit-dev.github.io/great-tables/articles/intro.html">Great Tables</a></li>
<li>Notebooks: <a href="https://quarto.org/">Quarto</a></li>
</ul>
<p><strong>Miscellaneous</strong></p>
<ul>
<li>Environment Management: <a href="https://pdm-project.org/latest/"><code>pdm</code></a></li>
<li>Code Quality: <a href="https://docs.astral.sh/ruff/"><code>ruff</code></a></li>
</ul>
<section id="for-setting-up" class="level3">
<h3 class="anchored" data-anchor-id="for-setting-up">For setting up</h3>
<p>The first hurdle is often getting started – both in terms of installing the tools you’ll need and getting into a comfortable IDE to run them.</p>
<ul>
<li><strong>Installation</strong>: R keeps installation simple; there’s one way to do it* so you do and it’s done. But before python converts can <code>print("hello world")</code>, they face a range of options (system Python, Python installer UI, Anaconda, Miniconda, etc.) each with its own kinks. These decisions are made harder in Python since projects tend to have stronger dependencies of the language, requiring one to switch between versions. For both of these reasons, I favor the <a href="https://github.com/pyenv/pyenv"><code>pyenv</code></a> (or <code>pyenv-win</code> for those on Windows) for easily managing python installation(s) from the command line. While the installation process of <code>pyenv</code> may be <em>technically</em> different, it’s similar in that it “just works” with just a few commands. In fact, the workflow is <em>so slick</em> that things seem to have gone 180 degrees with <code>pyenv</code> inspiring <a href="https://github.com/r-lib/rig">similar project called <code>rig</code> to manage R installations</a>. This may sound intimidating, but the learning curve is actually quite shallow:
<ul>
<li><code>pyenv install --list</code>: To see what python versions are available to install</li>
<li><code>pyenv install &lt;version number&gt;</code>: To install a specific version</li>
<li><code>pyenv versions</code>: To see what python versions are installed on your system</li>
<li><code>pyenv global &lt;version number&gt;</code>: The set one python version as a global default</li>
<li><code>pyenv local &lt;version number&gt;</code>: The set a python version to be used within a specific directory/project</li>
</ul></li>
<li><strong>Integrated Development Environment</strong>: Once R is install, R users are typically off to the races with the intuitive RStudio IDE which helps them get immediately hands-on with the REPL. With the UI divided into quadrants, users can write an R script, run it to see results in the console, conceptualize what the program “knows” with the variable explorer, and navigate files through a file explorer. Once again, python is not lacking in IDE options, but users are confronted with yet another decision point before they even get started. Pycharm, Sublime, Spyder, Eclipse, Atom, Neovim, oh my! I find that <a href="https://code.visualstudio.com/docs/languages/python">VS Code</a> offers the best functionality. It’s rich extension ecosystem also means that most major tools (e.g.&nbsp;Quarto, git, linters and stylers, etc.) have nice add-ons so, like RStudio, you can customize your platform to perform many side-tasks in plaintext or with the support of extra UI components.<sup>3</sup></li>
</ul>
</section>
<section id="for-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="for-data-analysis">For data analysis</h3>
<p>As data practitioners know, we’ll spend most of our time on cleaning and wrangling. As such, R users may struggle particularly to abandon their favorite tools for exploratory data analysis like <code>dplyr</code> and <code>ggplot2</code>. Fans of those packages often appreciate how their functional paradigm helps achieve a “flow state”. Precise syntax may differ, but new developments in the python wrangling stack provide increasingly close analogs to some of these beloved Rgonomics.</p>
<ul>
<li><strong>Data Wrangling</strong>: Although <code>pandas</code> is undoubtedly the best-known wrangling tool in the python space, I believe the growing <a href="https://pola.rs/"><code>polars</code></a> project offers the best experience for a transitioning developer (along with other nice-to-have benefits like being dependency free and blazingly fast). <code>polars</code> may feel more natural and less error-prone to R users for may reasons:
<ul>
<li>it has more internal consistent (and similar to <code>dplyr</code>) syntax such as <code>select</code>, <code>filter</code>, etc. and has demonstrated that the project values a clean API (e.g.&nbsp;recently renaming <code>groupby</code> to <code>group_by</code>)</li>
<li>it does not rely on the distinction between columns and indexes which can feel unintuitive and introduces a new set of concepts to learn</li>
<li>it consistently returns copies of dataframes (while <code>pandas</code> sometimes alters in-place) so code is more idempotent and avoids a whole class of failure modes for new users</li>
<li>it enables many of the same “advanced” wrangling workflows in <code>dplyr</code> with high-level, semantic code like making the transformation of multiple variables at once fast with <a href="https://docs.pola.rs/py-polars/html/reference/selectors.html">column selectors</a>, concisely expressing <a href="https://docs.pola.rs/user-guide/expressions/window/">window functions</a>, and working with nested data (or what <code>dplyr</code> calls “list columns”) with <a href="https://docs.pola.rs/user-guide/expressions/lists/">lists</a> and <a href="https://docs.pola.rs/user-guide/expressions/structs/">structs</a></li>
<li>supporting users working with increasingly large data. Similar to <code>dplyr</code>’s many backends (e.g.&nbsp;<code>dbplyr</code>), <code>polars</code> can be used to write lazily-evaluated, optimized transformations and it’s syntax is reminiscent of <code>pyspark</code> should users ever need to switch between</li>
</ul></li>
<li><strong>Visualization</strong>: Even some of R’s critics will acknowledge the strength of <code>ggplot2</code> for visualization, both in terms of it’s intuitive and incremental API and the stunning graphics it can produce. <a href="https://seaborn.pydata.org/tutorial/objects_interface"><code>seaborn</code>’s object interface</a> seems to strike a great balance between offering a similar workflow (which <a href="https://seaborn.pydata.org/whatsnew/v0.12.0.html">cites <code>ggplot2</code> as an inspiration</a>) while bringing all the benefits of using an industry-standard tool</li>
</ul>
</section>
<section id="for-communication" class="level3">
<h3 class="anchored" data-anchor-id="for-communication">For communication</h3>
<p>Historically, one possible dividing line between R and python has been framed as “python is good at working with computers, R is good at working with people”. While that is partially inspired by reductive takes that R is not production-grade, it is not without truth that the R’s academic roots spurred it to overinvest in a rich “communication stack” and translating analytical outputs into human-readable, publishable outputs. Here, too, the gaps have begun to close.</p>
<ul>
<li><strong>Tables</strong>: R has no shortage of packages for creating nicely formatted tables, an area that has historically lacked a bit in python both in workflow and outcomes. Barring strong competition from the native python space, the one “port” I am bullish about is the recently announced <a href="https://posit-dev.github.io/great-tables/articles/intro.html">Great Tables</a> package. This is a pythonic clone of R’s <code>gt</code> package. I’m more comfortable recommending this since it’s maintained by the same developer as the R version (to support long-term feature parity), backed by an institution not just an individual (to ensure it’s not a short-lived hobby project), and the design feels like it does a good job balancing R inspiration with pythonic practices</li>
<li><strong>Computational notebooks</strong>: Jupyter Notebooks are widely used, widely critiqued parts of many python workflows. While the ability to mix markdown and code chunks. However, notebooks can introduce new types of bugs for the uninitiated; for example, they are hard to version control and easy to execute in the wrong environment. For those coming from the world of R Markdown, plaintext computational notebooks like <a href="https://quarto.org/">Quarto</a> may provide a more transparent development experience. While Quarto allows users to write in <code>.qmd</code> files which are more like their <code>.rmd</code> predecessors, its renderer can also handle Jupyter notebooks to enable collaboration across team members with different preferences</li>
</ul>
</section>
<section id="miscellaneous" class="level3">
<h3 class="anchored" data-anchor-id="miscellaneous">Miscellaneous</h3>
<p>A few more tools may be helpful and familiar to <em>some</em> R users who tend towards the more “developer” versus “analyst” side of the spectrum. These, in my mind, have even more varied pros and cons, but I’ll leave them for consideration:</p>
<ul>
<li><strong>Environment Management</strong>: Joining the python world means never having to settle on an environment management tool for installing packages. There’s a truly overwhelming number of ways to manage project-level dependencies (<code>virtualenv</code>, <code>conda</code>, <code>piptools</code>, <code>pipenv</code>, <code>poetry</code>, and that doesn’t even scratch the surface) with different pros and cons and phenomenal amount of ink/pixels have been spilled over litigating these trade-offs. Putting all that aside, lately, I’ve been favoring <a href="https://pdm-project.org/latest/"><code>pdm</code></a> because it prioritizes features I care most about (auto-updating <code>pyproject.toml</code>, isolating dependencies from dependencies-of-dependencies, active development and error handling, mostly just works pretty undramatically)</li>
<li><strong>Developer Tools</strong>: <a href="https://docs.astral.sh/ruff/"><code>ruff</code></a> provides a range of linting and styling options (think R’s <code>lintr</code> and <code>styler</code>) and provides a one-stop-shop over what can be an overwhelming number of atomic tools in this space (<code>isort</code>, <code>black</code>, <code>flake8</code>, etc.). <code>ruff</code> is super fast, has a nice VS Code extension, and, while this class of tools is generally considered more advanced, I think linters can be a fantastic “coach” for new users about best practices</li>
</ul>
</section>
</section>
<section id="more-to-come" class="level2">
<h2 class="anchored" data-anchor-id="more-to-come">More to come!</h2>
<p>Each recommendation here itself could be its own tutorial or post. In particular, I hope to showcase the Rgonomics of <code>polars</code>, <code>seaborn</code>, and <code>great_tables</code> in future posts.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Of course, languages have their own subcultures too. The <code>tidyverse</code> and <code>data.table</code> parts of the R world tend to favor different semantics and ergonomics. This post caters more to the former.↩︎</p></li>
<li id="fn2"><p>There is no doubt a place for language ports, especially for earlier stage project where no native language-specific standard exists. For example, I like Karandeep Singh’s lab work on <a href="https://github.com/TidierOrg/Tidier.jl">a tidyverse for Julia</a> and maintain my own <a href="https://github.com/emilyriederer/dbtplyr"><code>dbtplyr</code></a> package to port <code>dplyr</code>’s select helpers to <code>dbt</code>↩︎</p></li>
<li id="fn3"><p> If anything, the one challenge of VS Code is the sheer number of set up options, but to start out, you can see these excellent tutorials from Rami Krispin on recommended <a href="https://github.com/RamiKrispin/vscode-python">python</a> and <a href="https://github.com/RamiKrispin/vscode-r">R</a> configurations ↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>python</category>
  <guid>https://emilyriederer.com/post/py-rgo/index.html</guid>
  <pubDate>Sat, 30 Dec 2023 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/py-rgo/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Operationalizing Column-Name Contracts with dbtplyr</title>
  <link>https://emilyriederer.com/talk/dbtplyr/index.html</link>
  <description><![CDATA[ 



<p>url_video: “”</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Quick Links</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Abstract</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">Slides</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">Video</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p>At Coalesce for dbt user audience:</p>
<p><span><i class="bi bi-file-bar-graph"></i> <a href="slides.pdf">Slides</a> </span><br>
<span><i class="bi bi-play"></i> <a href="https://www.getdbt.com/coalesce-2021/operationalizing-columnname-contracts-with-dbtplyr/">Video</a> </span></p>
<p>At posit::conf for R user audience:</p>
<p><span><i class="bi bi-file-bar-graph"></i> <a href="slides-posit.pdf">Slides</a> </span><br>
<span><i class="bi bi-play"></i> Video - posit::conf for R User Audience <em>coming soon!</em> </span></p>
<p><span><i class="bi bi-pencil"></i> <a href="../../post/column-name-contracts/">Post - Column Name Contracts</a> </span><br>
<span><i class="bi bi-pencil"></i> <a href="../../post/convo-dbt/">Post - Column Name Contracts in dbt</a> </span><br>
<span><i class="bi bi-pencil"></i> <a href="../../post/convo-dbt-update/">Post - Column Name Contracts with dbtplyr</a> </span></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>Complex software systems make performance guarantees through documentation and unit tests, and they communicate these to users with conscientious interface design.</p>
<p>However, published data tables exist in a gray area; they are static enough not to be considered a “service” or “software”, yet too raw to earn attentive user interface design. This ambiguity creates a disconnect between data producers and consumers and poses a risk for analytical correctness and reproducibility.</p>
<p>In this talk, I will explain how controlled vocabularies can be used to form contracts between data producers and data consumers. Explicitly embedding meaning in each component of variable names is a low-tech and low-friction approach which builds a shared understanding of how each field in the dataset is intended to work.</p>
<p>Doing so can offload the burden of data producers by facilitating automated data validation and metadata management. At the same time, data consumers benefit by a reduction in the cognitive load to remember names, a deeper understanding of variable encoding, and opportunities to more efficiently analyze the resulting dataset. After discussing the theory of controlled vocabulary column-naming and related workflows, I will illustrate these ideas with a demonstration of the {dbtplyr} dbt package which helps analytics engineers get the most value from controlled vocabularies by making it easier to effectively exploit column naming structures while coding.</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div id="slides" style="width:100%; aspect-ratio:16/11;">
<embed src="slides.pdf#zoom=Fit" width="100%" height="100%">
</div>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<p>Coming Soon!</p>
</div>
</div>
</div>



 ]]></description>
  <category>workflow</category>
  <category>rmarkdown</category>
  <category>rstats</category>
  <guid>https://emilyriederer.com/talk/dbtplyr/index.html</guid>
  <pubDate>Thu, 21 Sep 2023 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/talk/dbtplyr/featured.png" medium="image" type="image/png" height="82" width="144"/>
</item>
<item>
  <title>Posit Data Science Hangout</title>
  <link>https://emilyriederer.com/talk/meetup-posit/index.html</link>
  <description><![CDATA[ 



<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Quick Links</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Abstract</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">Slides</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">Video</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><span><i class="bi bi-play"></i> <a href="https://www.youtube.com/watch?v=VUgoaNhE4u0">Video</a> </span></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>We were recently joined by Emily Riederer, Senior Manager - Customer Management Data Science &amp; Analytics at Capital One. We discussed how a strong foundation in high-quality data infrastructure and reproducible tools sets the stage for innovation in modeling, causal inference, and analytics, and so much more.</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p>Not applicable - live conversation</p>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/VUgoaNhE4u0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>



 ]]></description>
  <category>rstats</category>
  <category>workflow</category>
  <guid>https://emilyriederer.com/talk/meetup-posit/index.html</guid>
  <pubDate>Thu, 13 Apr 2023 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/talk/meetup-posit/featured.png" medium="image" type="image/png" height="74" width="144"/>
</item>
<item>
  <title>Taking Flight with Shiny: a Modules-First Approach</title>
  <link>https://emilyriederer.com/talk/shiny-modules/index.html</link>
  <description><![CDATA[ 



<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Quick Links</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Abstract</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">Slides</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">Video</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><span><i class="bi bi-file-bar-graph"></i> <a href="slides.pdf">Slides</a> </span><br>
<span><i class="bi bi-play"></i> <a href="https://posit.co/resources/videos/tidycf-turning-analysis-on-its-head-by-turning-cashflows-on-their-sides/">Video</a> </span><br>
<span><i class="bi bi-pencil"></i> <a href="../../post/shiny-modules/">Post - A beginner’s guide to Shiny modules</a> </span></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>R users are increasingly trained to develop with good principles such as writing modular functions, testing their code, and decomposing long individual scripts into R projects. In recent years, such approaches have crept earlier into introductory R education with the realization that applying best practices is not an advanced skill but rather empowers beginners with a more robust structure.</p>
<p>However, new Shiny developers are confronted with two challenges: they must simultaneously learn new packages and concepts (like reactivity) which introductory tutorials demonstrate how to write their apps as single scripts. This means small changes are harder to test and debug for the groups that need it the most. Although Shiny modules offer a solution to this exact problem, they are regarded as an advanced topic and often not encountered until much later in a developer’s journey.</p>
<p>In this talk, I will demonstrate a workflow to encourage the use of modules for newer Shiny users. I argue that a ‘module-first’ approach helps to decompose design into more tangible, bite-sized, and testable components and prevent the code sprawl that makes Shiny feel intimidating. Further, this approach can be even more powerful when developing Shiny applications in the enterprise setting and onboarding new team members to existing applications.</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div id="slides" style="width:100%; aspect-ratio:16/11;">
<embed src="slides.pdf#zoom=Fit" width="100%" height="100%">
</div>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/F6I_jXPWFBk" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>



 ]]></description>
  <category>workflow</category>
  <category>rstats</category>
  <category>shiny</category>
  <guid>https://emilyriederer.com/talk/shiny-modules/index.html</guid>
  <pubDate>Wed, 15 Mar 2023 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/talk/shiny-modules/featured.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Oh, I’m sure it’s probably nothing</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/nulls-polyglot/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/nulls-polyglot/featured.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Photo credit to <a href="https://unsplash.com/@davideragusa">Davide Ragusa</a> on Unsplash</figcaption>
</figure>
</div>
<p>Language interoperability and different ways of enabling “polyglot” workflows have seemed to take centerstage in the data world recently:</p>
<ul>
<li><a href="https://arrow.apache.org/">Apache Arrow</a> promises a language-independent memory format for interoperability, - <a href="https://www.rstudio.com/blog/rstudio-is-becoming-posit/">RStudio</a> its rebranding as Posit to cement their place as a leader in language-agnostic data tooling,</li>
<li>RStudio simultaneously announced <a href="https://quarto.org/">Quarto</a> as an interoperable alternative to RMarkdown which will treat python, Julia, and JS as first-class citizens</li>
<li>dbt has released its beta of <a href="https://docs.getdbt.com/docs/building-a-dbt-project/building-models/python-models">python models</a> to extend is previously SQL-focused paradigm</li>
</ul>
<p>As a general matter, these are all exciting advances with great potential to aid in different workflows <em>when used judiciously</em>. However, it also poses the question: what cognitive burdens do we alleviate and which do we add when our projects begin to leverage multiple languages?</p>
<p>Despite common data analysis tools like SQL, R, and python being high-level languages with declarative interfaces (in the case of R’s <code>tidyverse</code> and python’s <code>pandas</code>), successful usage still requires understanding the underlying assumptions and operations of each tool. There is not such thing as a truly declarative language; only those that generally make decisions that the user likes well-enough to ask for the “what” and delegate the “how”. These differences can emerge at many different levels: such as foundational issues like whether data structures are copied or modified in-place or broader design choices like default hyperparameters in machine learning libraries (e.g.&nbsp;python’s <code>scikitlearn</code> notoriously uses regularized logistic regression as the default for logistic regression.) Somewhere along that spectrum lies the fickle issue of handling null values.</p>
<p>In this post, I recap a quick case study of how incautious null handling risks data analysis validity. Then, taking a step back, I compare how R, python, and SQL behave differently when confront with null values and the implications for analysts switching between languages.</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>A summary of these different behaviors is provided below:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><strong>R</strong></th>
<th style="text-align: center;"><strong>python</strong></th>
<th style="text-align: center;"><strong>SQL</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><em>Column Aggregation</em></td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">np: NA<br>pd: Value</td>
<td style="text-align: center;">Value</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>Row-wise Transformation</em></td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>Joining</em></td>
<td style="text-align: center;">Match by default</td>
<td style="text-align: center;">Match</td>
<td style="text-align: center;">No match</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>Filtering</em></td>
<td style="text-align: center;">No match</td>
<td style="text-align: center;">Match</td>
<td style="text-align: center;">No match</td>
</tr>
</tbody>
</table>
</section>
<section id="case-study" class="level2">
<h2 class="anchored" data-anchor-id="case-study">Case Study</h2>
<p>Before comparing different languages, let’s walk through a brief case study to see all the way that “lurking” nulls can surprise a junior analyst in any one language and observe a few different “contours” of the problem space.</p>
<p>Consider two tables in a retailer’s database. The <code>spend</code> table reports total sales by month and store identifier (null if online).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  STORE_ID MONTH AMT_SPEND
1        1     1 100.12011
2        2     1 100.31441
3       NA     1 100.40517
4        1     2  99.67098
5        2     2  98.39703
6       NA     2  98.81231
7        1     3 102.27124
8        2     3 100.20843
9       NA     3        NA</code></pre>
</div>
</div>
<p>Similarly, the <code>returns</code> table reports returned sales at the same grain.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  STORE_ID MONTH AMT_RETURN
1        1     1         NA
2        2     1   9.972159
3       NA     1  10.071639
4        1     2   9.798444
5        2     2  10.254347
6       NA     2   9.881071
7        1     3  10.108880
8        2     3   9.951398
9       NA     3   9.849277</code></pre>
</div>
</div>
<p>In both cases, nulls are used in the <code>'AMT_*'</code> fields to denote zeros for the respective <code>month x store_id</code> combinations`.</p>
<p>To calculate something as simple as the average gross spend per store across months, an analyst might attempt to write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> </span>
<span id="cb3-2">  store_id, </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg</span>(amt_spend)</span>
<span id="cb3-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> spend</span>
<span id="cb3-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">group</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">order</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">store_id</th>
<th style="text-align: right;">avg(amt_spend)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">99.60874</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.68744</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">99.63996</td>
</tr>
</tbody>
</table>
</div>
<p>However, because SQL silently drops nulls in column aggregations, the online spend is not appropriately “penalized” for its lack of March spend. The averages across all three stores look nearly equal.</p>
<p>Not only is this answer “wrong”, it can also be thought of as fundamentally changing the <strong>computand</strong> (a word I just made up. In statistics, we talk about estimands as “the conceptual thing we are trying to estimate with an estimator”. Here, we aren’t estimating anything – just computing. But, there’s still a concentual “thing we are trying to measure” and in this case, it’s our <em>tools</em> and not our <em>methods</em> that are imposing assumptions on that) to one that answers a fundamentally different question:</p>
<p>Instead of measuring “average monthly spend in Q1 by store”, we’re measuring “averaging monthly spend in Q1 by store <em>conditional on</em> there being spend”.</p>
<p>To obtain the correct result, one would write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> </span>
<span id="cb4-2">  store_id, </span>
<span id="cb4-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- wrong answers</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg</span>(amt_spend) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> wrong1,  </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(amt_spend) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(amt_spend) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> wrong2,</span>
<span id="cb4-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- right answers</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(amt_spend) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> right1,</span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(amt_spend, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> right2</span>
<span id="cb4-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> spend</span>
<span id="cb4-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">group</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">order</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">store_id</th>
<th style="text-align: right;">wrong1</th>
<th style="text-align: right;">wrong2</th>
<th style="text-align: right;">right1</th>
<th style="text-align: right;">right2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">99.60874</td>
<td style="text-align: right;">99.60874</td>
<td style="text-align: right;">66.40583</td>
<td style="text-align: right;">66.40583</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.68744</td>
<td style="text-align: right;">100.68744</td>
<td style="text-align: right;">100.68744</td>
<td style="text-align: right;">100.68744</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">99.63996</td>
<td style="text-align: right;">99.63996</td>
<td style="text-align: right;">99.63996</td>
<td style="text-align: right;">99.63996</td>
</tr>
</tbody>
</table>
</div>
<p>With a better understand of gross sales, the analyst might next proceed to compute net sales.</p>
<p>This first requires joining the <code>spend</code> and <code>returns</code> tables. Naively, they might attempt:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> </span>
<span id="cb5-2">  spend.<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>,</span>
<span id="cb5-3">  returns.amt_return</span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb5-5">  spend</span>
<span id="cb5-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span></span>
<span id="cb5-7">  returns </span>
<span id="cb5-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span></span>
<span id="cb5-9">  spend.store_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.store_id <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span></span>
<span id="cb5-10">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">STORE_ID</th>
<th style="text-align: right;">MONTH</th>
<th style="text-align: right;">AMT_SPEND</th>
<th style="text-align: right;">amt_return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.12011</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.31441</td>
<td style="text-align: right;">9.972159</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">99.67098</td>
<td style="text-align: right;">9.798444</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">98.39703</td>
<td style="text-align: right;">10.254347</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">102.27124</td>
<td style="text-align: right;">10.108880</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">100.20843</td>
<td style="text-align: right;">9.951398</td>
</tr>
</tbody>
</table>
</div>
<p>However, this once again fails. Why? Although SQL handled nulls “permissively” when aggregating a column, it took a stricted stance when making the comparison on <code>spend.store_id = returns.store_id</code> in the join clause. SQL doesn’t recognize different nulls as equal. To the extent than null means “I dunno” versus “The field is not relevant to this observation”, it’s reasonable that SQL should find it hard to decide whether two “I dunno”s are equal.</p>
<p>Once again, this isn’t a “random” or inconsequential error. Continuing to use this corrupted dataset changes the computand from “net sales by month” to “net sales by month at physical retail locations”.</p>
<p>To remedy this, we can force <code>store_id</code> to take on a value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span></span>
<span id="cb6-2">  spend.<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>,</span>
<span id="cb6-3">  returns.amt_return</span>
<span id="cb6-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb6-5">  spend</span>
<span id="cb6-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span></span>
<span id="cb6-7">  returns </span>
<span id="cb6-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(spend.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(returns.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span></span>
<span id="cb6-10">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">STORE_ID</th>
<th style="text-align: right;">MONTH</th>
<th style="text-align: right;">AMT_SPEND</th>
<th style="text-align: right;">amt_return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.12011</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.31441</td>
<td style="text-align: right;">9.972159</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.40517</td>
<td style="text-align: right;">10.071639</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">99.67098</td>
<td style="text-align: right;">9.798444</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">98.39703</td>
<td style="text-align: right;">10.254347</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">98.81231</td>
<td style="text-align: right;">9.881071</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">102.27124</td>
<td style="text-align: right;">10.108880</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">100.20843</td>
<td style="text-align: right;">9.951398</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.849277</td>
</tr>
</tbody>
</table>
</div>
<p>And next we proceed with computing sales by month net of returns across all stores:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span></span>
<span id="cb7-2">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>, </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(amt_spend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> amt_return) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> net_spend</span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb7-5">  spend</span>
<span id="cb7-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span></span>
<span id="cb7-7">  returns </span>
<span id="cb7-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(spend.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(returns.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span></span>
<span id="cb7-10">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span></span>
<span id="cb7-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">group</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">order</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">month</th>
<th style="text-align: right;">net_spend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">180.6758</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">266.9465</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">182.4194</td>
</tr>
</tbody>
</table>
</div>
<p>However, by now, you should not be surprised that this result is also incorrect. If we inspect the sequence of computations, we realize that SQL is also stricter in its null handing in <em>rowwise computations</em> than <em>column-wise aggregations</em>. The subtraction of <code>amt_spend</code> and <code>amt_return</code> obliterates the total when either is null. So, we fail to include the gross spend at Store 1 in January simply because there were no returns (and vice versa for Internet sales in March).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span></span>
<span id="cb8-2">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>, </span>
<span id="cb8-3">  spend.store_id,</span>
<span id="cb8-4">  amt_spend,</span>
<span id="cb8-5">  amt_return,</span>
<span id="cb8-6">  amt_spend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> amt_return <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> net_spend</span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb8-8">  spend</span>
<span id="cb8-9">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span></span>
<span id="cb8-10">  returns </span>
<span id="cb8-11">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span></span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(spend.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(returns.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span></span>
<span id="cb8-13">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">month</th>
<th style="text-align: right;">store_id</th>
<th style="text-align: right;">amt_spend</th>
<th style="text-align: right;">amt_return</th>
<th style="text-align: right;">net_spend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.12011</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">100.31441</td>
<td style="text-align: right;">9.972159</td>
<td style="text-align: right;">90.34225</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">100.40517</td>
<td style="text-align: right;">10.071639</td>
<td style="text-align: right;">90.33353</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.67098</td>
<td style="text-align: right;">9.798444</td>
<td style="text-align: right;">89.87254</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">98.39703</td>
<td style="text-align: right;">10.254347</td>
<td style="text-align: right;">88.14268</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">98.81231</td>
<td style="text-align: right;">9.881071</td>
<td style="text-align: right;">88.93124</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">102.27124</td>
<td style="text-align: right;">10.108880</td>
<td style="text-align: right;">92.16236</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">100.20843</td>
<td style="text-align: right;">9.951398</td>
<td style="text-align: right;">90.25704</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.849277</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
<p>A few ways to get the correct answer are shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span></span>
<span id="cb9-2">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>, </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(amt_spend,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(amt_return,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> right1,</span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(amt_spend) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(amt_return) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> right2</span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb9-6">  spend</span>
<span id="cb9-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span></span>
<span id="cb9-8">  returns </span>
<span id="cb9-9">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(spend.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coalesce</span>(returns.store_id, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span></span>
<span id="cb9-11">  spend.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span></span>
<span id="cb9-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">group</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">order</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">by</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">month</th>
<th style="text-align: right;">right1</th>
<th style="text-align: right;">right2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">280.7959</td>
<td style="text-align: right;">280.7959</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">266.9465</td>
<td style="text-align: right;">266.9465</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">172.5701</td>
<td style="text-align: right;">172.5701</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="observations" class="level2">
<h2 class="anchored" data-anchor-id="observations">Observations</h2>
<p>The preceding example hopefully illustrates a few points:</p>
<ul>
<li>Nulls can cause issues in the most basic of analyses</li>
<li>Beyond causing random or marginal errors, null handling changes the questions being answered</li>
<li>Even within a language, null handling may feel inconsistent (w.r.t. strictness) across different operations</li>
</ul>
<p>So, with that, let’s compare languages!</p>
</section>
<section id="comparison" class="level2">
<h2 class="anchored" data-anchor-id="comparison">Comparison</h2>
<p>Below, we compare how R, SQL, and python handle column aggregation, rowwise transformation, joining, and filtering.</p>
<section id="aggregation" class="level3">
<h3 class="anchored" data-anchor-id="aggregation">Aggregation</h3>
<p>SQL, as we saw before, simply ignores nulls in aggregation functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(x) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> sum_x, </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> n_null_x</span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> tbl</span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">sum_x</th>
<th style="text-align: right;">n_null_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<p>Built by and for statistician’s, R is scandalized at the very idea of attempting to do math with null columns. For aggregation functions, it returns <code>NA</code> as a form of protest should any entry of the vector provided be null. (This can be overridden with the <code>na.rm</code> parameter.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(x)</span>
<span id="cb11-3"></span>
<span id="cb11-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x)</span>
<span id="cb11-5">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(x))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When it comes to python, well, it depends. Base and <code>numpy</code> operations act more like R whereas <code>pandas</code> aggregation acts more like SQL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb13-3">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,np.nan]</span>
<span id="cb13-4">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb13-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>:x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>:y})</span>
<span id="cb13-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(x)</span>
<span id="cb13-7">np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(x)</span>
<span id="cb13-8">df.agg({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sum'</span>]})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nan
nan
       x
sum  3.0</code></pre>
</div>
</div>
</section>
<section id="transformation" class="level3">
<h3 class="anchored" data-anchor-id="transformation">Transformation</h3>
<p>All of SQL, R, and python return NA when <code>NA</code>s are used in atomic or rowwise transformations.</p>
<p>In SQL:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> z</span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> tbl</span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
<p>In R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb16-2">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)</span>
<span id="cb16-3"></span>
<span id="cb16-4">df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(df, x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)</span>
<span id="cb16-5">df</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In python:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">np.array(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.array(y)</span>
<span id="cb17-2">df.assign(z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> d: d.x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> d.y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([-2., -2., nan])
     x  y    z
0  1.0  3 -2.0
1  2.0  4 -2.0
2  NaN  5  NaN</code></pre>
</div>
</div>
</section>
<section id="joining" class="level3">
<h3 class="anchored" data-anchor-id="joining">Joining</h3>
<p>The situation with joins may feel like the opposite of aggregation. Here, R and python’s most popular data wrangling packages are more permissive than SQL.</p>
<p>As we saw in the case study, SQL does not match on nulls.</p>
<p>Consider <code>tbl1</code> and <code>tbl2</code> as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> tbl1</span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> tbl2</span></code></pre></div>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
<p>Attempts to join return no results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> tbl1.<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>, tbl2.Y </span>
<span id="cb21-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> </span>
<span id="cb21-3">  tbl1 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">inner</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">join</span> tbl2 </span>
<span id="cb21-4">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">on</span> </span>
<span id="cb21-5">  tbl1.A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tbl2.A <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> </span>
<span id="cb21-6">  tbl1.B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tbl2.B</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
<th style="text-align: left;">y</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
<p>In contrast, default behavior for base R’s <code>merge</code> and <code>dplyr</code> <em>does match</em> on nulls. (Although, either behavior can be altered with the <code>incomparables</code> or <code>na_matches</code> arguments, respectively.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb22-2">df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(df1, df2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>))</span>
<span id="cb22-4">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(df1, df2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>))</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
<th style="text-align: left;">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
<th style="text-align: left;">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Similarly, <code>pandas</code> also matches on nulls for joining.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb23-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb23-3">df1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, np.nan, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>]], columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>])</span>
<span id="cb23-4">df2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, np.nan, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>]], columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>])</span>
<span id="cb23-5">pd.merge(df1, df2, on <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   A   B     X      Y
0  1 NaN  True  False</code></pre>
</div>
</div>
<p><code>R</code> and <code>python</code>’s behavior here seems most surprising. One might expect joining to work the same as raw logical evaluation works. However, neither language “likes” null comparison in its raw form. Instead, the default behavior is intentionally altered in these higher-level joining functions.</p>
<p>In R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>In python:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">np.nan <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> np.nan</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>False</code></pre>
</div>
</div>
</section>
<section id="filtering" class="level3">
<h3 class="anchored" data-anchor-id="filtering">Filtering</h3>
<p>Finally, both SQL and R drop null records used in filtering statements since comparisons with these values are incapable of returning a TRUE/FALSE value that is used to subset the rows. In python, however, pandas does preserve nulls in filter conditions.</p>
<p>Using the same <code>tbl1</code> shown above, we can also confirm that SQL proactively drops nulls in where clauses where they cannot be readily compared to non-null values. This seems quite consistent with its behavior in the joining case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">select</span> A, B, X </span>
<span id="cb29-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">from</span> tbl1 </span>
<span id="cb29-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">where</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">a</th>
<th style="text-align: left;">b</th>
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
<p>Both base R and <code>dplyr</code> paradigms follow suit here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb30-2">df1[df1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb30-3">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df1, B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;">X</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p>However, bucking the trend, multiple approaches to subsetting <code>pandas</code> data will not drop nulls in filtering comparisons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">df1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, np.nan, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>]], columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>])</span>
<span id="cb31-2">df1[df1.B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb31-3">df1.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B != 1'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   A   B     X
0  1 NaN  True
   A   B     X
0  1 NaN  True</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In data computation and analysis, the devil is often in the details. It’s not breaking news that low-level reasoning on the careful handling of null values can jeopardize the resulting analyses. However, as analysts take on increasingly complex tasks and using a plehora of different tools, it’s more important than ever for both data producers and consumers to consider the choices they are making in encoding and handling these values across the stack.</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>python</category>
  <category>sql</category>
  <category>data</category>
  <category>data-disasters</category>
  <guid>https://emilyriederer.com/post/nulls-polyglot/index.html</guid>
  <pubDate>Mon, 05 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/nulls-polyglot/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Using databases with Shiny</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/shiny-db/index.html</link>
  <description><![CDATA[ 




<p>Shiny apps are R’s answer to building interface-driven applications that help expose important data, metrics, algorithms, and more with end-users. However, the more interesting work that your Shiny app allows users to do, the more likely users are to want to save, return to, and alter some of the ways that they interacted with your work.</p>
<p>This creates a need for <strong>persistent storage</strong> in your Shiny application, as opposed to the ephemeral in-memory of basic Shiny applications that “forget” the data that they generated as soon as the application is stopped.</p>
<p>Relational databases are a classic form of persistent storage for web applications. Many analysts may be familiar with <em>querying</em> relational databases to retrieve data, but <em>managing</em> a database for use with a web application is slightly more complex. You’ll find yourself needing to define tables, secure data, and manage connections. More importantly, you might worry about what things that you do not know you should be worrying about.</p>
<p>This post provides some tips, call-outs, and solutions for using a relational database for persistent storage with Shiny. In my case, I rely on a Shiny app built with the <a href="https://thinkr-open.github.io/golem/"><code>golem</code> framework</a> and served on the Digital Ocean App platform.</p>
<section id="databases-options-for-storage" class="level2">
<h2 class="anchored" data-anchor-id="databases-options-for-storage">Databases &amp; Options for Storage</h2>
<p>Dean Attali’s <a href="https://deanattali.com/blog/shiny-persistent-data-storage/">blog post on persistent storage</a> compares a range of options for persistent storage including databases, S3 buckets, Google Drive, and more.</p>
<p>For my application, I anticipated the need to store and retrieve sizable amounts of structured data, so using a relational database seemed like a good option. Since I was hosting my application on <a href="https://m.do.co/c/6c5fdc198503">Digital Ocean App Platform</a>, I could create a <a href="https://www.digitalocean.com/products/managed-databases/">managed Postgres database</a> with just a few button clicks. As I share in the “Key Issues” section, this solution offers some significant benefits in terms of security.</p>
<p>For more information on different options for hosting Shiny apps and some insight into why I chose Digital Ocean, check out Peter Solymos’ excellent blog on <a href="https://hosting.analythium.io/">Hosting Data Apps</a>.</p>
</section>
<section id="talking-to-your-database-through-shiny" class="level2">
<h2 class="anchored" data-anchor-id="talking-to-your-database-through-shiny">Talking to your database through Shiny</h2>
<p>General information on working with databases with R is included on RStudio’s <a href="https://db.rstudio.com/">excellent website</a>. Below, I focus on a few topics specific to databases with Shiny, Shiny apps built in the <code>{golem}</code> framework, and Shiny apps served on Digital Ocean in particular.</p>
<section id="creating-a-database" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-database">Creating a database</h3>
<p>To create a database for my application in DigitalOcean, I simply went to:</p>
<p><code>Settings &gt; Add Component &gt; Database</code></p>
<p>This creates a fully-managed Postgres databases so you do not have to thing a ton about the underlying set-up or configuration.</p>
<p>At the time on writing, I was able to add a 1GB Dev Database for /$7 / month. For new users, DigitalOcean offers a generous number of free credits for use in the first 60 days. For a more mature product, one can add or switch to a production-ready Managed Database.</p>
<p>After a few minutes, the database has launched and its Connection Parameters are provided, which look something like this:</p>
<pre><code>host     : abc.b.db.ondigitalocean.com
port     : 25060
username : db
password : abc123
database : db
sslmode  : require</code></pre>
<p>By default, the Dev Database registers your application as a Trusted Source, meaning that only traffic from the application can attempt to access the database. As the <a href="https://docs.digitalocean.com/products/databases/postgresql/how-to/secure/#firewalls">documentation</a> explains, this type of firewall improves security by preventing against brute-force password or denial-of-service attacks from the outside.</p>
<p><em>Note: If you just want to experiment with databases and Shiny but aren’t using an in-production, served application, you can mostly skip this step and use the “Dev” approach that is discuss in “Dev versus Prod” subsection of “Key Issues” below.</em></p>
</section>
<section id="connecting-to-the-database" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-the-database">Connecting to the database</h3>
<p>We can use the connection parameters provided to connect to the database using R’s <code>DBI</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Postgres</span>(),</span>
<span id="cb2-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">host   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aabc.b.db.ondigitalocean.com"</span>,</span>
<span id="cb2-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb2-4">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user      =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb2-5">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">password  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>,</span>
<span id="cb2-6">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port     =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25060</span>)</span></code></pre></div>
</div>
<p>We will talk about ways to not hardcode one’s password in the last section.</p>
</section>
<section id="creating-tables" class="level3">
<h3 class="anchored" data-anchor-id="creating-tables">Creating tables</h3>
<p>Next, you can set up tables in your database that your application will require.</p>
<p>If you know SQL DDL, you can write a <a href="https://www.tutorialspoint.com/sql_certificate/using_ddl_statements.html">CREATE TABLE statement</a> which defines a tables names, fields, and data types. However, this can feel verbose or uncomfortable to analysts who mostly use DML (e.g.&nbsp;<code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>).</p>
<p>Fortunately, you can also define a table using R’s <code>DBI</code> package. First, create a simple dataframe with a single record to help R infer the appropriate and expected data types. Then pass the first <em>zero</em> rows of the table (essentially, only the schema) to <code>DBI::dbCreateTable()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-01"</span>))</span>
<span id="cb3-2">DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbCreateTable</span>(con, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fields =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>
</div>
<p>To prove that this works, I show a “round trip” of the data using an in-memory SQLite database. Note that this is <em>not</em> an option for persistent storage because in-memory databases are not persistent. This is only to “prove” that this approach can create database tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">con_lite <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb4-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-01"</span>))</span>
<span id="cb4-3">DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbCreateTable</span>(con_lite, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fields =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb4-4">DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbListTables</span>(con_lite)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "my_data"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbReadTable</span>(con_lite, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_data"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] x y z
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>But where should you run this script? You do <em>not</em> want to put this code in your app to run every time the app launches, but we just limited database traffic to the app so we cannot run it locally. Instead, you can run this code from the app’s <a href="https://docs.digitalocean.com/products/app-platform/concepts/console/">console</a>. (Alternatively, if you upgrade to a Managed Database, I believe you can also whitelist your local IP as another trusted source.)</p>
</section>
<section id="forming-the-connection-within-your-app" class="level3">
<h3 class="anchored" data-anchor-id="forming-the-connection-within-your-app">Forming the connection within your app</h3>
<p>Once your database is set-up and ready to go, you can begin to integrate it into your application.</p>
<p>I was using the <a href="https://thinkr-open.github.io/golem/"><code>golem</code> framework</a> for my application, so I connected to the database and made the initial data pull by adding the following lines in my top-level <code>app_server.R</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">db_con</span>()</span>
<span id="cb8-2">tbl_init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbReadTable</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_data"</span>)</span></code></pre></div>
</div>
<p>The custom <code>db_con()</code> function contains <em>roughly</em> the <code>DBI::dbConnect()</code> code we saw above, but I turned it into a function to incorporate some added complexity which I will describe shortly.</p>
<p>Most of the rest of my application uses Shiny modules, and this connection object and initial data pull can be seamless passed into either.</p>
<p>To see similar code in a full app, check out Colin Fay’s <a href="https://github.com/ColinFay/golemexamples/blob/master/golemqlite/R/app_server.R#L7"><code>golemqlite</code></a> project on Github.</p>
</section>
<section id="crud-operations" class="level3">
<h3 class="anchored" data-anchor-id="crud-operations">CRUD operations</h3>
<p>CRUD operations (Create, Read, Update, Delete) are at the heart of any interactive application with persistent data storage.</p>
<p>Interacting with your database within Shiny begins to look like more rote Shiny code. I do not describe this process in much detail since it is quite specific to what your app is trying to accomplish, but <a href="https://www.tychobra.com/posts/2020-01-29-shiny-crud-traditional/">this blog post</a> provides some nice examples.</p>
<p>In short:</p>
<ul>
<li>To add records to the table, you can use <code>DBI::dbAppendTable()</code></li>
<li>To remove records from the table, you can construct a <code>DELETE FROM my_data WHERE &lt;conditions&gt;</code> statement and run it with <code>DBI::dbExecute()</code></li>
</ul>
<p>Some cautions on the second piece are included in the “Key Issues” section.</p>
</section>
</section>
<section id="key-issues" class="level2">
<h2 class="anchored" data-anchor-id="key-issues">Key Issues</h2>
<p>Adding a permanent data store to your application can open up a lot of exciting new functionality. However, it may create some challenges that your typical data analyst or Shiny developer has not faced before. In this last section, I highlight a few key issues that you should be aware of and provide some recommendations.</p>
<section id="securing-data-transfer" class="level3">
<h3 class="anchored" data-anchor-id="securing-data-transfer">Securing data transfer</h3>
<p>Already, we have one safeguard in place for data security since our application is the only Trusted Source able to interface with our database.</p>
<p>But, just like we secure our database credentials, it becomes important to think about securing the database itself. This is made easy with DigitalOcean because data is <a href="https://docs.digitalocean.com/products/databases/">end-to-end encrypted</a>, but depending on how or by whom your data is managed, this is something to bear in mind.</p>
</section>
<section id="securing-database-credentials" class="level3">
<h3 class="anchored" data-anchor-id="securing-database-credentials">Securing database credentials</h3>
<p>No matter how safe the data itself is, it still may be at risk if anyone can obtain our database credentials.</p>
<p>Previously, I demonstrated how to connect to a database from R like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Postgres</span>(),</span>
<span id="cb9-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">host   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aabc.b.db.ondigitalocean.com"</span>,</span>
<span id="cb9-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb9-4">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user      =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb9-5">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">password  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>,</span>
<span id="cb9-6">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port     =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25060</span>)</span></code></pre></div>
</div>
<p>However, you should never ever put your password in plaintext like this. Instead, you can use <em>environment variables</em> to store the value of sensitive credentials like a password or even a username like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Postgres</span>(),</span>
<span id="cb10-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">host   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aabc.b.db.ondigitalocean.com"</span>,</span>
<span id="cb10-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb10-4">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user      =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb10-5">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">password  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>),</span>
<span id="cb10-6">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port     =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25060</span>)</span></code></pre></div>
</div>
<p>Then, you can define that same environment variable more securely in <a href="https://docs.digitalocean.com/products/app-platform/how-to/use-environment-variables/">within the App Platform</a>.</p>
</section>
<section id="securing-input-integrity-sql-injection" class="level3">
<h3 class="anchored" data-anchor-id="securing-input-integrity-sql-injection">Securing input integrity (SQL injection)</h3>
<p>Finally, it’s also important to be aware of <a href="https://www.w3schools.com/sql/sql_injection.asp">SQL injection</a> to ensure that your database does not get corrupted.</p>
<p>SQL injection is usually discussed in the concept of malicious attacks. For example, W3 schools shows the following example where an application could be tricked into providing data on <em>all</em> users instead of a single user:</p>
<pre><code>txtUserId = getRequestString("UserId");
txtSQL = "SELECT * FROM Users WHERE UserId = " + txtUserId;</code></pre>
<p>If the entered <code>UserId</code> is <code>"UserId = 105 OR 1=1"</code>, then the full SQL string will be <code>"SELECT * FROM Users WHERE UserId = 105 OR 1=1;"</code>.</p>
<p>SQL injection is also at jokes you make have heard about “little Bobby Drop Tables” (<a href="https://xkcd.com/327/">xkcd</a>).</p>
<p><img src="https://emilyriederer.com/post/shiny-db/https:/imgs.xkcd.com/comics/exploits_of_a_mom.png" class="img-fluid"></p>
<p>That joke also, in some odd way, highlights that SQL injection need not be malicious. Rather, whenever we have software opened up to users beyond ourselves, they will likely use it in unexpected ways that push the system to its limit. For example, a user might try to enter or remove values from our database with double quotes, semicolons, or other features that mean something different to SQL than in human parlance and corrupt the code. Regardless of intent, we can protect against bad SQL that will break our application by using the <code>DBI::sqlInterpolate()</code> function.</p>
<p>A demonstration of this function and how it can protect against bad query generation is shown in <a href="https://shiny.rstudio.com/articles/sql-injections.html">this post</a> by RStudio.</p>
</section>
<section id="dev-versus-prod" class="level3">
<h3 class="anchored" data-anchor-id="dev-versus-prod">Dev versus Prod</h3>
<p>However, you may have realized a flaw in this approach. Our entire app now depends on forming a connection <em>that can only be made by the in-production app.</em> This meams you cannot test your application locally. However, even if our local traffic was not categorically blocked, we wouldn’t <em>want</em> to test our app on the production database and recklessly add and remove entries.</p>
<p>Instead, we would ideally have <em>separate</em> databases: one for development and one for production. Ideally, these would be the same type of database (e.g.&nbsp;both Postgres) to catch nuances of different SQL syntax and database operations. However, to keep things simpler (and cheaper), I decided to use an in-memory SQLite database locally.</p>
<p>To accomplish this, I wrapped my database connection in a custom <code>db_con()</code> function that checks if the app is running in development or production (using <code>golem::app_prod()</code> which in turn checks the <code>R_CONFIG_ACTIVE</code> environment variable) and connects to different databases in either case. In the development case, it creates an in-memory SQLite database and remakes the empty table.</p>
<p>(Another alternative to creating the database on-the-fly is to <a href="https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html#Creating_a_new_SQLite_database">pre-make a SQLite database</a> saved to a <code>.sqlite</code> file and connect to that. But for this example, my sample table is so simple, creating it manually takes a negligible amount of time and keeps things quite readable, so I left it as-is.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">db_con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prod =</span> golem<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app_prod</span>()) {</span>
<span id="cb12-2">  </span>
<span id="cb12-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (prod) {</span>
<span id="cb12-4">    </span>
<span id="cb12-5">    con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RPostgres<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Postgres</span>(),</span>
<span id="cb12-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">host   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc.b.db.ondigitalocean.com"</span>,</span>
<span id="cb12-7">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb12-8">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user      =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"db"</span>,</span>
<span id="cb12-9">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">password  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>),</span>
<span id="cb12-10">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port     =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25060</span>)</span>
<span id="cb12-11">    </span>
<span id="cb12-12">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb12-13">    </span>
<span id="cb12-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopifnot</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RSQLite"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quietly =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) )</span>
<span id="cb12-15">    con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb12-16">    df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-01"</span>))</span>
<span id="cb12-17">    DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbWriteTable</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_data"</span>, df)</span>
<span id="cb12-18">    </span>
<span id="cb12-19">  }</span>
<span id="cb12-20">  </span>
<span id="cb12-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(con)</span>
<span id="cb12-22">  </span>
<span id="cb12-23">}</span></code></pre></div>
</div>
</section>
<section id="managing-connections" class="level3">
<h3 class="anchored" data-anchor-id="managing-connections">Managing connections</h3>
<p>So, you’ve built a robust app that can run against a database locally or on your production server. Great! It’s time to share your application with the world. But what if it is <em>so</em> popular that you have a lot of concurrent users and they are all trying to work with the database at once?</p>
<p>To maintain good application performance, you have to be careful about managing the database connection objects that you create (with <code>DBI::dbConnect()</code>) and to close them when you are doing using them.</p>
<p>If this sounds manual and tedious, you’re in luck! The <a href="https://rstudio.github.io/pool/">{pool}</a> package adds a layer of abstraction to manage a <em>set</em> of connections and execute new queries to an available idle collection. Full examples are given on the package’s website, but in short <code>{pool}</code> is quite easy to implement due to it’s <code>DBI</code>-like syntax. You can replace <code>DBI::dbConenct()</code> with <code>pool::dbPool()</code> and proceed as usual!</p>


</section>
</section>

 ]]></description>
  <category>rstats</category>
  <category>shiny</category>
  <category>data</category>
  <guid>https://emilyriederer.com/post/shiny-db/index.html</guid>
  <pubDate>Sun, 02 Jan 2022 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/shiny-db/featured.png" medium="image" type="image/png" height="107" width="144"/>
</item>
<item>
  <title>How to Make R Markdown Snow</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/snow/index.html</link>
  <description><![CDATA[ 




<p>Last year, I tweeted about how to spread holiday cheer by letting your R Markdown documents snow. After all, what better to put people in the holiday spirit than to add a random 5% probability that whatever part of a document they are trying to read will be covered?</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
No one:<br><br>Absolutely no one:<br><br>Me: SO, I know we can't have a holiday party this year, but we CAN make our <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> R Markdown reports snow before we send them to each other <a href="https://t.co/SSBzlgb3TV">https://t.co/SSBzlgb3TV</a><br>HT to <a href="https://t.co/c7c5c5csMK">https://t.co/c7c5c5csMK</a> for the heavy lifting <a href="https://t.co/hIu7z0knR4">pic.twitter.com/hIu7z0knR4</a>
</p>
— Emily Riederer (<span class="citation" data-cites="EmilyRiederer">@EmilyRiederer</span>) <a href="https://twitter.com/EmilyRiederer/status/1337178684868980738?ref_src=twsrc%5Etfw">December 10, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I make no promises that this will amuse your recipients, but at least it seemed to strike a cord with other R Markdown creators. This year, I decided to write it up step-by-step. As silly as the example is, I think it demonstrates (through slight abuse) some useful features of R Markdown. Much like ice sculpting, we will apply the powertool that is R Markdown to achieve our rather fanciful end.</p>
<p>If you want to skip the discussed, you can check out the <a href="https://github.com/emilyriederer/demo-rmd-snow">full project</a>, the main <a href="https://github.com/emilyriederer/demo-rmd-snow/blob/main/index.html">R Markdown file</a>, or the <a href="https://emilyriederer.github.io/demo-rmd-snow/">rendered output</a>. The rendered output is also shown below:</p>
<p><img src="https://emilyriederer.com/post/snow/featured.gif" class="img-fluid"></p>
<p>In the rest of this post, I’ll touch on three R Markdown tricks and their fanciful uses:</p>
<ul>
<li><strong>Using child documents…</strong> to add snowflake</li>
<li><strong>Including raw HTML and custom CSS style…</strong> to animate them</li>
<li><strong>Evaluating chunks conditionally…</strong> to keep things seasonal</li>
</ul>
<p>We will see how to dress up this <a href="https://github.com/emilyriederer/demo-rmd-snow/blob/main/index.Rmd">very important business R Markdown</a></p>
<p>Much more useful applications of these same features are discussed in the linked sections of the <a href="https://bookdown.org/yihui/rmarkdown-cookbook/">R Markdown Cookbook</a>.</p>
<section id="child-documents" class="level2">
<h2 class="anchored" data-anchor-id="child-documents">Child documents</h2>
<p><a href="https://bookdown.org/yihui/rmarkdown-cookbook/child-document.html">Child documents</a> allow R Markdown authors to combine multiple R Markdown files into a single final output rendered in a consistent environment. This helps create a more manageable, modular workflow if you are working on a long project or anaylsis with many distinct parts or if there are some pieces of boilerplate text or analysis that you wish to inject into many projects.</p>
<p>To add child documents, we create an empty R code chunk, and use the <code>child</code> chunk option to pass the path to the R Markdown file that we wish to include. In our case, we reference our <code>snow.Rmd</code> file.</p>
<pre><code>```{r child = "snow.Rmd"}`r ''`
```</code></pre>
<p>Of course, since child documents are functionally the same as including files in the same document, we could have included this material in the same file. However, since snowflakes should clearly only be placed in <em>very</em> important documents, it is good to use best practices and take a modular approach. Tactically, this also makes it easier to “turn them on an off” at will or swap them our for New Years fireworks, Valentine’s Day hearts, and more.</p>
</section>
<section id="including-html-and-css" class="level2">
<h2 class="anchored" data-anchor-id="including-html-and-css">Including HTML and CSS</h2>
<p>So, what is in the <a href="https://github.com/emilyriederer/demo-rmd-snow/blob/main/snow.Rmd"><code>snow.Rmd</code></a> file?</p>
<p>First, we have to bring in the snowflakes themselves.</p>
<pre><code>&lt;div class="snowflakes" aria-hidden="true"&gt;
  &lt;div class="snowflake"&gt;
  ❅
  &lt;/div&gt;
  &lt;!-- many more snowflakes... --&gt;
&lt;/div&gt;</code></pre>
<p>Because this R Markdown will render to an HTML document, we are free to include raw HTML text the same way we include narrative, English-language text. Here, I wrap unicode snowflakes in <code>&lt;divs&gt;</code> so I can attach CSS classes to them.</p>
<p>Similarly, R Markdowns that will be rendered to HTML can use all the benefits of web technology like CSS and JavaScript. <a href="https://bookdown.org/yihui/rmarkdown-cookbook/html-css.html">Custom CSS</a> can be included either with the <code>css</code> language engine or a reference in the YAML header to an external <code>.css</code> file. For compactness, I go with the former.</p>
<p>A <code>css</code> chunk adds CSS code used to animate the snowflake divs. This is taken nearly verbatim from <a href="https://codepen.io/codeconvey/pen/xRzQay">this CodePen</a>. Since this is rather lengthy, we can also use the <code>echo = FALSE</code> chunk option to not output all of the CSS in our final document.</p>
<pre><code>```{css echo = FALSE}`r ''`
&lt;&lt;css goes here&gt;&gt;
```</code></pre>
<p>For more tips on writing CSS for R Markown, check out my <a href="../../post/rmarkdown-css-tips/">post</a> on finding the right selectors.</p>
</section>
<section id="conditional-chunk-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="conditional-chunk-evaluation">Conditional chunk evaluation</h2>
<p>The above two tricks are as for as my demo goes since I only planned to render it once. However, if you are creating automated reports and fear your recipients have limited patience for animated snowflakes, we can also use R Markdown <a href="https://yihui.org/knitr/options/">chunk options</a> with <a href="https://bookdown.org/yihui/rmarkdown-cookbook/chunk-variable.html">variables as arguments</a> to only allow these snowflakes to appear during a certain time period.</p>
<p>So, for example instead of:</p>
<pre><code>```{r child = "snow.Rmd"}`r ''`
```</code></pre>
<p>We might type:</p>
<pre><code>```{r child = "snow.Rmd", eval = (substr(Sys.Date(), 6, 7) == 12)}`r ''`
```</code></pre>
<p>To only allow the child document to be included in December.</p>
<p>If we had chosen not to use child documents, we could also use chunks to achieve conditional evaluation using the <a href="https://bookdown.org/yihui/rmarkdown-cookbook/eng-asis.html"><code>asis</code> engine</a>.</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>rmarkdown</category>
  <guid>https://emilyriederer.com/post/snow/index.html</guid>
  <pubDate>Sat, 11 Dec 2021 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/snow/featured.gif" medium="image" type="image/gif"/>
</item>
<item>
  <title>UIUC STAT447 (Data Science Programming) Guest Lecture</title>
  <link>https://emilyriederer.com/talk/meetup-stat447/index.html</link>
  <description><![CDATA[ 



<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Quick Links</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Abstract</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">Slides</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">Video</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><span><i class="bi bi-file-bar-graph"></i> <a href="slides.pdf">Slides</a> </span><br>
<span><i class="bi bi-play"></i> <a href="https://www.youtube.com/watch?v=Q-6Bm0ADXQg">Video</a> </span></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>In this talk, I pulled from themes in my work on R Markdown Driven Development, innersource analytical tooling, and data science career pathing to help students understand the connections between their classroom learnings and “real world” data science work</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div id="slides" style="width:100%; aspect-ratio:16/11;">
<embed src="slides.pdf#zoom=Fit" width="100%" height="100%">
</div>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/Q-6Bm0ADXQg" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>



 ]]></description>
  <category>rstats</category>
  <category>workflow</category>
  <guid>https://emilyriederer.com/talk/meetup-stat447/index.html</guid>
  <pubDate>Wed, 17 Nov 2021 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/talk/meetup-stat447/featured.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Update: column-name contracts with dbtplyr</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/convo-dbt-update/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/convo-dbt-update/featured.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Diff of original dbt model using dbtplyr’s concise, declarative macros</figcaption>
</figure>
</div>
<p>Earlier this year, I wrote about <a href="https://www.emilyriederer.com/post/convo-dbt/">embedding column-name contracts in data pipelines with dbt</a>. This, in turn, built off my post regarding the general theory of <a href="https://www.emilyriederer.com/post/column-name-contracts/">using controlled vocabularies to define data models</a>.</p>
<p>The general idea of the post was:</p>
<ul>
<li>Column names are the “user interface” between data producers and consumers</li>
<li>Standardizing a controlled vocabulary of naming “keywords” can communicate semantics and type information</li>
<li>These names can then be operated on in code and aid in automated documentation, testing, and transformation</li>
</ul>
<p>My first post illustrated these concepts using packages from R’s <code>tidyverse</code>. This suite of packages has an expressive, declarative API that inadvertently shaped a lot of my thinking around “naming things”. Clever naming schemes make things <em>just work</em>. The latter, as the name suggests, used <code>SQL</code> and <code>dbt</code>. While this too proved effective, it felt less elegant and satisfying. This inspired me: what if more <code>dplyr</code> syntax existed in <code>dbt</code>?</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>This inspired the creation of the <code>dbtplyr</code> dbt package (find it on <a href="https://github.com/emilyriederer/dbtplyr">GitHub</a>). This package aims to port the semantic sugar of <code>dplyr</code>’s <code>select-helpers</code> and related functionality to <code>dbt</code> to support both controlled vocabularies and, more broadly, more concise and semantic code.</p>
<p>A full explanation is provided below. Additionally, for those that have read the previous post, I have also rewritten my COVID data modeling example to use the macros available in <code>dbtplyr</code>. Comparing the <a href="https://github.com/emilyriederer/dbt-convo-covid/pull/2/files">diff of the <code>model_monitor</code> model between the two versions</a> illustrates how <code>dbtplyr</code>’s semantic sugar creates more concise and readable templating code.</p>
</section>
<section id="introducing-dbtplyr" class="level2">
<h2 class="anchored" data-anchor-id="introducing-dbtplyr">Introducing dbtplyr</h2>
<p>To paraphrase the <code>README</code>:</p>
<p>This add-on package enhances <code>dbt</code> by providing macros which programmatically select columns based on their column names. It is inspired by the <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/"><code>across()</code> function</a> and the <a href="https://tidyselect.r-lib.org/reference/select_helpers.html"><code>select helpers</code></a> in the R package <code>dplyr</code>.</p>
<p><code>dplyr</code> (&gt;= 1.0.0) has helpful semantics for selecting and applying transformations to variables based on their names. For example, if one wishes to take the <em>sum</em> of all variables with name prefixes of <code>N</code> and the mean of all variables with name prefixes of <code>IND</code> in the dataset <code>mydata</code>, they may write:</p>
<pre><code>summarize(
  mydata, 
  across( starts_with('N'), sum),
  across( starts_with('IND', mean)
)</code></pre>
<p>This package enables us to similarly write <code>dbt</code> data models with commands like:</p>
<pre><code>{% set cols = dbtplyr.get_column_names( ref('mydata') ) %}
{% set cols_n = dbtplyr.starts_with('N', cols) %}
{% set cols_ind = dbtplyr.starts_with('IND', cols) %}

select

  {{ dbtplyr.across(cols_n, "sum({{var}}) as {{var}}_tot") }},
  {{ dbtplyr.across(cols_ind, "mean({{var}}) as {{var}}_avg") }}

from {{ ref('mydata') }}</code></pre>
<p>which <code>dbt</code> then compiles to standard SQL.</p>
<p>Alternatively, to protect against cases where no column names matched the pattern provided (e.g.&nbsp;no variables start with <code>n</code> so <code>cols_n</code> is an empty list), one may instead internalize the final comma so that it is only compiled to SQL when relevant by using the <code>final_comma</code> parameter of <code>across</code>.</p>
<pre><code>  {{ dbtplyr.across(cols_n, "sum({{var}}) as {{var}}_tot", final_comma = true) }}</code></pre>
<p>Note that, slightly more <code>dplyr</code>-like, you may also write:</p>
<pre><code>select

  {{ dbtplyr.across(dbtplyr.starts_with('N', ref('mydata')), "sum({{var}}) as {{var}}_tot") }},
  {{ dbtplyr.across(dbtplyr.starts_with('IND', ref('mydata')), "mean({{var}}) as {{var}}_avg") }}

from {{ ref('mydata') }}</code></pre>
<p>But, as each function call is a bit longer than the equivalent <code>dplyr</code> code, I personally find the first form more readable.</p>
<p>The complete list of macros included are:</p>
<p><strong>Functions to apply operation across columns</strong></p>
<ul>
<li><code>across(var_list, script_string, final_comma)</code></li>
<li><code>c_across(var_list, script_string)</code></li>
</ul>
<p><strong>Functions to evaluation condition across columns</strong></p>
<ul>
<li><code>if_any(var_list, script_string)</code></li>
<li><code>if_all(var_list, script_string)</code></li>
</ul>
<p><strong>Functions to subset columns by naming conventions</strong></p>
<ul>
<li><code>starts_with(string, relation or list)</code></li>
<li><code>ends_with(string, relation or list)</code></li>
<li><code>contains(string, relation or list)</code></li>
<li><code>not_contains(string, relation or list)</code></li>
<li><code>one_of(string_list, relation or list)</code></li>
<li><code>not_one_of(string_list, relation or list)</code></li>
<li><code>matches(string, relation)</code></li>
<li><code>everything(relation)</code></li>
<li><code>where(fn, relation)</code> where <code>fn</code> is the string name of a <a href="https://docs.getdbt.com/reference/dbt-classes/#column">Column type-checker</a> (e.g.&nbsp;“is_number”)</li>
</ul>
<p>Note that all of the select-helper functions that take a relation as an argument can optionally be passed a list of names instead.</p>
<p>Documentation for these functions is available on the <a href="https://emilyriederer.github.io/dbtplyr/">package website</a> and in the <a href="https://github.com/emilyriederer/dbtplyr/blob/main/macros/macro.yml"><code>macros/macro.yml</code></a> file.</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>dbt</category>
  <guid>https://emilyriederer.com/post/convo-dbt-update/index.html</guid>
  <pubDate>Tue, 21 Sep 2021 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/convo-dbt-update/featured.PNG" medium="image"/>
</item>
<item>
  <title>A lightweight data validation ecosystem with R, GitHub, and Slack</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/data-valid-lightweight/index.html</link>
  <description><![CDATA[ 




<p>Data quality monitoring is an essential part of any data analysis or business intelligence workflow. As such, an increasing number of promising tools<sup>1</sup> have emerged as part of the <a href="https://moderndatastack.xyz/">Modern Data Stack</a> to offer better orchestration, testing, and reporting.</p>
<p>Although I’m very excited about the developments in this space, I realize that emerging products may not be the best fit for every organization. Enterprise tools can be financial costly, and, more broadly, even free and open-source offerings bring costs in the time and risks associated with vetting tools for security, training associates, and committing to potential lock-in of building workflows around these tools. Additionally, data end-users may not always have the ability to get far enough “upstream” in the production process of their data to make these tools make sense.</p>
<p>“Right-sizing” technology to the problem at hand is a critical task. A “best” solution with the most polished, professional, exciting product isn’t always the best <em>fit</em> for your needs. Trade-offs must be made between feature completeness and fit-for-purpose. In other words, sometimes its more important for technology to be <em>“good enough”</em>.<sup>2</sup></p>
<p>Additionally, in an embarassment of riches of developer tools, sometimes the number of tools (no matter how good) we have to work with can become a burden. Personally, I like to leverage a core set of tools like Slack and GitHub for as many of their strengths when possible instead of allowing a creep of many different project-specific communication and project management tools.</p>
<p>With all of that in mind, in this post I explore a lightweight approach to a data quality workflow using a minimal set of tools that are likely already part of many team’s data stacks: R, GitHub, and Slack. This approach may be far from perfect, but I believe it provides a lot of “bang for the buck” by enabling scheduling data quality monitoring, instantaneous alerting, and workflow management at little-to-no incremental overhead.</p>
<p>The full code for this demo is available in my <a href="https://github.com/emilyriederer/data-validation-demo">emilyriederer/data-validation-demo</a> repo on GitHub.</p>
<section id="overall-workflow" class="level2">
<h2 class="anchored" data-anchor-id="overall-workflow">Overall Workflow</h2>
<p>To think about right-sizing, it’s first useful to think about what features from some of the “hot” data quality monitoring products make them so appealing. Key features and tradeoffs include:</p>
<ul>
<li><strong>Always-on monitoring</strong>: Monitoring any time data is loaded or changed (or preferably <em>before</em> – such as dbt’s dev schemas and Great Expectation’s in-pipeline integration)</li>
<li><strong>Reporting</strong>: Dashboards or tools to review outputs of data validation</li>
<li><strong>Alerting</strong>: Proactive logging and alerting of failures of data validation checks</li>
<li><strong>Integration in data production process</strong>: As alluded to in the “always-on” point, the more validation is not just a passive activity but part of data production itself the better (e.g.&nbsp;preventing bad data from being loaded)</li>
</ul>
<p>This approach makes some tradeoffs. It’s not orchestrated or trigger-based but can be scheduled to run on a regular basis. It’s also loosely-coupled with data production, but as we will see it can still support a better GitHub-based workflow for seeing issues through to resolution.</p>
<p>The basic idea of this workflow is to recreate as many of these strengths as possibly by maximally leveraging the strengths of existing tools. We use each for what its already good at, including:</p>
<ul>
<li><strong>R</strong>:
<ul>
<li>Data validation with the <a href="https://rich-iannone.github.io/pointblank/"><code>pointblank</code> package</a> can be run directly or “outsourced” upstream to run in-place in a database (if that is where your data lives)</li>
<li>Validation failures are logged as GitHub issues using the <a href="https://emilyriederer.github.io/projmgr/"><code>projmgr</code> package</a></li>
<li>A more aesthetic version of data quality reporting output is produced by running the above steps by rendering an <strong>R Markdown</strong> document to HTML</li>
</ul></li>
<li><strong>GitHub</strong>: Serves as the central nervous system for execution, project management, and reporting
<ul>
<li><strong>Actions</strong>: Reruns the <code>pointblank</code> checks on a regular basis and updates an RMarkdown-based website</li>
<li><strong>Pages</strong>: Hosts the resultings RMarkdown-generated HTML for accessible data quality reporting</li>
<li><strong>Issues</strong>: Record data quality errors caught by <code>pointblank</code>. This provides an easy platform to assign owners, discuss issues, and track progress. With detailed labels, closed issues can also serve as a way to catalog past errors and identify trends or needed areas of improvement (where repeat failures occur)</li>
</ul></li>
<li><strong>Slack</strong>: Integrates with GitHub to provide alerts on new issues on a Slack channel. Individual teams or team members can use Slack’s controls to determine how they receive notifications (e.g.&nbsp;email, mobile notification, etc.) for time-sensitive issues</li>
</ul>
<p>Intrigued? Next we’ll step through the technical details.</p>
</section>
<section id="detailed-implementation" class="level2">
<h2 class="anchored" data-anchor-id="detailed-implementation">Detailed Implementation</h2>
<p>This workflow revolves around a single main R Markdown document. The full version can be found <a href="https://github.com/emilyriederer/data-validation-demo/blob/master/data-valid-pipe.Rmd">on GitHub</a>, and we will step through key components of the code and its interaction with the GitHub and Slack platforms below.</p>
<section id="validating-data-with-pointblank" class="level3">
<h3 class="anchored" data-anchor-id="validating-data-with-pointblank">Validating data (with <code>pointblank</code>)</h3>
<p><img src="https://emilyriederer.com/post/data-valid-lightweight/report.PNG" class="img-fluid"></p>
<p>The first key step is setting up validation with <code>pointblank</code>. Here, I show a minimal example which uses a very small toy dataset. However, <code>pointblank</code> can also connect to a number of remote datasources like databases and run these checks on the data in-place<sup>3</sup> The following example just runs a few checks for data ranges, nulls, and duplicates although a wide array of premade and customizable checks are available.</p>
<p>Out of the box, we can produce an aesthetic table of validation results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb1-2">act <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">action_levels</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warn_at =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notify_at =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stop_at =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb1-3">table_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my_table"</span></span>
<span id="cb1-4">agent <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_agent</span>(tbl, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">actions =</span> act) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_not_null</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rows_distinct</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(x,y))</span>
<span id="cb1-9">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interrogate</span>(agent)</span>
<span id="cb1-10">res</span></code></pre></div>
</div>
</section>
<section id="posting-results-as-github-issues-with-projmgr" class="level3">
<h3 class="anchored" data-anchor-id="posting-results-as-github-issues-with-projmgr">Posting results as GitHub issues (with <code>projmgr</code>)</h3>
<p><img src="https://emilyriederer.com/post/data-valid-lightweight/issues.PNG" class="img-fluid"></p>
<p>Beyond <code>pointblank</code>’s aesthetic output, we can also extract an underlying dataframe with all of the check information include which columns were included in the check, a human-readable description of the check, and the failure rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-2">  res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>validation_set <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(warn) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(columns_expr, brief, column, n, n_failed, f_failed) </span></code></pre></div>
</div>
<p>With this information, we can use <code>projmgr</code> to connect to a GitHub repository<sup>4</sup>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">repo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_repo_ref</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"emilyriederer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data-validation-demo"</span>)</span></code></pre></div>
</div>
<p>The full data wrangling steps are shown in the <a href="https://github.com/emilyriederer/data-validation-demo/blob/master/data-valid-pipe.Rmd">R Markdown</a>, but after light data wrangling of the output dataset (<code>out</code>) to convert validation results into a title, description, and labels, we can post these issues to our repository.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">issue_numbers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(issues_df, </span>
<span id="cb4-2">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">possibly</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">post_issue</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref =</span> repo, ...), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">otherwise =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb4-3">                      )</span></code></pre></div>
</div>
<p>This creates the two issues shown above with labels for each table and variable.</p>
<p>The full R Markdown also shows how this collection of issues can also be pulled back into the resulting report to provide context on the status of each issue such as whether it has been assigned to an owner and the number of comments it has.</p>
</section>
<section id="running-on-github-actions" class="level3">
<h3 class="anchored" data-anchor-id="running-on-github-actions">Running on GitHub Actions</h3>
<p>Of course, monitoring isn’t useful if it doesn’t run and detect new errors at a reasonable cadence. One way to run this report regularly is using <a href="https://github.com/features/actions">GitHub Actions</a>. With a simple <a href="https://github.com/emilyriederer/data-validation-demo/blob/master/.github/workflows/run-validation.yaml">config file</a>, we are able to schedule a daily cron job. This job:</p>
<ul>
<li>Exposes the GITHUB personal access token we need for <code>projmgr</code> to be able to write issues to our repository<sup>5</sup></li>
<li>Sets up R and pandoc to be able to knit an R Markdown</li>
<li>Installs needed packages</li>
<li>Renders the R Markdown to the file <code>docs/index.html</code> (Why this name? See the next step)</li>
<li>Pushes the results back to the repo</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">on<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-2">  schedule<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-3">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cron<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30 4 * * 3"</span></span>
<span id="cb5-4">  push<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-5">    branches<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-6">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> master</span>
<span id="cb5-7"></span>
<span id="cb5-8">jobs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-9">  render<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-10">    name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Render my document</span>
<span id="cb5-11">    runs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>on<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> macOS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>latest</span>
<span id="cb5-12">    steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-13">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Create and populate .Renviron file</span>
<span id="cb5-14">        run<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb5-15">          echo GITHUB_PAT<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$GH_PAT"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">~/</span>.Renviron</span>
<span id="cb5-16">        shell<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> bash</span>
<span id="cb5-17">        env<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-18">          GH_PAT<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span>{{secrets.GH_PAT}}</span>
<span id="cb5-19">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> uses<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>checkout<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>v2</span>
<span id="cb5-20">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> uses<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>setup<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>v1</span>
<span id="cb5-21">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> uses<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>setup<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pandoc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>v1</span>
<span id="cb5-22">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> uses<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>setup<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tinytex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>v1</span>
<span id="cb5-23">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Install rmarkdown</span>
<span id="cb5-24">        run<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Rscript <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'install.packages(c("pointblank", "projmgr", "dplyr", "purrr", "glue", "rmarkdown", "knitr"))'</span></span>
<span id="cb5-25">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Render my document to all types</span>
<span id="cb5-26">        run<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Rscript <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rmarkdown::render("data-valid-pipe.Rmd", output_file = "index.html", output_dir = "docs")'</span></span>
<span id="cb5-27">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Commit results</span>
<span id="cb5-28">        run<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb5-29">          git add <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>force docs</span>
<span id="cb5-30">          git commit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>m <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rerun validation checks'</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No changes to commit"</span></span>
<span id="cb5-31">          git push origin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No changes to commit"</span></span></code></pre></div>
</div>
</section>
<section id="publishing-on-github-pages" class="level3">
<h3 class="anchored" data-anchor-id="publishing-on-github-pages">Publishing on GitHub Pages</h3>
<p>Now that we’ve created an HTML report from our R Markdown, we can easily host it on <a href="https://pages.github.com/">GitHub Pages</a> by going to our repo’s <code>Settings &gt; Pages</code> and selecting as a <code>Source</code> the <code>main</code> or <code>master</code> branch and, specifically, the <code>docs</code> folder. GitHub will then provide a URL to our pages where the <code>docs/index.html</code> file serves as the main page.</p>
<p>In the case of my repo <code>emilyriederer/data-validation-demo</code>, the URL is https://emilyriederer.github.io/data-validation-demo/.</p>
</section>
<section id="setting-up-slack-notifications" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-slack-notifications">Setting up Slack notifications</h3>
<p><img src="https://emilyriederer.com/post/data-valid-lightweight/featured.png" class="img-fluid"></p>
<p>Of course, no one wants to go check one more report every single day. While you can watch a repository on GitHub and receive emails about new issues, you might prefer not to fill up your own inbox or have more control over how you manage these notifications. In your team is already using Slack, <a href="https://github.com/integrations/slack">GitHub + Slack integration</a> offers a great alternative.</p>
<p>You can consider making a dedicated Slack channel for data issues and automate instant Slack notifications when any new issues are opened. First, as described in the link above, install GitHub integration for Slack. Then, the following commands (typed simply as if you are writing a message on the Slack channel) connect to your GitHub repo and unsubscribe from all notifications except for issues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>invite <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>github</span>
<span id="cb6-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>github subscribe your<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>org<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>your<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>repo</span>
<span id="cb6-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>github unsubscribe your<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>org<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>your<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>repo pulls commits releases deployments</span></code></pre></div>
</div>
<p>Slack messages can both allow teams to customize how and when they are notified about emerging issues across different devices. This also allows a space for “meta” discussions, such as who is equipped to handle an issue, before someone is assigned and the conversation moves to GitHub itself.</p>
</section>
</section>
<section id="trade-offs" class="level2">
<h2 class="anchored" data-anchor-id="trade-offs">Trade Offs</h2>
<p>There’s always a fine line between exploiting the synergies of different tools or creating an incoherent Rube Goldberg machine with rough edges and new problems. However, different solutions are best suited for different organizations, teams, and data needs. I’m very excited about all of the emerging data quality tools and platforms, and for large enterprises I suspect that may be the way to go. However, if you’re looking for scaling up your data management practices with minimal new tools, infrastructure, or tech debt, I hope this set of powerful but lightweight tools can be a first step in a good direction.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Just to name a few: dbt, datafold, Soda, Great Expectations, and Monte Carlo↩︎</p></li>
<li id="fn2"><p>With love and admiration, I borrow this phrase from the excellent paper “Good Enough Practices in Scientific Computing”: https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510↩︎</p></li>
<li id="fn3"><p>Logic is translated to SQL via <code>dbplyr</code>.↩︎</p></li>
<li id="fn4"><p>Assuming you have your personal access token set per the documentation: https://emilyriederer.github.io/projmgr/articles/github-pat.html↩︎</p></li>
<li id="fn5"><p>This assumes that within GitHub, the PAT is defined as a secret called GH_PAT. Curiously, GitHub does not allow secrets that start with the word “GITHUB”. Who knew? Additionally, depending on the privacy level of your repository, you might not need a PAT to make issues and could skip this step.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>data</category>
  <category>elt</category>
  <guid>https://emilyriederer.com/post/data-valid-lightweight/index.html</guid>
  <pubDate>Thu, 26 Aug 2021 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/data-valid-lightweight/featured.png" medium="image" type="image/png" height="105" width="144"/>
</item>
<item>
  <title>Workflows for querying databases via R</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/sql-r-flow/index.html</link>
  <description><![CDATA[ 




<p>Simple, self-contained, reproducible examples are a common part of good software documentation. However, in the spirit of brevity, these examples often do not demonstrate the most sustainable or flexible <em>workflows</em> for integrating software tools into large projects. In this post, I document a few mundane but useful patterns for querying databases in R using the <code>DBI</code> package.</p>
<p>A prototypical example of forming and using a database connection with <code>DBI</code> might look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span>
<span id="cb1-2"></span>
<span id="cb1-3">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbWriteTable</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diamonds"</span>, ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>diamonds)</span>
<span id="cb1-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbGetQuery</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select cut, count(*) as n from diamonds group by 1"</span>)</span>
<span id="cb1-6">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        cut     n
1      Fair  1610
2      Good  4906
3     Ideal 21551
4   Premium 13791
5 Very Good 12082</code></pre>
</div>
</div>
<p>A connection is formed (in this case to a fake database that lives only in my computer’s RAM), the <code>diamonds</code> dataset from the <code>ggplot2</code> package is written to the database (once again, this is for example purposes only; a real database would, of course, have data), and <code>dbGetQuery()</code> executes a query on the resulting table.</p>
<p>However, as queries get longer and more complex, this succinct solution becomes less attractive. Writing the query directly inside <code>dbGetQuery()</code> blurs the line between “glue code” (rote connection and execution) and our more nuanced, problem-specific logic. This makes the latter harder to extract, share, and version.</p>
<p>Below, I demonstrate a few alternatives that I find helpful in different circumstances such as reading queries that are saved separately (in different files or at web URLs) and forming increasingly complex query templates. Specifically, we’ll see how to:</p>
<ul>
<li>Read a query from a separate file</li>
<li>Retrieve a query from a web URL</li>
<li>Convert a query into a template</li>
<li>Compose more complex queries from templates</li>
<li>Store and access queries/templates from within packages</li>
<li>Bonus: Data Testing</li>
</ul>
<section id="read-query-from-separate-file" class="level2">
<h2 class="anchored" data-anchor-id="read-query-from-separate-file">Read query from separate file</h2>
<p>A first enhancement is to isolate your SQL script in a separate file than the “glue code” that executes it. This improves readability and makes scripts more portable between projects. If a coworker who uses python or runs SQL through some other tool wishes to use your script, it’s more obvious which parts are relevant. Additionally, its easier to version control: we likely care far more about changes to the actual query than the boilerplate code that executes it so it feels more transparent to track them separately.</p>
<p>To do this, we can save our query in a separate file. We’ll call it <code>query-cut.sql</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">select</span>
<span id="cb3-2">  cut,</span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>) as n</span>
<span id="cb3-4">from diamonds</span>
<span id="cb3-5">group by <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<p>Then, in our script that pulls the data, we can read that other file with <code>readLines()</code> and give the results of that to the <code>dbGetQuery()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span>
<span id="cb4-2"></span>
<span id="cb4-3">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb4-4">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query-cut.sql"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbGetQuery</span>(con, query)</span>
<span id="cb4-6">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        cut     n
1      Fair  1610
2      Good  4906
3     Ideal 21551
4   Premium 13791
5 Very Good 12082</code></pre>
</div>
</div>
<p>Of course, if you wish you could define a helper function for the bulky <code>paste(readLines(...))</code> bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">read_source <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(path) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)}</span></code></pre></div>
</div>
</section>
<section id="read-query-from-url-like-github" class="level2">
<h2 class="anchored" data-anchor-id="read-query-from-url-like-github">Read query from URL (like GitHub)</h2>
<p>Sometimes, you might prefer that your query not live in your project at all. For example, if a query is used across multiple projects or if it changes frequently or is maintained by multiple people, it might live in a separate repository. In this case, the exact same workflow may be used if the path is replaced by a URL to a plain-text version of the query. (On GitHub, you may find such a link by clicking the “Raw” button when a file is pulled up.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span>
<span id="cb7-2"></span>
<span id="cb7-3">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb7-4">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/emilyriederer/website/master/content/post/sql-r-flow/query-cut.sql"</span></span>
<span id="cb7-5">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(url), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-6">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbGetQuery</span>(con, query)</span>
<span id="cb7-7">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        cut     n
1      Fair  1610
2      Good  4906
3     Ideal 21551
4   Premium 13791
5 Very Good 12082</code></pre>
</div>
</div>
<p>This works because the <code>query</code> variable simply contains our complete text file read from the internet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(query)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>select
  cut,
  count(*) as n
from diamonds
group by 1</code></pre>
</div>
</div>
<p>Alternatively, in an institutional setting you may find that you need some sort of authentication or proxy to access GitHub from R. In that case, you may retrieve the same query with an HTTP request instead using the <code>httr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb11-2"></span>
<span id="cb11-3">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/emilyriederer/website/master/content/post/sql-r-flow/query-cut.sql"</span></span>
<span id="cb11-4">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GET</span>(url))</span>
<span id="cb11-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(query)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>select
  cut,
  count(*) as n
from diamonds
group by 1</code></pre>
</div>
</div>
</section>
<section id="use-query-template" class="level2">
<h2 class="anchored" data-anchor-id="use-query-template">Use query template</h2>
<p>Separating the query from its actual execution also allows us to do query pre-processing. For example, instead of a normal query, we could write a query template with a wildcard variable. Consider the file <code>template-cut.sql</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">select</span>
<span id="cb13-2">  cut,</span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>) as n</span>
<span id="cb13-4">from diamonds</span>
<span id="cb13-5">where price <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> {max_price}</span>
<span id="cb13-6">group by <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<p>This query continues to count the number of diamonds in our dataset by their cut classification, but now is has parameterized the <code>max_price</code> variable. Then, we may use the <code>glue</code> package to populate this template with a value of interest before executing the script.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb14-3"></span>
<span id="cb14-4">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb14-5">template <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"template-cut.sql"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-6">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(template, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_price =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb14-7">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbGetQuery</span>(con, query)</span>
<span id="cb14-8">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        cut   n
1      Fair   7
2      Good 226
3     Ideal 628
4   Premium 215
5 Very Good 653</code></pre>
</div>
</div>
<p>This is a useful alternative to databases that do not allow for local variables.</p>
</section>
<section id="compose-more-complex-queries" class="level2">
<h2 class="anchored" data-anchor-id="compose-more-complex-queries">Compose more complex queries</h2>
<p>The idea of templating opens up far more interesting possibilities. For example, consider a case where you wish to frequently create the same data structure for a different population of observations (e.g.&nbsp;a standard set of KPIs for different A/B test experiments, reporting for different business units, etc.)</p>
<p>A boilerplate part of the query could be defined as a template ready to accept a CTE or a subquery for a specific population of interest. For example, we could write a file <code>template-multi.sql</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">with</span>
<span id="cb16-2">sample <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as</span> ({query_sample}),</span>
<span id="cb16-3">prices <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as</span> (select id, cut, price from diamonds)</span>
<span id="cb16-4">select prices.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb16-5">from</span>
<span id="cb16-6">  prices</span>
<span id="cb16-7">  inner join</span>
<span id="cb16-8">  sample</span>
<span id="cb16-9">  on</span>
<span id="cb16-10">  prices.id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> diamonds.id</span></code></pre></div>
</div>
<p>Then our “glue code” can combine the static and dynamic parts of the query at runtime before executing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">template <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"template-multi.sql"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-2">query_sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select * from diamonds where cut = 'Very Good' and carat &lt; 0.25"</span></span>
<span id="cb17-3">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(template, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">query_sample =</span> query_sample)</span>
<span id="cb17-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(query)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>with
sample as (select * from diamonds where cut = 'Very Good' and carat &lt; 0.25),
prices as (select id, cut, price from diamonds)
select prices.*
from
  prices
  inner join
  sample
  on
  prices.id = diamonds.id</code></pre>
</div>
</div>
<p>(Of course, this may seem like overkill and an unnecessarily inefficent query for the example above where a few more <code>where</code> conditions could have sufficed. But one can imagine more useful applications in a traditional setting where multiple tables are being joined.)</p>
</section>
<section id="query-package" class="level2">
<h2 class="anchored" data-anchor-id="query-package">Query package</h2>
<p>Finally, these queries and query templates could even be shipped as part of an R package. Additional text files may be placed in the <code>inst/</code> directory and their paths discovered by <code>system.file()</code>. So, if your package <code>myPkg</code> were to contain the <code>template-multi.sql</code> file we saw above, you could provide a function to access it like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">construct_query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(stub, ...) {</span>
<span id="cb19-2">  </span>
<span id="cb19-3">  path <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(stub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'myPkg'</span>)</span>
<span id="cb19-4">  template <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb19-5">  query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(template, ...)</span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(query)</span>
<span id="cb19-7">  </span>
<span id="cb19-8">}</span></code></pre></div>
</div>
<p>Then, that function could be called like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select * from diamonds where cut = 'Very Good' and carat &lt; 0.25"</span></span>
<span id="cb20-2">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">construct_query</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"multi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">query_sample =</span> sample)</span></code></pre></div>
</div>
<p>This approach has some benefits such as making it easier to share queries across users and benefit from package versioning and environment management standards. However, there are of course other risks; only dynamically generating queries could limit reproducibility or documentation about the actual query run to generate data. Thus, it might be a good idea to save the resulting query along with the resulting data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbGetQuery</span>(con, query)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(dat, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.rds"</span>)</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query-data.sql"</span>)</span></code></pre></div>
</div>
</section>
<section id="bonus-data-testing" class="level2">
<h2 class="anchored" data-anchor-id="bonus-data-testing">Bonus: Data Testing</h2>
<p>Although unrelated to the previous workflow, another nice aspect of working with SQL through R is the ability to use R’s superior toolkit for creating small datasets on the fly for testing purposes.</p>
<p>Mocking data to easily test SQL can be a tedious exercise since you generally need to write out the dataset row-by-row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">INSERT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">INTO</span> test_tbl</span>
<span id="cb22-2">  ( x, y, z )</span>
<span id="cb22-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">VALUES</span></span>
<span id="cb22-4">  (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>, NA), </span>
<span id="cb22-5">  (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb22-6">  (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'C'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>);</span></code></pre></div>
</div>
<p>This may be fine for a few rows, but it can easily get cumbersome when you require a mock dataset in the 10s or 20s of rows.</p>
<p>Of course, R has many helpful functions for generating data including sequences, predefined vectors (e.g.&nbsp;<code>letters</code>), and random number generators. This can make it easy to quickly generate data and push it to a database for testing SQL scripts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span></span>
<span id="cb23-2">test_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n,</span>
<span id="cb23-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> LETTERS,</span>
<span id="cb23-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb23-6">)</span>
<span id="cb23-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbWriteTable</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test_tbl"</span>, test_df)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>rstats</category>
  <category>workflow</category>
  <category>sql</category>
  <guid>https://emilyriederer.com/post/sql-r-flow/index.html</guid>
  <pubDate>Wed, 14 Jul 2021 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/sql-r-flow/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Building a team of internal R packages</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/team-of-packages/index.html</link>
  <description><![CDATA[ 




<p><em>Note: this post is a written version of my <a href="../../talk/organization">rstudio::global 2020 talk</a> on the same topic. Please see the link for the slides and video version. I do elaborate on a few points here that I cut from the talk; if you’ve already watched the talk and just want the delta, please see the sections in <span style="color: blue;">blue</span></em></p>
<p>More and more organizations are beginning to write their own internal R packages. These internal tools have great potential to improve an organization’s code quality, promote reproducible analysis frameworks, and enhance knowledge management. Developers of such tools are often inspired by their favorite open-source tools and, consequently, rely on the design patterns and best practices they have observed. Although this is a good starting position, internal packages have unique challenges (such as a smaller developer community) and opportunities (such as an intimate understanding of the problem space and over-arching organizational goals). Internal packages can realize their full potential by engineering to embrace these unique features. In this post, I explore the jobs of internal packages and the types of different design decisions these jobs can inspire – from API design and error handling to documentation to training and testing. <strong>If you’d rather just read the main ideas instead of the full essay, skip to the tl;dr</strong></p>
<section id="what-differentiates-internal-packages" class="level2">
<h2 class="anchored" data-anchor-id="what-differentiates-internal-packages">What differentiates internal packages</h2>
<p>To begin, think about the last time that you joined a new organization. There was so much you had to learn before you could get started – accessing data, intuiting what problems are worth tackling, understanding team norms, and so much more. Thankfully, we only have to descend this learning curve once. However, the off-the-shelf tools we use can’t preserve this context and culture. Every day is like their first day at work.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/first-day.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>In open-source, this high level of abstraction is a feature, not a bug. Stripping context from code enables reuse and collaboration across the globe. The <code>survival</code> package, for example, need not care whether one is modeling the time-to-death in a clinical trial or the time-to-attrition of a Netflix subscriber. In contrast, internal packages can drive additional value if they act more like a colleague and embrace institutional knowledge.</p>
<p>Contrasting internal and external packages on two dimensions illuminates this difference.</p>
<p>First, internal packages can target more domain-specific and concrete problems than open-source packages. Inherently, within an institution, such tools can have a <strong>narrower problem definition</strong> without loss of <em>useful</em> generality. This means our functions can be more tailored to the contours and corner cases of our problems and our documentation can use more relevant examples.</p>
<p>Second, and perhaps less intuitively, internal packages can actually span a <strong>broader solution space</strong>, as measured by the number of steps in the workflow that they span. For example, an open source package might offer many different methods to model time-to-event but remain agnostic to where the input data came from or what the analyst does with the results. In contrast, an internal package might cater to answering a narrower question but apply its insight into our organization to cover more of the steps in the workflow of answering that questions – such as pulling data, engineering features, and communicating outcomes.</p>
<p><img src="https://emilyriederer.com/post/team-of-packages/featured.PNG" class="img-fluid"></p>
<p>Because of these two factors, internal packages can make large contributions to our organization by addressing different needs such as:</p>
<ul>
<li><strong>Utilities</strong>: Providing an abstraction layer over internal infrastructure, such as connecting to databases, APIs, servers or enabling proxies</li>
<li><strong>Analysis</strong>: Guiding analysts through a curated set of methods and packages to answer common questions</li>
<li><strong>Developer Tools</strong>: Helping analysts produce better outputs faster with building blocks like ggplot themes, R Markdown templates, and Shiny modules</li>
</ul>
<p>But it’s not just what internal packages <em>do</em> that distinguishes them from open-source tools. Even more critical is how these packages are <em>designed</em> to do these tasks. In the rest of this post, I’ll illustrate how internal packages can be conscientiously engineered to act more like a veteran than a new hire.</p>
</section>
<section id="the-theory-of-jobs-to-be-done" class="level2">
<h2 class="anchored" data-anchor-id="the-theory-of-jobs-to-be-done">The theory of jobs-to-be-done</h2>
<p>To motivate the design goals and decisions we’ll discuss, it’s useful to think about Harvard Business School Professor Clayton Christensen’s <a href="https://hbr.org/2016/09/know-your-customers-jobs-to-be-done">jobs-to-be-done</a> theory of disruptive innovation. This asserts that</p>
<blockquote class="blockquote">
<p>we <em>hire</em> a product to do a job that helps us make progress towards a goal</p>
</blockquote>
<p>and sometimes<sup>1</sup> the theory further asserts that</p>
<blockquote class="blockquote">
<p>these jobs can have functional, social, and emotional components</p>
</blockquote>
<p><span style="color: blue;"></span></p>
<p>In the world of product development, that focus on the <em>progress</em> a customer is a critical distinction from the conventional understanding of competition and industry makeup. For example, if I ask you who Twitter’s competitors are, you might first think of Facebook, Instagram, or TikTok – other entrants in the category of “mobile apps for social networking”. However, if we think about the jobs that I “hire” Twitter to do, I might “hire” Twitter to help me pass the time while I wait in a long line or (back in “the olden days”) ride my long commute to work. Through that lens, it not longer matters what industry Twitter is nominally in; this is about me and my needs - not Twitter. So, Twitter is “competing” for the position of my travel companion against all sorts of other potential hires like Spotify, podcasts, books, or even an extra 20 minutes nap on the train.</p>
<p>In relation to R packages, open source packages know a <em>task</em> we want done (e.g.&nbsp;“fit a Cox proportional hazard model”) which is somewhat like a product category. But what really sets internal packages apart is that they can use their knowledge of our organization to cater to the kind of <em>progress</em> that we truly want to make.</p>
<p>It’s hard for passionate R users<sup>2</sup> to imagine, but no one actually <em>wants</em> a package. I’d even go as far to say that no one even <em>wants</em> data (blasphemy!). Organizations need <em>progress</em> – they need strategies, fueled by decisions, fueled by answers to questions, and fueled, in turn and in part, by data sets and tools. Since internal tools have a better sense of what that key bit of progress is, they can be more focused on helping us get there.</p>
<p></p>
<p>I claim that we can make internal tools more useful and more appealing by targeting them towards the specific jobs of an organization. To complete the analogy, I’ll restate the initial theory with a few alterations</p>
<blockquote class="blockquote">
<p>let’s build a <em>team of packages</em> that can do the <em>jobs</em> that help our organization make <em>answer impactful questions</em> with efficient workflows</p>
</blockquote>
<p>So how does jobs-to-be-done inform our package design? To explore this, we’ll consider what makes good teammates and how we can encode those traits in our tools.</p>
</section>
<section id="the-it-guy---abstraction" class="level2">
<h2 class="anchored" data-anchor-id="the-it-guy---abstraction">The IT Guy - Abstraction</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/it-guy.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>First, let’s meet the IT Guy. IT and DevOps colleagues complement the skills of data analysts by handling all of the things that analysts are generally not the most skilled or experienced at doing independently – production systems, servers, deployments, etc. In that abstraction process, they also take on additional responsibilities to promote good practices like data security and credential management. Ideally, they can save us time and frustration in navigating organization-specific roadblocks than no amount of searching on StackOverflow can help.</p>
<p>Put another way, the IT Guy fills the jobs of</p>
<ul>
<li><strong>Functional:</strong> Abstracting away confusing quirks of infrastructure</li>
<li><strong>Social:</strong> Promoting or enforcing good practices</li>
<li><strong>Emotional:</strong> Avoiding frustrating or stress of lost time or “silly” questions</li>
</ul>
<p>We can emulate these characteristics in internal packages by including utility functions, taking an opinionated stance on design, and providing helpful and detailed error messages.<sup>3</sup></p>
<p>As an example, let’s consider a simple function to connect to an organization’s internal database.<sup>4</sup> First, we might start out with a rather boilerplate piece of code using the <code>DBI</code> package. We take in the username and password; hard-code the driver name, server location, and port; and return a connection object. (Note that the content of this example doesn’t matter. The jobs of the IT Guy prototype are abstracting away things we don’t need to think about and protecting us from anti-patterns – not just connecting to databases. The design patterns shown will apply to the more general problem.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">get_database_conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(username, password) {</span>
<span id="cb1-2"></span>
<span id="cb1-3">conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-4">  DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(</span>
<span id="cb1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drv =</span> odbc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odbc</span>(),</span>
<span id="cb1-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"driver name here"</span>,</span>
<span id="cb1-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">server =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server string here"</span>,</span>
<span id="cb1-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UID =</span> username,</span>
<span id="cb1-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PWD =</span> password,</span>
<span id="cb1-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"port number here"</span></span>
<span id="cb1-11">  )</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(conn)</span>
<span id="cb1-14"></span>
<span id="cb1-15">}</span></code></pre></div>
</div>
<section id="opinionated-design" class="level3">
<h3 class="anchored" data-anchor-id="opinionated-design">Opinionated Design</h3>
<p>Now, let’s suppose our organization has strict rules against putting secure credentials in plain text. (Let’s actually <em>hope</em> they have such rules!) To enforce this, we can remove <code>username</code> and <code>password</code> from the function header, and use <code>Sys.getenv()</code> inside of the function to retrieve specifically named environment variables (<code>DB_USER</code> and <code>DB_PASS</code>) containing these quantities.<sup>5</sup></p>
<p>In an open source package, I would not presume to force users’ hand to use one specific system set-up. However, in this case, we can make strong assumptions based on our knowledge of an organization’s rules and norms. And this sort of function can be great leverage to incentivize users to do it right (like storing their credentials in environment variables) because there’s only one way it can work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">get_database_conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb2-2"></span>
<span id="cb2-3">conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-4">  DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(</span>
<span id="cb2-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drv =</span> odbc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odbc</span>(),</span>
<span id="cb2-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"driver name here"</span>,</span>
<span id="cb2-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">server =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server string here"</span>,</span>
<span id="cb2-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER"</span>),</span>
<span id="cb2-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PWD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>),</span>
<span id="cb2-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"port number here"</span></span>
<span id="cb2-11">  )</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(conn)</span>
<span id="cb2-14"></span>
<span id="cb2-15">}</span></code></pre></div>
</div>
</section>
<section id="helpful-error-messages" class="level3">
<h3 class="anchored" data-anchor-id="helpful-error-messages">Helpful Error Messages</h3>
<p>Of course, opinionated design is only helpful if we communicate those opinions to our users. Otherwise, they’ll get an error that <code>DB_PASS</code> is missing and find nothing useful online to help them troubleshoot since this is a specific internal choice that we made.</p>
<p>So, we can enhance the function with extremely custom and prescriptive error messages explaining what went wrong and either how to fix it (e.g.&nbsp;setting an environment variable, applying for an access) or where one can get more information (in a vignette, asking someone on a specific support team, checking out a specific document in a team wiki).</p>
<p><span style="color: blue;"></span></p>
<p>Such support messages can be made even more approachable with the use of the <a href="https://github.com/r-lib/cli"><code>cli</code> package</a> which makes console messages more aesthetic, user-friendly, and clear in intent.</p>
<p></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">get_database_conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) {</span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(</span>
<span id="cb3-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER or DB_PASS environment variables are missing."</span>,</span>
<span id="cb3-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Please read set-up vignette to configure your system."</span></span>
<span id="cb3-7">  ) </span>
<span id="cb3-8">}</span>
<span id="cb3-9"></span>
<span id="cb3-10">conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-11">  DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(</span>
<span id="cb3-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drv =</span> odbc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odbc</span>(),</span>
<span id="cb3-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"driver name here"</span>,</span>
<span id="cb3-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">server =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server string here"</span>,</span>
<span id="cb3-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER"</span>),</span>
<span id="cb3-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PWD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>),</span>
<span id="cb3-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"port number here"</span></span>
<span id="cb3-18">  )</span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(conn)</span>
<span id="cb3-21"></span>
<span id="cb3-22">}</span></code></pre></div>
</div>
</section>
<section id="proactive-problem-solving" class="level3">
<h3 class="anchored" data-anchor-id="proactive-problem-solving">Proactive Problem Solving</h3>
<p>Of course, even better than explaining errors is preventing them from occurring. We might also know at our specific organization, non alphanumeric characters are required in passwords and that <code>DBI::dbConnect()</code> does not natively encode these correctly when passing them to the database. Instead of troubling the users and telling them how to pick a password, we can instead handle this silently by running the password retrieved from the <code>DB_PASS</code> environment variable through the <code>URLencode()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">get_database_conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) {</span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(</span>
<span id="cb4-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER or DB_PASS environment variables are missing."</span>,</span>
<span id="cb4-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Please read set-up vignette to configure your system."</span></span>
<span id="cb4-7">  ) </span>
<span id="cb4-8">}</span>
<span id="cb4-9"></span>
<span id="cb4-10">conn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb4-11">  DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drv =</span> odbc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odbc</span>(),</span>
<span id="cb4-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"driver name here"</span>,</span>
<span id="cb4-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">server =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server string here"</span>,</span>
<span id="cb4-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">UID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_USER"</span>),</span>
<span id="cb4-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PWD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">URLencode</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DB_PASS"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reserved =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb4-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">port =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"port number here"</span></span>
<span id="cb4-18">  )</span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(conn)</span>
<span id="cb4-21"></span>
<span id="cb4-22">}</span></code></pre></div>
</div>
<p><span style="color: blue;"></span></p>
<p>At this point, you might be wondering: “Isn’t proactive troubleshooting and helpful error messages good standard practice?” And, yes, these are things that both external and internal packages should strive for. The differences with internal R packages are that you have a tighter feedback loop with your users and their systems. This has two advantages.</p>
<p>First, you’ll be quicker to learn about the spectrum of issues your users are encountering (trust me, they’ll find you!), and proactively explaining or solving those issues in the package saves you both a lot of time.</p>
<p>Secondly, in a constrained environment, there are more predictable ways things can go wrong, so you attempts at proactive problem solving and helpful error messages have a better chance at spanning the spectrum of commonly occurring problems.</p>
<p></p>
</section>
</section>
<section id="the-junior-analyst---proactive-problem-solving" class="level2">
<h2 class="anchored" data-anchor-id="the-junior-analyst---proactive-problem-solving">The Junior Analyst - Proactive Problem-Solving</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/junior-analyst.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>Of course, strong opinions and complete independence don’t always make a great teammate. Other times, we might want someone more like a junior analyst. They know a good bit about our organization, and we can trust them to execute calculations correctly and make reasonable assumptions. At the same time, we want them to be responsive to feedback and willing to try out things in more ways than one.</p>
<p>More concretely, a Junior Analyst fills the jobs:</p>
<ul>
<li><strong>Functional:</strong> Performs rote tasks effectively and makes reasonable assumptions where needed</li>
<li><strong>Social:</strong> Communicates assumptions and eagerly adapts to feedback</li>
<li><strong>Emotional:</strong> Builds trust so you can focus on other things</li>
</ul>
<p>To capture these jobs in our package, we can build proactive yet responsive functions by using default arguments, reserved keywords, and the ellipsis.</p>
<p>To illustrate, now let’s imagine a basic visualization function that wraps <code>ggplot2</code> code but allows users to input their preferred x-axis, y-axis and grouping variables to draw cohort curves. (Again, note that the content of this example doesn’t matter. The jobs of the junior analyst prototype are performing rote tasks efficiently and flexibly – not visualizing cohort curves, per say. The design patterns shown will apply to the general problem of assisting in analysis without overbearing assumptions.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">viz_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, time, metric, group) {</span>
<span id="cb5-2"></span>
<span id="cb5-3">  gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[time]], </span>
<span id="cb5-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[metric]],</span>
<span id="cb5-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> .data[[group]]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">my_org_theme</span>()</span>
<span id="cb5-10"></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(gg)</span>
<span id="cb5-12"></span>
<span id="cb5-13">}</span></code></pre></div>
</div>
<p>This function is alright, but we can probably draw on institutional knowledge to make our junior analyst a bit more proactive.</p>
<section id="default-function-arguments" class="level3">
<h3 class="anchored" data-anchor-id="default-function-arguments">Default Function Arguments</h3>
<p>If we relied on the same opinionated design as the IT Guy, we might consider hard-coding some of the variables inside of the function. Here, though, that is not a great approach. The junior analyst’s job is not to give edicts. We might know what the desired x-axis will be 80% of the time, but hard-coding here is a too-strong assumption even for an internal package and decreases the usefulness of the function in the other 20% of applications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">viz_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, metric, group) {</span>
<span id="cb6-2"></span>
<span id="cb6-3">  gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MONTHS_SUBSCRIBED"</span>]], </span>
<span id="cb6-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[metric]],</span>
<span id="cb6-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> .data[[group]]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">my_org_theme</span>()</span>
<span id="cb6-10"></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(gg)</span>
<span id="cb6-12"></span>
<span id="cb6-13">}</span></code></pre></div>
</div>
<p>Instead, we can put our best-guess 80-percent-right names as the default arguments in the function header – ordered by decreasing likelihood to override. This means, when users do not provide their own value, a default value is used (that’s the junior analyst’s best-guess!), but users retain complete control to change it as they see fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">viz_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, </span>
<span id="cb7-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_ACTIVE"</span>,</span>
<span id="cb7-3">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MONTHS_SUBSCRIBED"</span>, </span>
<span id="cb7-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"COHORT"</span>) {</span>
<span id="cb7-5"></span>
<span id="cb7-6">  gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[time]], </span>
<span id="cb7-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[metric]],</span>
<span id="cb7-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> .data[[group]]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">my_org_theme</span>()</span>
<span id="cb7-13"></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(gg)</span>
<span id="cb7-15"></span>
<span id="cb7-16">}</span></code></pre></div>
</div>
</section>
<section id="reserved-keywords" class="level3">
<h3 class="anchored" data-anchor-id="reserved-keywords">Reserved Keywords</h3>
<p>This approach becomes even more powerful if we can abstract out a small set of commonly occuring assumed variable names or other values. Then, we can define and document a set of “keywords” or special variable names that span all of our internal packages. Following the example above, we might define a handful of reserved keywords such as <code>TIME_SUBSCRIBED</code>, <code>CUSTOMER_COHORT</code>, and <code>CUSTOMER_SEGMENT</code>.</p>
<p>If these are well-known and well-documented, users will then get into the habit of shaping their data so it “plays nice” with the package ecosystem and save a lot of manual typing. This type of “incentive” to standardize field names can have other convenient consequences in making data extracts more sharable and code more readable.</p>
<p><span style="color: blue;"></span></p>
<p>In the spirit of the IT Guy’s proactive problem-solving, we can also help users catch potential errors caused by missing keywords. A few strategies here are to provide a function like <code>validate_{package name}_data()</code> to check that any required names exist or report out what is missing or to provide similar on-the-fly validation inside of functions that expect reserved keyword variable names to exist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">validate_mypackage_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(vbl_names) {</span>
<span id="cb8-2">  </span>
<span id="cb8-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># validate variable names ----</span></span>
<span id="cb8-4">  required <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TIME_SUBSCRIBED"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CUSTOMER_COHORT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CUSTOMER_SEGMENT"</span>)</span>
<span id="cb8-5">  not_present <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(required, vbl_names)</span>
<span id="cb8-6">  </span>
<span id="cb8-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># report missing / required names ----</span></span>
<span id="cb8-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(not_present) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)}</span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The following required variable(s) are missing: "</span>, </span>
<span id="cb8-10">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(not_present, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>))</span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-12">  </span>
<span id="cb8-13">}</span></code></pre></div>
</div>
<p>(An alternative approach to reserved keywords is to let users specify important variables by using package <code>options()</code>. However, I do not prefer this approach because it does not have the benefits of driving consistency, and it requires more documentation and R knowledge. Most any user can grasp “)</p>
<p></p>
</section>
<section id="ellipsis" class="level3">
<h3 class="anchored" data-anchor-id="ellipsis">Ellipsis</h3>
<p>Finally, one other nice trick in making our functions responsive to feedback is the ellipsis (<code>...</code>, also called “passing the dots”). This allows users to provide any number of additional, arbitrary arguments beyond what was specified by the developer and to plug them in at a designated place in the function body.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">viz_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, </span>
<span id="cb9-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MONTHS_SUBSCRIBED"</span>, </span>
<span id="cb9-3">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_ACTIVE"</span>,</span>
<span id="cb9-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"COHORT"</span>,</span>
<span id="cb9-5">                       ...) {</span>
<span id="cb9-6"></span>
<span id="cb9-7">  gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[time]], </span>
<span id="cb9-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[metric]],</span>
<span id="cb9-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> .data[[group]]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(...)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">my_org_theme</span>()</span>
<span id="cb9-14"></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(gg)</span>
<span id="cb9-16"></span>
<span id="cb9-17">}</span></code></pre></div>
</div>
<p>This way, users can extend functions based on needs that the developer could not have anticipated, like customizing the color, size, and line type with commands such as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viz_cohort</span>(my_org_data)</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viz_cohort</span>(my_org_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> COHORT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> COHORT)</span></code></pre></div>
</div>
<p><span style="color: blue;"></span></p>
<p>Note that the benefits of the ellipsis are very similar to the benefits of functional programming, in general, with small, modular, and composable functions that do not preserve state. This also provides users flexibility because they can continue to add on to our functions from the <em>outside</em> without having to modify the internals. For example, if users wanted to make our plot separate by the quarter that different cohorts began, they could simply create an additional column with this information before calling our function and add a <code>facet_grid()</code> call outside of <code>viz_cohort()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">my_org_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">COHORT_QUARTER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarter</span>(DATE_COHORT_START)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viz_cohort</span>(my_org_data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rows =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(COHORT_QUARTER))</span></code></pre></div>
</div>
<p></p>
</section>
</section>
<section id="the-tech-lead---knowledge-management" class="level2">
<h2 class="anchored" data-anchor-id="the-tech-lead---knowledge-management">The Tech Lead - Knowledge Management</h2>
<p>So far, we have mostly focused on that first dimension of differentiation between internal and open-source tools – making our package teammates targeted to solving specific internal problems. But there’s just as much value in that second dimension: using internal packages as a way to ship not just calculations but workflows and share an understanding of how the broader organization operates. This allows our packages to play leadership and mentorship roles in our org. To illustrate this, consider our intrepid tech lead.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/tech-lead.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>We value this type of teammate because they can draw from a breadth of past experience and institutional knowledge to help you weigh trade-offs, learn from collected wisdom, and inspire you to do your best work.</p>
<ul>
<li><strong>Functional:</strong> Coach you through weighing alternatives and debugging issues based on vast experience</li>
<li><strong>Social:</strong> Shares collected “tribal” knowledge</li>
<li><strong>Emotional:</strong> Breaks down barriers to help you do your best work</li>
</ul>
<p>Of course, all of that is a pretty tall order for a humble R package! But conscientious use of vignettes, R Markdown templates, and project templates can do a lot to help us toward this goal.</p>
<section id="vignettes" class="level3">
<h3 class="anchored" data-anchor-id="vignettes">Vignettes</h3>
<p>Vignettes often help introduce the basic functionality of a package with a toy example, as found in the <code>dplyr</code> vignette, or less commonly may discuss a statistical method that’s implemented, as done in the <code>survival</code> package. Vignettes of internal R packages can do more diverse and numerous jobs by tackling comprehensive <em>knowledge management</em>. These vignettes can accumulate the hard-won experience and domain knowledge like an experienced tech leads’ photographic memory and hand-deliver them to anyone currently working on a related analysis.</p>
<p>Just as a few examples, vignettes of an internal package might cover some of the following topics:</p>
<ul>
<li><strong>Conceptual Overview:</strong> Explain the problem(s) the package is trying to solve and how they help the organization make progress</li>
<li><strong>Workflow:</strong> Describe the workflow for answering the question For example, does it require data collection or use of existing data? what sort of models will be employed? what are the steps in in what order?</li>
<li><strong>Key Questions:</strong> What sort of questions should an analyst be asking themselves throughout the analysis? What assumptions are the methods making that they should verify? What are common “gotchas”?</li>
<li><strong>Process Documentation:</strong> What are organizational challenges to this problem (as opposed to quantiative ones)? What other systems might someone have to set up or teams to contact (e.g.&nbsp;if need to deploy a model or add features to a library)?</li>
<li><strong>Technical Documentation:</strong> How does the conceptual workflow map to different functions in the package? What sort of inputs do these functions require and what sort of outputs do they produce? Where should these inputs and outputs be stored?</li>
<li><strong>Method Comparison:</strong> When the package offers different options for solving specific problems, how should users evaluate these options and decide which is best? Are there quantitative measures? Examples from past experience?</li>
<li><strong>Lessons Learned:</strong> What has gone wrong when solving this type of problem before? What can be done better?</li>
<li><strong>Past Examples:</strong> Previous case studies of successful use of the package and the organizational progress it drove</li>
</ul>
<p><span style="color: blue;"></span></p>
<p>These examples of potential vignettes further illustrate how our internal packages can help us better achieve <em>progress</em>. No one in an organization wants a model for the sake of having a model; they want is to answer a question or suggest an action. Open-source packages are relatively “blind” to this, so their vignettes will focus on getting to the model; internal packages can partner with us in understanding that “moment before” and “moment after” with tips on everything from featuring engineering to assessing the ethics and bias in a certain output.</p>
<p>Of course, any organization can document their processes, and this documentation doesn’t strictly have to live inside an R package. However, many organizations struggle with knowledge management. Including documentation in a related R package ensures that it’s easily discoverable to the <em>right</em> people (those doing a related project), at the <em>right</em> time (when they are working on that project). It also ensures that documentation won’t be lost when any one person changes teams, leaves the organization, or gets a new computer.</p>
<p></p>
</section>
<section id="package-websites" class="level3">
<h3 class="anchored" data-anchor-id="package-websites">Package Websites</h3>
<p>In fact, all of that context may be <em>so</em> helpful, even people who are not direct users of your package may wish to seek its mentorship.</p>
<p>In this case, you can use the <a href="https://pkgdown.r-lib.org/"><code>pkgdown</code> package</a> to automatically (honestly, you just run <code>pkgdown::build_site()</code>) create a package website to share these vignettes with anyone who needs to learn about a specific problem space – whether or not they will ultimately be the data analyst using your package to solve the <em>computational</em> part of this quest for organizational progress. And, unlike their human counterparts, the packaged tech lead can always find time for another meeting.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/calendar.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>Like other R Markdown output types, <code>pkgdown</code> creates basic HTML output. This means that you can host it on an internal server or (if you organization uses it) GitHub Pages in GitHub enterprise. Alternatively, you may even simply store the HTML files in an internal shared drive and any users may open the site on their own computer in their favorite browser.</p>
</section>
<section id="r-markdown-templates" class="level3">
<h3 class="anchored" data-anchor-id="r-markdown-templates">R Markdown Templates</h3>
<p>Similar to vignettes, embedded <a href="https://rstudio.github.io/rstudio-extensions/rmarkdown_templates.html">R Markdown templates</a> take on a more important and distinctive role for internal packages.</p>
<p>Templates are a way to include prepopulated R Markdowns within your package, which users may access through <code>File &gt; New File &gt; R Markdown &gt; From Template</code> in the RStudio IDE or with the <code>rmarkdown::draft()</code> function. In open-source packages, R Markdown templates provide a pre-populated file instead of the default. This is most commonly used to demonstrate proper formatting syntax. For example, the <code>flexdashboard</code> package use a template to show users how to set up their YAML metadata and section headers.</p>
<p>Instead, internal packages can use templates to coach users through workflows because they understand the problem users are facing and the progress they hope to achieve. Internal packages can mentor users and structure their work in two different ways:</p>
<p><strong>Process walk-throughs</strong> can serve as interactive notebooks that “coach” users through common analyses. As an example, if a type of analysis requires manual data cleaning and curation, a template notebook could guide users to ask the right questions of their data and generate the common views they need to analyze.</p>
<p>We can also include full end-to-end <strong>analysis outlines</strong> which include placeholder text, commentary, and code if the type of analysis that a package supports usually results in a specific report.</p>
</section>
<section id="project-templates" class="level3">
<h3 class="anchored" data-anchor-id="project-templates">Project Templates</h3>
<p>Similarly, our package can include <a href="https://rstudio.github.io/rstudio-extensions/rstudio_project_templates.html">RStudio project templates</a>. These templates can predefine a standard file-structure and boilerplate set of files for a new project to give users a helping hand and drive the kind of consistency across projects that any tech lead dreams of when doing a code review. When any package user is beginning a new analysis, they may click <code>File &gt; New Project</code> in RStudio and select your custom project template among a number of options in the IDE.</p>
<p>For example, one flexible file structure might be something like:</p>
<ul>
<li><code>analysis</code>: RMarkdown files that constitute the final narrative output</li>
<li><code>src</code>: R scripts that contain useful helper functions or other set-up tasks (e.g.&nbsp;data pulls)</li>
<li><code>data</code>: Raw data - this folder should be considered “read only”!</li>
<li><code>output</code>: Intermediate data objects created in the analysis</li>
<li><code>doc</code>: Any long form documentation or set-up instructions</li>
<li><code>ext</code>: Any miscellaneous external files or presentation material collected or created throughout the analysis</li>
</ul>
<p>Additionally, for a given problem that our package attempts to solve, we could pre-populate this file structure with certain guaranteed files such as template scripts for querying and accessing data, configuration files, some of the template R Markdowns we mentions above, etc. The more that directories and files are standardized for a given problem type, the easier it is for anyone else in our organization that has previously used our tool to easily understand our project.</p>
<p>The idea of a standardized file structure is one of the 10 principles called out in the wonderful <a href="https://arxiv.org/abs/1609.00037">Good Enough Practices for Scientific Computing</a> and potentially one of the single highest leverage practices I’ve found for driving consistency and preserving sanity when building collaboratively on large teams.</p>
</section>
</section>
<section id="the-project-manager---coordination" class="level2">
<h2 class="anchored" data-anchor-id="the-project-manager---coordination">The Project Manager - Coordination</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/proj-mgr.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>Now, we discussed how a package filling the “tech lead” role can help structure our work with templates and how this can help collaboration between R users. But to think about collaboration more broadly, we must turn to our final teammate – the project manager.</p>
<p>One of the biggest differences between task-doing open-source packages versus problem-solving internal packages is understanding the whole workflow and helping coordinate projects across different components.</p>
<p>In short, a package can help project manage by addressing the jobs of</p>
<ul>
<li><strong>Functional:</strong> Integrate work across colleagues and components</li>
<li><strong>Social:</strong> Help mediate conflict and find common ground</li>
<li><strong>Emotional:</strong> Meet individual teammates where they are at and remove barriers</li>
</ul>
<p>Specifically, when writing open-source packages, we rightly tend to assume our target audience is R users, but on a true cross-functional team not everyone will be, so we can intentionally modularize the workflow, define specific tasks, and augment RStudio’s IDE to make sure our tools work well with all of our colleagues.</p>
<section id="modularization" class="level3">
<h3 class="anchored" data-anchor-id="modularization">Modularization</h3>
<p>Modularizing allows us to isolate parts of our workflow that do not really require R code to provide a lower barrier of entry for more of our colleagues to contribute.</p>
<p>For example, in the templates we just discussed, we could actually make separate template components for parts that require R code and for commentary. The commentary files could be plain vanilla markdown files that any collaborator could edit without even having R installed, and main R Markdown file can pull in this plaintext output using child documents. This approach is made even easier with advances in the RStudio IDE like the <a href="https://rstudio.github.io/visual-markdown-editing/#/">visual markdown editor</a> provides great, graphical UI support for word processing in markdown.</p>
</section>
<section id="project-planning" class="level3">
<h3 class="anchored" data-anchor-id="project-planning">Project Planning</h3>
<p><span style="color: blue;"></span></p>
<p>Pieces of code are not the only thing we can modularize for our users. Often, a good bit of work in the early stages of a project is figuring out what the right steps are. This is emphasized in the project management book <a href="https://basecamp.com/shapeup/3.4-chapter-13#work-is-like-a-hill">Shape Up</a> which illustrates the flow of a project with “hill diagrams”:</p>
<p><img src="https://emilyriederer.com/post/team-of-packages/https:/basecamp.com/assets/books/shapeup/3.4/hill_concept-a0a77c0ebb209b61899b8b4cdb1a315f2807e3fdc2e1d2373e2f19060725f042.png" class="img-fluid"></p>
<p>Our “tech lead” documentation can already help document some of the learned project steps and help speed up the “hill climbing”. Additionally, a package could play the role of the project manager and make those steps more tangible by embedding a project plan. One option for this is the <a href="https://emilyriederer.github.io/projmgr/"><code>projmgr</code></a> package<sup>6</sup> which allows for specification of main steps as a project as in a <a href="https://emilyriederer.github.io/projmgr/articles/building-custom-plans.html">YAML file</a> which can then be bulk uploaded to GitHub issues and milestones.</p>
<p>Technically, this would mean writing a project plan, saving it in the <code>inst/</code> folder of your package, and perhaps writing a custom function to wrap <code>system.file()</code> to help users access the plan. Your function might look something like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">retrieve_{package name}_plan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proj_type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>)) {</span>
<span id="cb12-2">  </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match.arg</span>(proj_type)</span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plan.yml"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{package name}"</span>)</span>
<span id="cb12-5">  </span>
<span id="cb12-6">}</span></code></pre></div>
</div>
<p>Alternatively, you could automate similar project plans yourself using the public APIs for Jira, Trello, GitLab, or whatever project management solution your organization uses.</p>
<p></p>
</section>
<section id="ide-support" class="level3">
<h3 class="anchored" data-anchor-id="ide-support">IDE Support</h3>
<p>We can also use <a href="https://rstudio.github.io/rstudioaddins/">RStudio Add-Ins</a> to extend RStudio interface and ship interactive widgets (imagine writing a “baby Shiny app”) in our internal packages. For example, the <a href="https://dreamrs.github.io/esquisse/"><code>esquisse</code> package</a> uses add-ins to ship a point-and-click plot coding assistant. Add-ins should be used judiciously because they require more investment upfront, but they are much easier to maintain than a full application and can help slowly convert more teammates to R users over time. Besides, a good project manager is willing to go the extra mile to support their team.</p>
<p>One other way to “go the extra mile” could also be to include an interactive <a href="https://rstudio.github.io/learnr/"><code>learnr</code> tutorial</a> as another way to help onboard new users. These tutorials are now also viewable through the RStudio IDE’s Tutorial pane.</p>
</section>
</section>
<section id="collaboration" class="level2">
<h2 class="anchored" data-anchor-id="collaboration">Collaboration</h2>
<p>Now, speaking of collaboration, we’ve talked about how packages can act like team <em>members</em> such as the IT Guy, Analyst, Tech Lead, or Project Manager. But being a good <em>teammate</em> is about more than doing individual jobs; organizational progress is made by working together. Another major opportunity when building a suite of internal tools is that we have the unique opportunity to think about how multiple packages on our team can interact most effectively.</p>
<p>We want teammates that are clear communicators, have defined responsibilities, and keep their promises. We can help our packages be good teammates with naming conventions, clearly defined scopes, and careful attention to dependencies and testing.</p>
<section id="clear-communication---naming-conventions" class="level3">
<h3 class="anchored" data-anchor-id="clear-communication---naming-conventions">Clear Communication - Naming Conventions</h3>
<p>Clear function naming conventions and consistent method signatures help packages effectively communicate with both package and human collaborators.</p>
<p>Internally, we can give our suite of internal packages a richer language by define a consistent set of prefix name stubs that indicate how each function is used. One approach is that each function prefix can denote the type of object being returned (like “viz” for a <code>ggplot</code> object).<sup>7</sup></p>
<p><img src="https://emilyriederer.com/post/team-of-packages/in-out.PNG" class="img-fluid"></p>
<p>This sort of convention can reduce the cognitive load when working with any packages; it’s not particularly unique to internal tools. However, while the <em>practice</em> is general, the benefits scale significantly for internal packages. Since we can drive this consistent standard across a collection of packages, past experience working with any one of our internal packages gives a user intuition when working with the next.</p>
</section>
<section id="defined-roles---curation" class="level3">
<h3 class="anchored" data-anchor-id="defined-roles---curation">Defined Roles - Curation</h3>
<p>Another aspect of good team communication is having clearly defined roles and responsibilities. Again, since we own our whole internal stack, we have more freedom in how we chose to divide functionality across packages.</p>
<p>Open source packages inevitably have overlapping functionality which forces users to compare alternatives and decide which is best. The need to <em>curate</em> all of the potentially useful tools creates a meta-job for analysts of researching and weighing alternatives, seeking their colleague’s advice, and piecing disparate pieces of a pipeline together.</p>
<p>But internally, we can use some amount of central planning to ensure each package teammate has a clearly defined role – whether that be to provide a horizontal utility or to enable progress on a specific workstream. And just like one team ought to work well with another, that central planning can include curation and promotion of open-source tools that “play nicely” with our internal ones. After all, no one team can go it alone!</p>
</section>
<section id="definded-roles---dependencies" class="level3">
<h3 class="anchored" data-anchor-id="definded-roles---dependencies">Definded Roles - Dependencies</h3>
<p>When assigning these roles and responsibilities to our team of packages, we should consider how to manage the dependencies between them when different functionality needs to be shared.</p>
<p>Packages often have direct dependencies where a function in one package calls a function in another. This is not necessarily bad, but especially with internal packages which might sometimes have a shorter shelf-life and few developers, this can create a domino effect. If one package is deprecated (or decides to retire or take a vacation), we don’t want the rest of our ecosystem affected.</p>
<p>Alternative, we can use the fact that both packages A and B are under our control and see if we can eliminate explicit dependencies by promoting a clean hand-off. We can see if a function in A can produce an output that B can consume instead of directly calling A’s function internally.</p>
<p>Additionally, because we own the full stack, we may also consider if there are shared needs in A and B that should be be extracted into a common “building block” package C. For instance, a set of common visualization function “primitives”. This was, we at least have a clear hierarchy of dependencies instead of a spiderweb and can identify a small number of truly essential ones.</p>
<p><img src="https://emilyriederer.com/post/team-of-packages/dep-structures.PNG" class="img-fluid"></p>
</section>
<section id="delivering-reliably---testing" class="level3">
<h3 class="anchored" data-anchor-id="delivering-reliably---testing">Delivering Reliably - Testing</h3>
<p>Regardless of the type of dependencies we end up with, we can use tests to make sure that our packages are reliable teammates who do what they promised.</p>
<p>Typically, if I write a package B that depends on package A, I can only control package B’s tests, so I could write tests to see if A continues to perform as B is expecting.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/team-of-packages/test-1.PNG" class="img-fluid figure-img" style="width:33.0%"></p>
</figure>
</div>
</div>
</div>
<p>This is a good safeguard, but it means that we will only detect problems after they have already been introduced in A. There’s nothing in place to actually stop package A from getting distracted in the first place.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/team-of-packages/contract-meme.png" class="img-fluid" style="width:33.0%"></p>
</div>
</div>
<p>Instead, we’d prefer that both A and B be conscientious of the promises that they have made and stay committed to working towards their shared goals.</p>
<p>We can formalize that shared vision with integration tests. That is, we can add tests to both the upstream and downstream packages to ensure that they continue to check in with each other and inquire if any changes that they are planning could be disruptive. Now, just imagine having such rigorous and ongoing communication and prioritization with your actual teammates!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://emilyriederer.com/post/team-of-packages/test-2.PNG" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p><span style="color: blue;"></span></p>
<p>This type of two-way testing can also be deployed to more robustly test <em>external</em> and <em>cross-platform</em> dependencies. For example, if your internal package requires connects to external resources like APIs or databases, you could even write tests that connect to external resources and verify that certain API endpoints, database schemas, or even columns still exist.</p>
<p>In open source packages, we generally employ “mocking” to avoid testing external dependencies since these fail when run by unauthenticated users or programs (such as CRAN checks.) However, once again, internally we can get differential value and safety by making different decisions.</p>
<p></p>
</section>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>In summary, we all know the the joy of working with a great team, and, if you’ve made it this far, I suspect you know the pleasure of cracking open a new R package. By taking advantage of unique opportunities when designing internal packages, we can truly achieve the best of both worlds. We can share the fun of working with good tools with the teammates we care about, and elevate those same tools to full-fledged teammates by giving them the skills to succeed.</p>
<p><img src="https://emilyriederer.com/post/team-of-packages/all-the-jobs.PNG" class="img-fluid"></p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p><span style="color: blue;"></span></p>
<p>Ready to get started? Check out my posts on:</p>
<ul>
<li><a href="../../post/rmarkdown-driven-development">R Markdown Driven Development</a> to learn the <em>technical</em> side of converting existing analysis scripts into reusable tools and packages</li>
<li>my <a href="../../project/rtistic">Rtistic project</a> for a template to make your organization’s first package (for themes and color palettes)</li>
<li>my <a href="https://emilyriederer.netlify.app/post/resource-roundup-r-industry/">round-up</a> of cool examples of R packages in industry.<sup>8</sup></li>
</ul>
<p>For general resources on building R packages, check out:</p>
<ul>
<li>the <a href="https://r-pkgs.org/">R Packages book</a></li>
<li>Malcolm Barrett and Rich Iannone’s <a href="https://github.com/rstudio-conf-2020/my-org-first-pkg">My Organization’s First Package training</a> from rstudio::conf 2020</li>
<li>Hadley Wickham’s <a href="https://github.com/rstudio-conf-2020/build-tidy-tools">Building Tidy Tools training</a> from rstudio::conf 2020</li>
</ul>
<p>For opinionated guides to package design, check out:</p>
<ul>
<li><a href="https://devguide.ropensci.org/">rOpenSci Packages: Development, Maintenance, and Peer Review</a></li>
<li><a href="https://masalmon.eu/2017/12/11/goodrpackages/">How to develop good R packages for open science</a> by Maëlle Salmon</li>
</ul>
<p></p>
</section>
<section id="too-long-didnt-read" class="level2">
<h2 class="anchored" data-anchor-id="too-long-didnt-read">Too Long Didn’t Read</h2>
<p>The following summarizes the key principles and practices discussed in this article.</p>
<p><strong>Abstraction &amp; Enforcement</strong>: In an organization, there are more things that we absolutely know to be true (e.g.&nbsp;the location of a server) or required (e.g.&nbsp;the right way to authenticate.) Thus, for internal tools, sometimes less flexible functions are useful; these don’t require users to input things that will not change or that they may not completely understand (e.g.&nbsp;encryption). So, internal packages could include functions that:</p>
<ul>
<li>Provide <strong>utilities</strong> such as database connections objects</li>
<li>Take an <strong>opinionated stance</strong> to be more efficient and enforce best practices (by what they chose <em>not</em> to parameterize)</li>
<li>Provide extremely helpful and <strong>prescriptive error messages</strong> not only explaining failure but explaining what organizational resources are needed to fix (e.g.&nbsp;perhaps someone needs to access a DBA for access to a schema). Bonus points for using the <a href="https://github.com/r-lib/cli"><code>cli</code> package</a> to make these errors easy to read</li>
<li>Continually learn from user challenges to <strong>silently handle more potential errors</strong> and corner cases internally</li>
</ul>
<p><strong>Informed &amp; Flexible</strong>: Because we know our organization’s problem domain, there are some things we probably know to be true 80% of the time. When designing functions, we can make our functions informed enough to save user’s time and typing by handling this 80% of cases more automatically but still providing complete flexibility to override with:</p>
<ul>
<li><strong>Default arguments</strong> which allow us to provide a likely value for a function argument that is used unless overridden by the user</li>
<li><strong>Reserved keywords</strong> that provide at the package or package-ecosystem level a small set of variable names that will be repeatedly used for these defaults</li>
<li><strong>Ellipsis</strong> to allow users to insert additional arguments and customize functions in ways we did not foresee</li>
<li><strong>Functional programming</strong> which, like the ellipsis, makes our functions seamless to extend</li>
</ul>
<p><strong>Providing Context &amp; Coaching</strong>: Internal packages can shared knowledge learned from past experience and nudge users towards better coding standards by include:</p>
<ul>
<li><strong>Vignettes</strong> that package the accumulated knowledge about solving a certain type of problem within the bounds of an organization</li>
<li><strong><a href="https://pkgdown.r-lib.org/"><code>pkgdown</code></a> sites</strong> to share all of the qualitative information contained in vignettes as part of institutional knowledge management</li>
<li><strong>R Markdown templates</strong> to encode an interactive workflow or provide an analysis template</li>
<li><strong>R Project templates</strong> to drive consistency in how a project using that package is structured</li>
</ul>
<p><strong>Improving accessibility and coordination</strong>: Internal packages can become more integral to how our organization works if they help all of our coworkers engage – even non-R users. Some strategies for this are:</p>
<ul>
<li><strong>Modularizing</strong> parts of the workflow that do and do not require programming. One way to do this is with R Markdown <strong>child documents</strong></li>
<li><strong>Defining project plans</strong> with <a href="https://emilyriederer.github.io/projmgr/index.html"><code>projmgr</code></a> (or other APIs) and automatically publishing them to one’s prefered project management platform</li>
<li>Promoting use of the <strong>RStudio Visual Markdown Editor</strong></li>
<li>Providing <strong>RStudio Add-ins</strong> to help new users get some amount of graphical support in performing simple tasks with out package</li>
</ul>
<p><strong>Collaboration</strong>: When we write multiple internal R package, we also have the unique ability to think about how our set of packages can interact well with each other. To fully capitalize on this, we can:</p>
<ul>
<li>Define a <strong>naming convention</strong> to use across all packages and help make “performance guarantees” so knowledge transfers between packages</li>
<li>Carefully rationalizing the functions in each package to <strong>avoid confusing redunancy</strong> and promote a <strong>curated set of (internal and open) tools</strong></li>
<li>Tackle refactoring <strong>across all our packages</strong> instead of one-by-one to attempt to unneeded, potentially brittle dependencies</li>
<li>Set up <strong>two-way unit tests</strong> (or “integration tests”) where we have dependencies to ensure that the intent of dependent packages doesn’t drift apart</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Many practitioners have built off of Christensen’s initial theory with sometimes passionately conflicting opinions on the nuances↩︎</p></li>
<li id="fn2"><p>Particularly users interested enough to read this post =)↩︎</p></li>
<li id="fn3"><p>The <code>usethis</code> package also has many great examples of “IT Guy”-like qualities. One that I don’t discuss in this post is explicitly <em>informing</em> users what it intends to do and then seeking permission↩︎</p></li>
<li id="fn4"><p>Note that any functions I show in the post are psuedo-code and simplified to illustrate my key points.↩︎</p></li>
<li id="fn5"><p>This is <em>not</em> a recommendation for the best way to store credentials! There are many other options such as keychains and password managers that your organization may prefer. I use a relatively simple example here that I could implement without adding any bulky code or additional packages to illustrate the point of opinionated design - not to give advice on security.↩︎</p></li>
<li id="fn6"><p>Disclaimer, this is a shameless promotion of my own package.↩︎</p></li>
<li id="fn7"><p>rOpenSci has a nice discussion on function naming in their package <a href="https://devguide.ropensci.org/building.html#package-api">style guide</a>↩︎</p></li>
<li id="fn8"><p>This round-up also illustrates some great examples of when you should <em>not</em> use an R package for your organization and when other types of end-products could be more beneficial.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>pkgdev</category>
  <category>jtbd</category>
  <guid>https://emilyriederer.com/post/team-of-packages/index.html</guid>
  <pubDate>Thu, 21 Jan 2021 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/team-of-packages/featured.PNG" medium="image"/>
</item>
<item>
  <title>oRganization: Design patterns for internal packages</title>
  <link>https://emilyriederer.com/talk/organization/index.html</link>
  <description><![CDATA[ 



<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Quick Links</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Abstract</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">Slides</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false">Video</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><span><i class="bi bi-file-bar-graph"></i> <a href="slides.pdf">Slides</a> </span><br>
<span><i class="bi bi-play"></i> <a href="https://www.youtube.com/watch?v=E887K1au5ug">Video</a> </span><br>
<span><i class="bi bi-pencil"></i> <a href="../../post/team-of-packages/">Post - A Team of Packages</a> </span></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>Many case studies demonstrate the benefits of organizations developing internal R packages. But how do you move your organization from individual internal packages to a coherent internal ecosystem?</p>
<p>In this talk, I analyze how internal packages differ from open-source, publicly available packages in their ideal level of abstraction and their understanding of specific user needs. By applying the jobs-to-be-done framework, I envision internal packages as teammates annd consider the many roles they can play, from unblocking IT challenges to democratizing tribal knowledge.</p>
<p>To help our team of packages succeed, we explore a wide variety of concrete design choices that developers of internal packages may make – spanning functions, documentation, testing, and more.</p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div id="slides" style="width:100%; aspect-ratio:16/11;">
<embed src="slides.pdf#zoom=Fit" width="100%" height="100%">
</div>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<p>{{&lt;video https://www.youtube.com/watch?v=E887K1au5ug&gt;}}</p>
</div>
</div>
</div>



 ]]></description>
  <category>workflow</category>
  <category>pkgdev</category>
  <category>rstats</category>
  <guid>https://emilyriederer.com/talk/organization/index.html</guid>
  <pubDate>Thu, 21 Jan 2021 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/talk/organization/featured.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Generating SQL with {dbplyr} and sqlfluff</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/sql-generation/index.html</link>
  <description><![CDATA[ 




<p><a href="https://en.wikipedia.org/wiki/Declarative_programming">Declarative programming languages</a> such as HTML, CSS, and SQL are popular because they allow users to focus more on the desired <em>outcome</em> than the exact computational steps required to achieve that outcome. This can increase efficiency and code readability since programmers describe what they <em>want</em> – whether that be how their website is laid out (without worrying about how the browser computes this layout) or how a dataset is structured (regardless of how the database goes about obtaining and aggregating this data).</p>
<p>However, sometimes this additional layer of abstraction can introduce problems of its own. Most notably, the lack of common <a href="https://en.wikipedia.org/wiki/Control_flow">control flow</a> can introduce a lot of redundancy. This is part of the motivation for <em>pre-processing</em> tools which use more imperative programming concepts such as local variables and for-loops to automatically generate declarative code. Common examples in the world of web development are <a href="https://sass-lang.com/">Sass</a> for CSS and <a href="https://haml.info/docs/yardoc/file.REFERENCE.html">Haml</a> for HTML. Of course, such tools naturally come at a cost of their own by requiring developers to learn yet another tool.<sup>1</sup></p>
<p>For R (or, specifically <code>tidyverse</code>) users who need to generate SQL code, recent advances in <a href="https://dplyr.tidyverse.org/"><code>dplyr v1.0.0</code></a> and <a href="https://dbplyr.tidyverse.org/"><code>dbplyr v2.0.0</code></a> pose an interesting alternative. By using efficient, readable, and most important <em>familiar</em> syntax, users can generate accurate SQL queries that could otherwise be error-prone to write. For example, computing sums and means for a large number of variables. Coupled with the power of <a href="https://www.sqlfluff.com/"><code>sqlfluff</code></a>, an innovative SQL styler which was announced at DBT’s recent <a href="https://www.getdbt.com/coalesce/agenda/presenting-sqlfluff">coalesce conference</a>, these queries can be made not only accurate but also imminently readable.</p>
<section id="the-basic-approach" class="level2">
<h2 class="anchored" data-anchor-id="the-basic-approach">The basic approach</h2>
<p>In the following example, I’ll briefly walk through the process of generating readable, well-styled SQL using <code>dbplyr</code> and <code>sqlfluff</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dbplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span></code></pre></div>
</div>
<p>First, we would connect to our database using the <code>DBI</code> package. For the sake of example, I simply connect to an “in-memory” database, but <a href="https://db.rstudio.com/">a wide range of database connectors</a> are available depending on where your data lives.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span></code></pre></div>
</div>
<p>Again, <em>for the sake of this tutorial only</em>, I will write the <code>palmerpenguins::penguins</code> data to our database. Typically, data would already exist in the database of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_to</span>(con, palmerpenguins<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>penguins, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins"</span>)</span></code></pre></div>
</div>
<p>For reference, the data looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(palmerpenguins<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>penguins)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
4 Adelie  Torgersen           NA            NA                  NA          NA
5 Adelie  Torgersen           36.7          19.3               193        3450
6 Adelie  Torgersen           39.3          20.6               190        3650
# i 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>Now, we’re done with set-up. Suppose we want to write a SQL query to calculate the sum, mean, and variance for all of the measures in our dataset measured in milimeters (and ending in “mm”). We can accomplish this by using the <code>tbl()</code> function to connect to our database’s data and describing the results we want with <code>dplyr</code>’s elegant syntax. This is now made especially concise with select helpers (e.g.&nbsp;<code>ends_with()</code>) and the <code>across()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">penguins <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">penguins_aggr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb7-2">  penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb7-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb7-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOT_{.col}"</span>),</span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VAR_{.col}"</span>),</span>
<span id="cb7-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AVG_{.col}"</span>),</span>
<span id="cb7-9">  )</span>
<span id="cb7-10">penguins_aggr</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 11]
# Database: sqlite 3.33.0 [:memory:]
  species       N TOT_bill_length_mm TOT_bill_depth_mm TOT_flipper_length_mm
  &lt;chr&gt;     &lt;int&gt;              &lt;dbl&gt;             &lt;dbl&gt;                 &lt;int&gt;
1 Adelie      152              5858.             2770.                 28683
2 Chinstrap    68              3321.             1253.                 13316
3 Gentoo      124              5843.             1843.                 26714
# i 6 more variables: VAR_bill_length_mm &lt;dbl&gt;, VAR_bill_depth_mm &lt;dbl&gt;,
#   VAR_flipper_length_mm &lt;dbl&gt;, AVG_bill_length_mm &lt;dbl&gt;,
#   AVG_bill_depth_mm &lt;dbl&gt;, AVG_flipper_length_mm &lt;dbl&gt;</code></pre>
</div>
</div>
<p>However, since we are using a remote backend, the <code>penguins_aggr</code> object does not contain the resulting data that we see when it is printed (forcing its execution). Instead, it contains a reference to the database’s table and an accumulation of commands than need to be run on the table in the future. We can access this underlying SQL translation with the <code>dbplyr::show_query()</code> and use <code>capture.output()</code> to convert that query (otherwise printed to the R console) to a character vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">penguins_query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">capture.output</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>(penguins_aggr))</span>
<span id="cb9-2">penguins_query</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "&lt;SQL&gt;"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[2] "SELECT `species`, COUNT(*) AS `N`, SUM(`bill_length_mm`) AS `TOT_bill_length_mm`, SUM(`bill_depth_mm`) AS `TOT_bill_depth_mm`, SUM(`flipper_length_mm`) AS `TOT_flipper_length_mm`, VARIANCE(`bill_length_mm`) AS `VAR_bill_length_mm`, VARIANCE(`bill_depth_mm`) AS `VAR_bill_depth_mm`, VARIANCE(`flipper_length_mm`) AS `VAR_flipper_length_mm`, AVG(`bill_length_mm`) AS `AVG_bill_length_mm`, AVG(`bill_depth_mm`) AS `AVG_bill_depth_mm`, AVG(`flipper_length_mm`) AS `AVG_flipper_length_mm`"
[3] "FROM `penguins`"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
[4] "GROUP BY `species`"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </code></pre>
</div>
</div>
<p>At this point, we already have a function SQL query and have saved ourselves the hassle of writing nine typo-free aggregation functions. However, since <code>dbplyr</code> was not written to generate “pretty” queries, this is not the most readable or well-formatted code. To clean it up, we can apply the <code>sqlfluff</code> linter and styler.</p>
<p>As a prerequisite, we slightly reformat the query to remove anything that isn’t native to common SQL and will confuse the linter, such as the first line of the query vector: <code>&lt;SQL&gt;</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">penguins_query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguins_query[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(penguins_query)]</span>
<span id="cb11-2">penguins_query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, penguins_query)</span>
<span id="cb11-3">penguins_query</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SELECT species, COUNT(*) AS N, SUM(bill_length_mm) AS TOT_bill_length_mm, SUM(bill_depth_mm) AS TOT_bill_depth_mm, SUM(flipper_length_mm) AS TOT_flipper_length_mm, VARIANCE(bill_length_mm) AS VAR_bill_length_mm, VARIANCE(bill_depth_mm) AS VAR_bill_depth_mm, VARIANCE(flipper_length_mm) AS VAR_flipper_length_mm, AVG(bill_length_mm) AS AVG_bill_length_mm, AVG(bill_depth_mm) AS AVG_bill_depth_mm, AVG(flipper_length_mm) AS AVG_flipper_length_mm"
[2] "FROM penguins"                                                                                                                                                                                                                                                                                                                                                                                                                                              
[3] "GROUP BY species"                                                                                                                                                                                                                                                                                                                                                                                                                                           </code></pre>
</div>
</div>
<p>After cleaning, we can write the results to a temp file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempfile</span>()</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(penguins_query, tmp)</span></code></pre></div>
</div>
<p>The current state of our file looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> species, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> N, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_flipper_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_flipper_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_flipper_length_mm</span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> penguins</span>
<span id="cb14-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> species</span></code></pre></div>
</div>
<p>Finally, we are ready to use <code>sqlfluff</code>. The <code>lint</code> command highlights errors in our script, and the <code>fix</code> command automatically fixes them (with flags <code>--no-safety</code> and <code>-f</code> requesting that it apply all rules and does not ask for permission to overwrite the file, respectively). However, note that if your stylistic preferences differ from the defaults, <code>sqlfluff</code> is imminently <a href="https://docs.sqlfluff.com/en/stable/rules.html">customizable</a> via YAML.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlfluff lint"</span>, tmp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intern =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) </span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in system(paste("sqlfluff lint", tmp), intern = TRUE): running command
'sqlfluff lint C:\Users\emily\AppData\Local\Temp\RtmpOyDJYM\file51f4757357ce'
had status 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)
attr(,"status")
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># intern = TRUE is only useful for the sake of showing linter results for this blog post</span></span>
<span id="cb18-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># it is not needed for interactive use</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlfluff fix --no-safety -f"</span>, tmp))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>The results of these commands are a well-formatted and readable query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> species, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> N, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TOT_flipper_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VARIANCE</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> VAR_flipper_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_bill_length_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_bill_depth_mm, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> AVG_flipper_length_mm</span>
<span id="cb21-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> penguins</span>
<span id="cb21-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> species</span></code></pre></div>
</div>
</section>
<section id="a-slightly-more-realistic-example" class="level2">
<h2 class="anchored" data-anchor-id="a-slightly-more-realistic-example">A (slightly) more realistic example</h2>
<p>One situation in which this approach is useful is when engineering features that might include many subgroups or lags. Some flavors of SQL have <code>PIVOT</code> functions which help to aggregate and reshape data by group; however, this can vary by engine and even those that do (such as <a href="https://docs.snowflake.com/en/sql-reference/constructs/pivot.html">Snowflake</a>) require manually specifying the names of each field. Instead, our <code>dbplyr</code> and <code>sqlfluff</code> can help generate an accurate query to accomplsh this more concisely.</p>
<p>Now assume we want to find the mean for each measurement separately for years 2007 through 2009. Ultimately, we want these measures organized in a table with one row per species. We can concisely describe this goal with <code>dplyr</code> instead of writing out the definition of each of 9 variables (three metrics for three years) separately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">penguins_pivot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb22-2">  penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)), </span>
<span id="cb22-5">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in09 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> 2009L, ., <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),</span>
<span id="cb22-6">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in08 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> 2008L, ., <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),</span>
<span id="cb22-7">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in07 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> 2007L, ., <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span>
<span id="cb22-8">               ) </span>
<span id="cb22-9">penguins_pivot</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 10]
# Database: sqlite 3.33.0 [:memory:]
  species   bill_length_mm_in09 bill_depth_mm_in09 flipper_length_mm_in09
  &lt;chr&gt;                   &lt;dbl&gt;              &lt;dbl&gt;                  &lt;dbl&gt;
1 Adelie                   13.3               6.19                   65.7
2 Chinstrap                17.3               6.47                   69.9
3 Gentoo                   17.0               5.34                   76.4
# i 6 more variables: bill_length_mm_in08 &lt;dbl&gt;, bill_depth_mm_in08 &lt;dbl&gt;,
#   flipper_length_mm_in08 &lt;dbl&gt;, bill_length_mm_in07 &lt;dbl&gt;,
#   bill_depth_mm_in07 &lt;dbl&gt;, flipper_length_mm_in07 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Following the same process as before, we can convert this to a SQL query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">capture.output</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>(penguins_pivot))</span>
<span id="cb24-2">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> query[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(query)]</span>
<span id="cb24-3">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"`"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, query)</span>
<span id="cb24-4">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempfile</span>()</span>
<span id="cb24-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(query, tmp)</span>
<span id="cb24-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlfluff fix --no-safety -f"</span>, tmp))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>The following query shows the basic results. In this case, the <code>sqlfluff</code> default is significantly more aggressive with identations for the <code>CASE WHEN</code> statements than I personally prefer. If I were to use this in practice, I could refer back to the customizable <a href="https://docs.sqlfluff.com/en/stable/rules.html#"><code>sqlfluff</code> rules</a> and either change their configuration or restrict rules I perceived as unaesthetic or overzealous from running.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> species, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm_in09, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_depth_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm_in09, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (flipper_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm_in09, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm_in08, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_depth_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm_in08, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (flipper_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm_in08, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm_in07, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (bill_depth_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm_in07, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> (<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (flipper_length_mm) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span>(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">year</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm_in07</span>
<span id="cb26-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> penguins</span>
<span id="cb26-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> species</span></code></pre></div>
</div>
</section>
<section id="when-you-cant-connect-to-you-data" class="level2">
<h2 class="anchored" data-anchor-id="when-you-cant-connect-to-you-data">When you can’t connect to you data</h2>
<p>Even if, for some reason, you cannot connect to R with your specific dataset, you may still use this approach.</p>
<p>For example, suppose we cannot connect to the <code>penguins</code> dataset directly, but with the help of a data dictionary we can obtain a list of all of the fields in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">penguins_cols <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(palmerpenguins<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>penguins)</span></code></pre></div>
</div>
<p>In this case, we can simple mock a fake dataset using the column names, write it to an in-memory database, generate SQL, and style the output as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make fake dataset ----</span></span>
<span id="cb28-2">penguins_mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(penguins_cols)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb28-3">penguins_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(penguins_mat), penguins_cols)</span>
<span id="cb28-4">penguins_dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex
1       1      1              1             1                 1           1   1
  year
1    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># copy to database ----</span></span>
<span id="cb30-2">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> DBI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dbname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb30-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_to</span>(con, penguins_dat, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins_mock"</span>)</span>
<span id="cb30-4">penguins_mock <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins_mock"</span>)</span>
<span id="cb30-5"></span>
<span id="cb30-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate sql ----</span></span>
<span id="cb30-7">penguins_aggr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb30-8">  penguins_mock <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb30-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb30-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOT_{.col}"</span>),</span>
<span id="cb30-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VAR_{.col}"</span>),</span>
<span id="cb30-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AVG_{.col}"</span>),</span>
<span id="cb30-15">  )</span>
<span id="cb30-16"></span>
<span id="cb30-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>(penguins_aggr)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `species`, COUNT(*) AS `N`, SUM(`bill_length_mm`) AS `TOT_bill_length_mm`, SUM(`bill_depth_mm`) AS `TOT_bill_depth_mm`, SUM(`flipper_length_mm`) AS `TOT_flipper_length_mm`, VARIANCE(`bill_length_mm`) AS `VAR_bill_length_mm`, VARIANCE(`bill_depth_mm`) AS `VAR_bill_depth_mm`, VARIANCE(`flipper_length_mm`) AS `VAR_flipper_length_mm`, AVG(`bill_length_mm`) AS `AVG_bill_length_mm`, AVG(`bill_depth_mm`) AS `AVG_bill_depth_mm`, AVG(`flipper_length_mm`) AS `AVG_flipper_length_mm`
FROM `penguins_mock`
GROUP BY `species`</code></pre>
</div>
</div>
<p>The only caution with this approach is that one should not use <em>type-driven</em> select helpers such <code>summarize_if(is.numeric, ...)</code> because our mock data has some erroneous types (e.g.&nbsp;<code>species</code>, <code>island</code>, and <code>sex</code> are erroneously numeric). Thus, we could generate SQL that would throw errors when applied to actual data. For example, the following SQL code attempts to sum up islands. This is perfectly reasonably given our dummy dataset but would be illogical and problematic when applied in production.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">penguins_mock <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize_if</span>(is.numeric, sum) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `species`, SUM(`island`) AS `island`, SUM(`bill_length_mm`) AS `bill_length_mm`, SUM(`bill_depth_mm`) AS `bill_depth_mm`, SUM(`flipper_length_mm`) AS `flipper_length_mm`, SUM(`body_mass_g`) AS `body_mass_g`, SUM(`sex`) AS `sex`, SUM(`year`) AS `year`
FROM `penguins_mock`
GROUP BY `species`</code></pre>
</div>
</div>
</section>
<section id="caveats" class="level2">
<h2 class="anchored" data-anchor-id="caveats">Caveats</h2>
<p>I have found this combination of tools to be useful for generating readable, typo-free queries when doing a large number of queries. However, I will end by highlighting when this may not be the best approach.</p>
<p><strong><code>dbplyr</code> is not intended to generate SQL.</strong> There’s always a risk when using tools for something other than their primary intent. <code>dbplyr</code> is no exception. Overall, it does an excellent job translating SQL and being aware of the unique flavor of various SQL backends. However, translating between languages is a challenging problem, and sometimes the SQL translation may not be the most computationally efficient (e.g.&nbsp;requiring more subqueries) or semantic approach. For multistep or multitable problems, you may wish to use this approach simple for generating a few painful SQL chunks instead of your whole script.</p>
<p><strong><code>dbplyr</code> <em>is</em> intended for you to <em>not</em> look at the SQL.</strong> One major benefit of <code>dbplyr</code> for R users is distinctly to <em>not</em> change languages and to benefit from a database’s compute power while staying in R. Not only is this use case not the intended purpose, you could go as far as to argue it is almost antithetical. Nevertheless, I do think there are many cases where one should preserve SQL independently; for example, you might need to do data tranformations in a production pipeline that does not run R, not wish to take on additional code dependencies, not be able to connect to your database with R, or be collaborating with non-R users.</p>
<p><strong><code>sqlfluff</code> is still experimental.</strong> As the developers emphasized in their DBT talk, <code>sqlfluff</code> is still in its early changes and subject to change. While I’m optimistic that this only means this tool will only keep getting better, it’s possible the exact rules, configuration, flags, syntax, etc. may change. Check out the docs for the latest documentation there.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>That being said, for SQL <a href="https://docs.getdbt.com/tutorial/using-jinja"><code>dbt</code> with Jinja templating support</a> is an intriguing option↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>data</category>
  <category>sql</category>
  <category>tutorial</category>
  <guid>https://emilyriederer.com/post/sql-generation/index.html</guid>
  <pubDate>Sat, 16 Jan 2021 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/sql-generation/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Introducing the {convo} package</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/convo-intro/index.html</link>
  <description><![CDATA[ 




<p>Back in September, I wrote about how <a href="../../post/column-name-contracts">controlled vocabularies</a> can help form contracts between data producers and consumers. In short, I argued that aligning on an ontology of stub names for use naming variables in a dataset can improve data documentation, validation, and wrangling with minimal overhead.</p>
<p>However, all of these benefits assume <em>absolute consistency</em> in the use of the controlled vocabulary. As soon as typos creep into variable names or fields violate the supposed data validation checks that their stubs promise, these vocabularies become more of a liability than an asset by luring data consumers into complacency.</p>
<p>I’m pleased to announced the experimental <a href="https://emilyriederer.github.io/convo/index.html"><code>convo</code></a> package to enable the definition and application of controlled vocabularies. In this post, I briefly describe the key features. Please see the package website for full documentation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(convo)</span></code></pre></div>
</div>
<section id="defining-your-vocabulary" class="level2">
<h2 class="anchored" data-anchor-id="defining-your-vocabulary">Defining your vocabulary</h2>
<p><code>convo</code> uses a YAML specification to define controlled vocabularies. Stubs are defined at each level which can optionally take on additional fields such as <code>desc</code> (a human-readable description), <code>valid</code> (which specifies <code>pointblank</code>-style data validation checks), and <code>rename</code> (which specifies how variable names should change under certain computations).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">filepath <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ex-convo.yml"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"convo"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(filepath), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>level1:
  ID:
    desc: Unique identifier
    valid:
      - col_vals_not_null()
      - col_is_numeric()
      - col_vals_between(1000, 99999)
  IND:
    desc: Binary indicator
    valid:
      - col_is_numeric()
      - col_vals_in_set(c(0,1))
    rename:
      - when: SUM
        then: 'N'
      - when: AVG
        then: P
  AMT:
    desc: Non-negative, summable quantity
    valid:
      - col_is_numeric()
      - col_vals_gte(0)
  VAL:
    desc: Value
    valid:
      - col_is_numeric()
    rename:
      - when: AVG
        then: VALAV
  CAT:
    desc: Category
    valid:
      - col_is_character()
  CD:
    desc: System-generated code
    valid:
      - col_is_character()
  DT:
    desc: Calendar date in YYYY-MM-DD format
    valid:
      - col_is_date()
level2:
  A:
    desc: Type A
  C:
    desc: Type C
  D:
    desc: Type D
level3:
  "\\d{4}": []</code></pre>
</div>
</div>
<p>We can read this into R and retrieve a brief summary. Note that in this case the third-level stub allows for a regular expression to be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">convo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_convo</span>(filepath)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(convo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Level 1
- ID
- IND
- AMT
- VAL
- CAT
- CD
- DT
Level 2
- A
- C
- D
Level 3
- \d{4}</code></pre>
</div>
</div>
<p>Alternatively, you may define a <code>convo</code> as a simple R list object (as shown when <code>bad_convo</code> is defined in the following two examples.)</p>
</section>
<section id="assessing-vocabulary-quality" class="level2">
<h2 class="anchored" data-anchor-id="assessing-vocabulary-quality">Assessing vocabulary quality</h2>
<p>Good features of a vocabulary stubs include <em>monosemy</em> (having only one meaning) and <em>unique</em> (being the only thing to mean that thing). Functions <code>pivot_convo()</code> and <code>cluster_convo()</code> help us spot deviations from these two properties. To illustrate these functions, I’ll use a different <code>convo</code> than above since that one exhibits both monosemy and uniqueness already.</p>
<p><code>pivot_convo()</code> allows us to obtain all of the level indices at which each stub appears. When the <code>repeats_only</code> argument is set to the default value <code>TRUE</code>, this function only returns stubs that exist at multiple levels, thus violating monsemy. For example, this function could help us realize that we had used the stub “CAT” to refer both to a categorical variable and an animal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">bad_convo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAT"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DOG"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAT"</span>))</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_convo</span>(bad_convo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$CAT
[1] 1 2</code></pre>
</div>
</div>
<p>Similarly, <code>cluster_convo()</code> attempts to catch errors in uniqueness by clustering stubs based on string similarity. This can highlight similar but distinct stubs, which might arise when a common word or concept is abbreviated in different ways. In the following example, “ACCOUNT”, “ACCT”, and “ACCNT” are closely clustered in the second level, which might help us realize that all three are intended to represent a customer’s account.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">bad_convo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IS"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMOUNT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD"</span>),</span>
<span id="cb8-2">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACCOUNT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACCT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACCNT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PROSPECT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CUSTOMER"</span>))</span>
<span id="cb8-3">clusts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cluster_convo</span>(bad_convo)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(clusts[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/convo-intro/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="evaluating-variable-names" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-variable-names">Evaluating variable names</h2>
<p>Having defined a <code>convo</code>, we can next use it to evaluate variable names. The <code>evaluate_convo()</code> function accepts a <code>convo</code> object and a set of names in a vector. It returns any variable names that violate the controlled vocabulary, listed at the specific level in which the violation occurs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">col_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XYZ_D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT_Q"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID_A_1234"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID_A_12"</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_convo</span>(convo, col_names, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Level 1
- XYZ_D
Level 2
- AMT_B
- AMT_Q
Level 3
- ID_A_12</code></pre>
</div>
</div>
<p>If a large number of violations occur, it might be more useful to directly retrieve all of the stubs existing in variable names that are not part of the <code>convo</code>. To do this, we can use set operators available in the <code>compare_convo()</code> function to examing the unions, intersections, and set differences between our controlled vocabulary and our variable names. Doing so might inspire new candidate stubs that ought to be included in our controlled vocabulary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">convo_colnames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_stubs</span>(col_names)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_convo</span>(convo_colnames, convo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fx =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"setdiff"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Level 1
- XYZ
Level 2
- B
- Q
Level 3
- 12</code></pre>
</div>
</div>
<p>If desired, newly uncovered stubs can be added to the <code>convo</code> object in R with the <code>add_convo_stub()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">convo2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_convo_stub</span>(convo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stub =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">desc =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type B"</span>)</span>
<span id="cb13-2">convo2 </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Level 1
- ID
- IND
- AMT
- VAL
- CAT
- CD
- DT
Level 2
- A
- C
- D
- B
Level 3
- \d{4}</code></pre>
</div>
</div>
<p>Currently, there is not support for editing the YAML specification via R function. New stubs would need to be added manually. However, a completely new YAML file can be created with the <code>write_convo()</code> function. This is particularly useful if you are creating a controlled vocabulary for the first time based on an existing set of variables names. First, you may parse them with <code>parse_stubs()</code> to create a minimal controlled vocabulary (stubs without descriptions, validation checks, etc.) and then you may write this to a draft YAML file for further customization.</p>
</section>
<section id="validating-data-fields" class="level2">
<h2 class="anchored" data-anchor-id="validating-data-fields">Validating data fields</h2>
<p>The validation checks specified with <code>pointblank</code> verbs in your YAML file can be used to create either a <code>pointblank</code> agent or a <code>pointblank</code> <a href="https://rich-iannone.github.io/pointblank/reference/yaml_read_agent.html">YAML file</a> which can be used to consistently apply all of the promised data checks.</p>
<p>The <code>pointblank</code> YAML file may be created with the <code>write_pb()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_pb</span>(convo, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT_B"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filename =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"convo-validation.yml"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"convo-validation.yml"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>read_fn: ~setNames(as.data.frame(matrix(1, ncol = 2)), c("IND_A", "AMT_B"))
tbl_name: ~
label: '[2021-02-09|05:57:05]'
locale: en
steps:
- col_is_numeric:
    columns: matches("^([A-Za-z]_){0}IND")
- col_vals_in_set:
    columns: matches("^([A-Za-z]_){0}IND")
    set:
    - 0.0
    - 1.0
- col_is_numeric:
    columns: matches("^([A-Za-z]_){0}AMT")
- col_vals_gte:
    columns: matches("^([A-Za-z]_){0}AMT")
    value: 0.0</code></pre>
</div>
</div>
<p>Alternatively, a validation agent can be created directly with <code>create_pb_agent()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">data_to_validate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IND_A =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IND_B =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">DT_B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-01-01"</span>))</span>
<span id="cb18-2">agent <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_pb_agent</span>(convo, data_to_validate)</span>
<span id="cb18-3">pointblank<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interrogate</span>(agent)</span></code></pre></div>
</div>
</section>
<section id="document-fiels-and-vocabularies" class="level2">
<h2 class="anchored" data-anchor-id="document-fiels-and-vocabularies">Document fiels and vocabularies</h2>
<p><code>convo</code> also offers preliminary support for documentation.</p>
<p>Basic data dictionaries may be created with <code>describe_names()</code> which attempts to create definitions for fields based on a user-provided glue string and YAML-specified stub definitions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">vars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMT_A_2019"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_C_2020"</span>)</span>
<span id="cb19-2">desc_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">describe_names</span>(vars, convo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">desc_str =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{level1} of {level2} in given year"</span>)</span>
<span id="cb19-3">DT<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(desc_df)</span></code></pre></div>
</div>
<p><img src="https://emilyriederer.com/post/convo-intro/data-docs.PNG" class="img-fluid"></p>
<p>Alternatively, the entire controlled vocabulary may be put into a dictionary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">desc_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">describe_convo</span>(convo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">include_valid =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">for_DT =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb20-2">DT<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(desc_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">escape =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p><img src="https://emilyriederer.com/post/convo-intro/convo-docs.PNG" class="img-fluid"></p>
<p>(The tables actually look much nicer when displayed with the full power of <code>DT</code>, which also allows for interactive filtering and sorting. Unfortunately, the Javascript behind DT causes a weird conflict with my static site generator weird interactions with my blog theme, so I just show screenshots here.)</p>
</section>
<section id="open-issues" class="level2">
<h2 class="anchored" data-anchor-id="open-issues">Open issues</h2>
<p><code>convo</code> is still very experimental and there are many open questions. Currently, I’m debating many aspects of <code>convo</code> specification including:</p>
<ul>
<li>What other formats should be allowed for defining a controlled vocabulary? Should there be a spreadsheet/CSV-based format? More support for constructing the object in R directly?</li>
<li>Currently, the separators between levels are specified in the function calls.
<ul>
<li>Should this be part of the <code>convo</code> object instead?</li>
<li>Should there be support for varying selectors at different levels (e.g.&nbsp;this would generalize better to using <code>convo</code> to validate file names with <code>/</code> delimiting directories and subdirectories and <code>_</code> or <code>-</code> used in parts of file names)</li>
</ul></li>
<li><code>convo</code> assumes prefix-based schemes with names start and “grow” from the beginning. Should suffix-based scheme be supported?
<ul>
<li>One on hand, this provides significantly more flexibility</li>
<li>On the other hand, I do strongly believe there are advantages to prefixed-based names (e.g.&nbsp;autocomplete, related concepts clustering when sorted) and any additional flexibility will make the initial specification increasingly gnarly for users</li>
</ul></li>
<li>Should specification allow truly hierarchical naming structures where allowed stubs at level <code>n+1</code> vary by the stub at level <code>n</code>?</li>
<li>Should it be possible to mark some levels are required? Currently, no levels may be “skipped” but if five levels are specified, the software permits derived names of lengths fewer or greater than 5 (so long as any existing levels 1-5 follow the format)</li>
<li>Would it be useful to be able to programmatically edit the YAML file specification within R? What is the use case for this?</li>
<li>Currently, the <code>describe</code> function family is rather primitive. I hope to make this more aesthetic or integrate more deeply with <code>pointblank</code></li>
</ul>
<p>If you are interested, please take the package for a spin and do not hesitate to get in touch about these issues or any other ideas you have! Seeing more use cases beyond my own helps me understand which of these ideas add value versus unneccesary bloat and confusion.</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>pkgdev</category>
  <category>data</category>
  <guid>https://emilyriederer.com/post/convo-intro/index.html</guid>
  <pubDate>Wed, 30 Dec 2020 06:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/convo-intro/featured.png" medium="image" type="image/png" height="75" width="144"/>
</item>
<item>
  <title>crosstalk: Dynamic filtering for R Markdown</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/crosstalk/index.html</link>
  <description><![CDATA[ 




<p>This week, I was pleased to become an official <a href="https://education.rstudio.com/trainers">RStudio Certified Instructor</a> after completing Greg Wilson’s training program, based on his excellent book <a href="http://teachtogether.tech/">Teaching Tech Together</a>. Part of the certification process involved teaching a 10 minute lesson. I chose to create a brief introduction to using the <code>crosstalk</code> package for dynamic interaction and filtering of plots, maps, and tables.</p>
<p>The primary intent of this post is simply to point out these materials, which are available on <a href="https://github.com/emilyriederer/demo-crosstalk">GitHub</a>. The lesson teaches the skills needed to create an three-panel application like <a href="https://emilyriederer.github.io/demo-crosstalk/analysis/demo.html">this</a> (as shown in the screnshot above) with a scatterplot, map, and table comparing ridership at a sample of Chicago train stations in April of 2019 versus 2020 (not long after COVID shutdowns).</p>
<p>To make this more accessible, I converted to previous “lecture” component into a <a href="https://emilyriederer.github.io/demo-crosstalk/tutorial/tutorial-rmd.html">step-by-step tutorial</a> hosted on the repo’s GitHub Pages.<sup>1</sup></p>
<p><img src="https://emilyriederer.com/post/crosstalk/tutorial.png" class="img-fluid"></p>
<p>Not convinced? Let me tell you just a bit more about <code>crosstalk</code>.</p>
<p><code>crosstalk</code> is, in my opinion, an exciting and underutilized tool for interactive graphics. Shiny is the R world’s go-to tool for creating interactive applications. However, Shiny has a higher learning curve and can be difficult to share with non-R users because it must be deployed on a server. <code>crosstalk</code>, on the other hand, requires minimal additional syntax and enables browser-based interactions which can be shared in a typical HTML R Markdown output.</p>
<p>This convenience comes at the cost of the feature set. <code>crosstalk</code> can handle interactive <em>filtering</em> and <em>highlighting</em> across multiple plots, maps, and tables to feature the same data subsets. However, unlike Shiny, t cannot do operations that would require R to recompute the data (for example, aggregation or refitting a model). Arguably, this limitation can also be a strength of <code>crosstalk</code>; since interaction is limited, the onus still lies firmly on the analyst to find a clear story and think carefully about which relationships to highlight.</p>
<p>Let’s look at an example.</p>
<p><img src="https://emilyriederer.com/post/crosstalk/comparison.png" class="img-fluid"></p>
<p>The screenshots above demonstrate the types of exploration that can be done with <code>crosstalk</code>’s dynamic filtering. In the overall scatterplot (above), we see a positive correlation between a higher proportion of weekend (versus weekend) trips in 2019 and lower declines in ridership from 2019 to 2020. This makes sense since business areas have lower weekend travel and would also be more affected by “stay at home” orders. We can use <code>crosstalk</code> to confirm this theory. Highlight the stations with the greatest decline in trips (left), Chicagoans could quickly recognize the mapped stations to be in the Chicago Loop, the heart of the business district. Conversely, those with the greatest weekend travel and lowest ride decline tend to be located in more residential areas on the west and south sides. (This is, of course, a rather simplistic outcome. I simply use this example to illustrate how the different pieces come together; not to draw any particular conclusion.) You can recreate these exact views in the <a href="https://emilyriederer.github.io/demo-crosstalk/analysis/demo.html">demo</a>, as linked above.</p>
<p>If <a href="https://emilyriederer.github.io/demo-crosstalk/tutorial/tutorial-rmd.html">this tutorial</a> peaks your curiosity, check our package developer Carson Sievert’s book <a href="https://plotly-r.com/index.html">Interactive web-based data visualization with R, plotly, and shiny</a> from CRC Press for more information and advanced features.</p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Initially, I was going to republish the post in it’s entirety, but be warned: <code>hugodown</code>, which I was then using to publish my blog has <a href="https://github.com/r-lib/hugodown/issues/36">known issues</a> with including output from <code>htmlwidgets</code> R packages (such as <code>leaflet</code> and <code>DT</code>) in the Hugo Academic theme. This is not a problem with Quarto, normal <code>rmarkdown::html_output</code>, or <a href="https://github.com/rstudio/blogdown/issues/7"><code>blogdown</code></a>. ↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>tutorial</category>
  <guid>https://emilyriederer.com/post/crosstalk/index.html</guid>
  <pubDate>Sat, 12 Sep 2020 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/crosstalk/featured.png" medium="image" type="image/png" height="128" width="144"/>
</item>
<item>
  <title>Column Names as Contracts</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/column-name-contracts/index.html</link>
  <description><![CDATA[ 




<p>Software products use a range of strategies to make promises or contracts with their users. Mature code packages and APIs document expected inputs and outputs, check adherence with unit tests, and transparently report code coverage. Programs with graphical user interfaces form such contracts by labeling and illustrating interactive components to explain their intent (for example, the “Save” button typically does not bulk-delete files).</p>
<p>Published data tables, however, exist in an ambiguous gray area; static enough not to be considered a “service” or “software”, yet too raw to earn the attention to user experience given to interfaces. This ambiguity can create a strange symbiosis between data producers and consumers. Producers may publish whatever data is accessible by the system or seems relevant, and consumers may be quick to assume tables or fields that “sound right” happen to be custom-fit for their top-of-mind question. Producers wonder why consumers aren’t satisfied, and consumers wonder why the data is never “right”.</p>
<p>Metadata management solutions aim to solve this problem, and there are many promising developments in this space including Lyft’s <a href="https://eng.lyft.com/amundsen-lyfts-data-discovery-metadata-engine-62d27254fbb9">Amundsen</a>, LinkedIn’s <a href="https://engineering.linkedin.com/blog/2019/data-hub">DataHub</a>, and Netflix’s <a href="https://netflixtechblog.com/building-and-scaling-data-lineage-at-netflix-to-improve-data-infrastructure-reliability-and-1a52526a7977">Metacat</a>. However, metadata solutions generally require a great degree of cooperation: producers must vigilantly maintain the documentation and consumers must studiously check it – despite such tools almost always living outside of either party’s core toolkit and workflow.</p>
<p>Using <a href="https://en.wikipedia.org/wiki/Controlled_vocabulary">controlled vocabularies</a> for column names is a low-tech, low-friction approach to building a shared understanding of how each field in a data set is intended to work. In this post, I’ll introduce the concept with an example and demonstrate how controlled vocabularies can offer lightweight solutions to rote data validation, discoverability, and wrangling. I’ll illustrate these usability benefits with R packages including <code>pointblank</code>, <code>collapsibleTree</code>, and <code>dplyr</code>, but we’ll conclude by demonstrating how the same principles apply to other packages and languages.</p>
<section id="controlled-vocabulary" class="level2">
<h2 class="anchored" data-anchor-id="controlled-vocabulary">Controlled Vocabulary</h2>
<p>The basic idea of controlled vocabularies is to define upfront a set of words, phrases, or stubs with well-defined meanings which can be used to index information. When these stubs are defined for different types of information and pieces together in a consistent order, the vocabulary becomes a descriptive grammar that we can use to describe more complex content and behavior.</p>
<p>In the context of a data set, this vocabulary can also serve as a latent contract between data producers and data consumers and carry promises regarding different aspects of the data lineage, valid values, and appropriate uses. When used consistently across all of an organization’s tables, it can significantly scale data management and increase usability as knowledge from working with one dataset easily transfers to another.</p>
<p>For example, imagine we work at a ride-share company and are building a data table with one record per trip. What might a controlled vocabulary look like?<sup>1</sup></p>
<p><strong>Level 1: Measure Types</strong></p>
<p>For reasons that will be evident in the examples, I like the first level of the hierarchy to generally capture a semi-generic “type” of the variable. This is not quite the same as data types in a programming language (e.g.&nbsp;<code>bool</code>, <code>double</code>, <code>float</code>) although everything with the same prefix should ultimately be cast in the same type. Instead, these data types imply both a type of information and appropriate usage patterns:</p>
<ul>
<li><code>ID</code>: Unique identified for an entity.
<ul>
<li>Numeric for more efficient storage and joins unless system of record generates IDs with characters</li>
<li>Likely a primary key in some other table</li>
</ul></li>
<li><code>IND</code>: Binary 0 or 1 indicator or an event occurrence
<ul>
<li>Because always 0 or 1, can be averaged to find proportion occurrence</li>
<li>Can consider calling <code>IS</code> instead of <code>IND</code> for even less ambiguity which case is labeled 1</li>
</ul></li>
<li><code>N</code>: Count of quantity or event occurrence
<ul>
<li>Always a non-negative integer</li>
</ul></li>
<li><code>AMT</code>: Sum-able real number amount. That is, any non-count amount that is “denominator-free”</li>
<li><code>VAL</code>: Numeric variables that are not inherently sum-able
<ul>
<li>For example, rates and ratios that cannot be combined or numeric values like latitude and longitude for which typical arithmetic operations don’t make sense</li>
</ul></li>
<li><code>DT</code>: Date of some event
<ul>
<li>Always cast as a <code>YYYY-MM-DD</code> date</li>
</ul></li>
<li><code>TM</code>: Time stamp of some event
<ul>
<li>Always cast as a <code>YYYY-MM-DD HH:MM:SS</code> time stamp</li>
<li>Distinguishing dates from time stamps will avoid faulty joins of two date fields arranged differently</li>
</ul></li>
<li><code>CAT</code>: Categorical variable as a character string (potentially encoded from an <code>ID</code> field)</li>
</ul>
<p>While these are relatively generic, domain-specific categories can also be used. For example, since location is so important for ride-sharing, it might be worth having <code>ADDR</code> as a level 1 category.</p>
<p><strong>Level 2: Measure Subjects</strong></p>
<p>The best hierarchy varies widely by industry and the <em>overall contents of a database</em> – not just one table. Here, we expect to be interested in trip-attributed about many different subjects: the rider, driver, trip, etc. so the measure subject might be the logical next tier. We can define:</p>
<ul>
<li><code>DRIVER</code>: Information about the driver</li>
<li><code>RIDER</code>: Information about the rider, the passenger who called the ride-share</li>
<li><code>TRIP</code>: Information about the trip itself</li>
<li><code>ORIG</code>: Information about the trip start (time and geography)</li>
<li><code>DEST</code>: Information about the trip destination (time and geography)</li>
<li><code>COST</code>: Information about components of the total cost (could be a subset of <code>TRIP</code>, but pertains to all parties and has high cardinality at the next tier, so we’ll break it out)</li>
</ul>
<p>Of course, in a highly normalized database, measures of these different entities would exist in separate tables. However, this discipline in naming them would still be beneficial so quantities are unambiguous when an analyst combines them.</p>
<p><strong>Levels 3-n: Details</strong></p>
<p>The first few tiers of the hierarchy are critical to standardize to make our “performance promises” and to aid in data searchability. Later levels will be measure specific and may not be worth defining upfront. However, for concepts that are going to exist across many tables, it is worthwhile to pre-specify their names and precise formats. For example:</p>
<ul>
<li><code>CITY</code>: Should this be in all upper case? How should spaces in city name be treated?</li>
<li><code>ZIP</code>: Should 6 digit or 10 digit zip codes be used?</li>
<li><code>LAT</code>/<code>LON</code>: To how many decimals should latitude and longitude be geocoded? If the company only operate in certain geographic areas (e.g.&nbsp;the continental US), coarse cut-offs for these can be determined</li>
<li><code>DIST</code>: Is distance measured in miles? Kilometers?</li>
<li><code>TIME</code>: Are durations measured in seconds? Minutes?</li>
<li><code>RATING</code>: What are valid ranges for other known quantities like star ratings?</li>
</ul>
<p>Terminal “adjectives” could also be considered. For example, if the data-generating systems spit out analytically unideal quantities that should be preserved for data lineage purposes, suffixes such as <code>_RAW</code> and <code>_CLEAN</code> might denote version of the same variable in its original and manicured states, respectively.</p>
<p><strong>Putting it all together</strong></p>
<p>This structure now gives us a grammar to compactly name 35 variables in table:</p>
<ul>
<li><code>ID_{DRIVER | RIDER | TRIP}</code>: Unique identifier for party of the ride</li>
<li><code>DT_{ORIG | DEST}</code>: Date at the trip’s start and end, respectively</li>
<li><code>TM_{ORIG | DEST}</code>: Timestamp at the trip’s start and end, respectively</li>
<li><code>N_TRIP_{PASSENGERS | ORIG | DEST}</code> Count of unique passengers, pick-up points, and drop-off points for the trip</li>
<li><code>N_DRIVER_SEATS</code>: Count of passenger seats available in the driver’s car</li>
<li><code>AMT_TRIP_{DIST | TIME}</code>: Total trip distance in miles traveled and time taken</li>
<li><code>AMT_COST_{TIME | DIST | BASE | FEES | SURGE | TIPS}</code>: Amount of each cost component</li>
<li><code>IND_SURGE</code>: Indicator variable if ride caled during surge pricing</li>
<li><code>CAT_TRIP_TYPE</code>: Trip type, such as ‘Pool’, ‘Standard’, ‘Elite’</li>
<li><code>CAT_RIDER_TYPE</code>: Rider status, such as ‘Basic’, ‘Frequent’, ‘Subscription’</li>
<li><code>VAL_{DRIVER | RIDER}_RATING</code>: Average star rating of rider and driver</li>
<li><code>ADDR_{ORIG | DEST}_{STREET | CITY | STATE | ZIP}</code>: Address components of trip’s start and end</li>
<li><code>VAL_{ORIG | DEST}_{LAT | LON}</code>: Latitude and longitude of trip’s start and end</li>
</ul>
<p>The fact that we can describe 35 variables in roughly 1/3 the number of rows already speaks to the value of this structure in helping data consumers build a strong mental model to quickly manipulate the data. But now we can demonstrate far greater value.</p>
<p>To start, we create a small fake data set using our schema. For simplicity, I simulate 18 of the 35 variables listed above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_trips)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_DRIVER ID_RIDER ID_TRIP    DT_ORIG    DT_DEST N_DRIVER_PASSENGERS
1      1029     1520    7682 2019-08-07 2019-08-07                   2
2      9294     3461    1490 2019-03-30 2019-03-30                   2
3      4904     2826    1764 2019-08-27 2019-08-27                   2
4      6937     8364    1842 2019-05-01 2019-05-01                   2
5      1377     9223    9227 2019-07-14 2019-07-14                   1
6      5767     5005    5616 2019-04-14 2019-04-14                   1
  N_TRIP_ORIG N_TRIP_DEST AMT_TRIP_DIST IND_SURGE VAL_DRIVER_RATING
1           1           1      32.55653         1          2.385012
2           1           1      36.49731         0          2.529680
3           1           1      40.04109         0          4.417074
4           1           1      31.95087         0          4.312145
5           1           1      41.82485         1          2.734805
6           1           1      33.92214         0          4.829972
  VAL_RIDER_RATING VAL_ORIG_LAT VAL_DEST_LAT VAL_ORIG_LON VAL_DEST_LON
1         3.123530     41.60704     41.20487     86.72199     98.95445
2         4.852908     40.55550     40.14035     89.21445    110.76930
3         1.968365     41.18290     41.76558     92.56702    110.52004
4         4.074426     40.64971     40.45868     75.06746     72.53508
5         3.886951     40.10458     40.15908     86.91200     92.70651
6         3.349862     40.53041     40.81622    118.19481    107.63962
  CAT_TRIP_TYPE CAT_RIDER_TYPE
1      Standard          Basic
2      Standard       Frequent
3         Elite          Basic
4          Pool          Basic
5      Standard   Subscription
6         Elite          Basic</code></pre>
</div>
</div>
</section>
<section id="data-validation" class="level2">
<h2 class="anchored" data-anchor-id="data-validation">Data Validation</h2>
<p>The “promises” in variable names aren’t just there for decoration. They can actually help producers publish higher quality data my helping to automate data validation checks. Data quality is context-specific and requires effort on the consumer side, but setting up safeguards in any data pipeline can help detect and eliminate commonplace errors like duplicated or corrupt data.</p>
<p>Of course, setting up data validation pipelines isn’t the most exciting part of any data engineer’s job. But that’s where R’s <code>pointblank</code> package comes to the rescue with an excellent domain-specific language for common assertive data checks. Combining this syntax with <code>dplyr</code>’s “select helpers” (such as <code>starts_with()</code>), the same validation pipeline could ensure many of the data’s promises are kept with no additional overhead. For example, <code>N_</code> columns should be strictly non-negative and <code>IND_</code> columns should always be either 0 or 1.</p>
<p>The following example demonstrate the R syntax to write such a pipeline in <code>pointblank</code>, but the package also allows rules to be specified in a standalone YAML file which could further increase portability between projects.</p>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pointblank)</span>
<span id="cb3-2"></span>
<span id="cb3-3">agent <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-4">  data_trips <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_agent</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">actions =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">action_levels</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stop_at =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_gte</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_gte</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_not_null</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_in_set</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_is_date</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DT"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matches</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_LAT(_|$)"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_vals_between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matches</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_LON(_|$)"</span>), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">162</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interrogate</span>()</span></code></pre></div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">agent</span></code></pre></div>
<div class="cell-output-display">

<div id="pb_agent" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://unpkg.com/balloon-css/balloon.min.css");
html {
  font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pb_agent .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 90%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pb_agent .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pb_agent .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pb_agent .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pb_agent .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pb_agent .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pb_agent .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pb_agent .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pb_agent .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pb_agent .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pb_agent .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pb_agent .gt_from_md > :first-child {
  margin-top: 0;
}

#pb_agent .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pb_agent .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pb_agent .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pb_agent .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pb_agent .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pb_agent .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pb_agent .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pb_agent .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pb_agent .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pb_agent .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pb_agent .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pb_agent .gt_left {
  text-align: left;
}

#pb_agent .gt_center {
  text-align: center;
}

#pb_agent .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pb_agent .gt_font_normal {
  font-weight: normal;
}

#pb_agent .gt_font_bold {
  font-weight: bold;
}

#pb_agent .gt_font_italic {
  font-style: italic;
}

#pb_agent .gt_super {
  font-size: 65%;
}

#pb_agent .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}

#pb_agent {
  -webkit-font-smoothing: antialiased;
}

#pb_agent .gt_row {
  overflow: visible;
}

#pb_agent .gt_sourcenote {
  height: 35px;
  padding: 0;
}

#pb_agent code {
  font-family: 'IBM Plex Mono', monospace, courier;
  background-color: transparent;
  padding: 0;
}
</style>
<table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:6px;">
    <col style="width:35px;">
    <col style="width:190px;">
    <col style="width:120px;">
    <col style="width:120px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:30px;">
    <col style="width:30px;">
    <col style="width:30px;">
    <col style="width:65px;">
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="14" class="gt_heading gt_title gt_font_normal" style="color: #444444; font-size: 28px; text-align: left; font-weight: 500;">Pointblank Validation</th>
    </tr>
    <tr>
      <th colspan="14" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="font-size: 12px; text-align: left;"><span style="text-decoration-style:solid;text-decoration-color:#ADD8E6;text-decoration-line:underline;text-underline-position:under;color:#333333;font-variant-numeric:tabular-nums;padding-left:4px;margin-right:5px;padding-right:2px;">[2023-10-12|20:31:46]</span><p></p>
<div style="height:25px;"><span style="background-color: #9933CC;color: #FFFFFF;padding: 0.5em 0.5em;position: inherit;text-transform: uppercase;margin: 5px 1px 5px 4px;font-weight: bold;border: solid 1px #9933CC;padding: 2px 10px 2px 10px;font-size: smaller;">data frame</span><span style="background-color:#E5AB00;color:white;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 0px 5px 5px;font-weight:bold;border:solid 1px #E5AB00;padding:2px 15px 2px 15px;font-size:smaller;">WARN</span>
<span style="background-color:none;color:#333333;padding:0.5em 0.5em;position:inherit;margin:5px 0px 5px -4px;font-weight:bold;border:solid 1px #E5AB00;padding:2px 15px 2px 15px;font-size:smaller;">—</span>
<span style="background-color:#D0182F;color:white;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 0px 5px 1px;font-weight:bold;border:solid 1px #D0182F;padding:2px 15px 2px 15px;font-size:smaller;">STOP</span>
<span style="background-color:none;color:#333333;padding:0.5em 0.5em;position:inherit;margin:5px 0px 5px -4px;font-weight:bold;border:solid 1px #D0182F;padding:2px 15px 2px 15px;font-size:smaller;">0.00</span>
<span style="background-color:#499FFE;color:white;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 0px 5px 1px;font-weight:bold;border:solid 1px #499FFE;padding:2px 15px 2px 15px;font-size:smaller;">NOTIFY</span>
<span style="background-color:none;color:#333333;padding:0.5em 0.5em;position:inherit;margin:5px 0px 5px -4px;font-weight:bold;border:solid 1px #499FFE;padding:2px 15px 2px 15px;font-size:smaller;">—</span></div>
</th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">STEP</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">COLUMNS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">VALUES</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">TBL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">EVAL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">UNITS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">PASS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">FAIL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">W</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">S</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">N</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">EXT</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">1</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_DRIVER_PASSENGERS` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_DRIVER_PASSENGERS" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_DRIVER_PASSENGERS</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">2</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_TRIP_ORIG` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_TRIP_ORIG" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_TRIP_ORIG</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">3</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_TRIP_DEST` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_TRIP_DEST" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_TRIP_DEST</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">4</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_DRIVER_PASSENGERS` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_DRIVER_PASSENGERS" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_DRIVER_PASSENGERS</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">5</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_TRIP_ORIG` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_TRIP_ORIG" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_TRIP_ORIG</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">6</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `N_TRIP_DEST` should be >= `0`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 66" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_gte" transform="translate(-0.029895, -0.002188)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M49.712234,12 L17.712234,12 C14.952234,12 12.712234,14.24 12.712234,17 L12.712234,49 C12.712234,51.76 14.952234,54 17.712234,54 L49.712234,54 C52.472234,54 54.712234,51.76 54.712234,49 L54.712234,17 C54.712234,14.24 52.472234,12 49.712234,12 Z M44.712234,47 L22.712234,47 L22.712234,45 L44.712234,45 L44.712234,47 Z M24.182234,40.88 L23.242234,39.12 L40.562234,30 L23.242234,20.88 L24.182234,19.12 L44.862234,30 L24.182234,40.88 Z" id="greater_than_equal" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_gte()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="N_TRIP_DEST" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>N_TRIP_DEST</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">7</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that all values in `IND_SURGE` should not be NULL. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_not_null" transform="translate(-0.487938, 0.685124)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M40.6120805,47.037834 C37.4692348,47.037834 35.0126139,45.9348613 33.712234,44.0140597 C32.4118541,45.9348613 29.9552331,47.037834 26.8123883,47.037834 C22.6574397,47.037834 16.0646712,43.4437723 16.0646712,33.8021619 C16.0646712,29.3401361 17.4715879,18.962166 30.5035862,18.962166 C30.9454018,18.962166 31.3057481,19.3225124 31.3057481,19.7643279 L31.3057481,21.3686518 C31.3057481,21.8104674 30.9454018,22.1708138 30.5035862,22.1708138 C26.6400486,22.1708138 22.4819668,25.8118774 22.4819668,33.8021619 C22.4819668,37.5090277 23.7635456,43.0270243 27.2949384,43.0270243 C29.795428,43.0270243 31.224279,40.4231312 32.0985095,38.2861221 C30.5067194,35.6101596 29.7014243,33.1034035 29.7014243,30.8347892 C29.7014243,25.6238707 31.8603677,23.7751377 33.712234,23.7751377 C35.5641002,23.7751377 37.7230437,25.6238707 37.7230437,30.8347892 C37.7230437,33.1347383 36.9396828,35.5788255 35.3290916,38.2861221 C36.6294715,41.4321009 38.243196,43.0270243 40.1295295,43.0270243 C43.6609223,43.0270243 44.9425012,37.5090277 44.9425012,33.8021619 C44.9425012,25.8118774 40.7844193,22.1708138 36.9208817,22.1708138 C36.4759329,22.1708138 36.1187198,21.8104674 36.1187198,21.3686518 L36.1187198,19.7643279 C36.1187198,19.3225124 36.4759329,18.962166 36.9208817,18.962166 C49.9528801,18.962166 51.3597967,29.3401361 51.3597967,33.8021619 C51.3597967,43.4437723 44.7670282,47.037834 40.6120805,47.037834 Z" id="omega" fill="#000000" fill-rule="nonzero"></path>            <rect id="line_black" fill="#000000" transform="translate(33.000000, 33.000000) rotate(-320.000000) translate(-33.000000, -33.000000) " x="32.5" y="7.93597705" width="1" height="50.1280459" rx="0.5"></rect>            <rect id="line_white" fill="#FFFFFF" transform="translate(34.899496, 32.153303) rotate(-320.000000) translate(-34.899496, -32.153303) " x="34.3994962" y="8.54160469" width="1" height="47.2233972"></rect>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_vals_not_null()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="IND_SURGE" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>IND_SURGE</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">8</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `IND_SURGE` should be in the set of `0`, `1`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_in_set" transform="translate(-0.487938, 0.859210)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M44.127969,41.1538382 L31.0814568,41.1538382 C29.9510748,41.1536429 28.8827052,40.9256134 27.9079888,40.5136953 C26.4467442,39.8960136 25.19849,38.8599685 24.3189894,37.5577099 C23.8792391,36.906727 23.5314818,36.1899233 23.2936866,35.4252675 C23.2130217,35.16589 23.1460289,34.9005554 23.0913409,34.6307286 L44.1278714,34.6307286 C45.028466,34.6306309 45.7586488,33.9004481 45.7586488,32.9998535 C45.7586488,32.0992589 45.028466,31.3690761 44.1278714,31.3690761 L23.0905596,31.3690761 C23.1990567,30.8337194 23.3597028,30.3180894 23.5675173,29.8264831 C24.185199,28.3652386 25.2212442,27.1169844 26.5236004,26.2374838 C27.1745833,25.7977334 27.891387,25.4499762 28.6560428,25.2122786 C29.4208939,24.9744833 30.2334994,24.8459665 31.0813591,24.8459665 L44.1277737,24.8459665 C45.0283683,24.8459665 45.7585511,24.1157837 45.7585511,23.2151891 C45.7585511,22.3145945 45.0283683,21.5844117 44.1277737,21.5844117 L31.0813591,21.5844117 C29.5096643,21.5844117 28.0039858,21.9038483 26.6373711,22.4820765 C24.5866678,23.3498583 22.8469049,24.7950871 21.6163267,26.616296 C20.3856508,28.4362354 19.665136,30.6413347 19.6658196,33.0000488 C19.6656243,34.5717436 19.9852563,36.0774222 20.5635822,37.4440369 C21.4312663,39.4947402 22.8765927,41.2345031 24.697704,42.4650813 C26.5176434,43.6957572 28.7227427,44.4155883 31.0814568,44.4155883 L44.1278714,44.4155883 C45.028466,44.4155883 45.7586488,43.6854055 45.7586488,42.7848109 C45.7586488,41.8842163 45.0285636,41.1538382 44.127969,41.1538382 Z" id="set_of" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_in_set()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="IND_SURGE" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>IND_SURGE</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="0, 1" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>0, 1</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">9</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `DT_ORIG` is of type: Date. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_date" transform="translate(0.116964, 0.151308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="D" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="38.2942827" y="43.0146694">D</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_is_date()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="DT_ORIG" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>DT_ORIG</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">10</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `DT_DEST` is of type: Date. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_date" transform="translate(0.116964, 0.151308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="D" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="38.2942827" y="43.0146694">D</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_is_date()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="DT_DEST" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>DT_DEST</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">11</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `VAL_ORIG_LAT` should be between `19` and `65`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_between" transform="translate(-0.487938, 0.651308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M11.993484,21.96875 C10.962234,22.082031 10.188797,22.964844 10.212234,24 L10.212234,42 C10.200515,42.722656 10.579422,43.390625 11.204422,43.753906 C11.825515,44.121094 12.598953,44.121094 13.220047,43.753906 C13.845047,43.390625 14.223953,42.722656 14.212234,42 L14.212234,24 C14.220047,23.457031 14.009109,22.9375 13.626297,22.554688 C13.243484,22.171875 12.723953,21.960938 12.180984,21.96875 C12.118484,21.964844 12.055984,21.964844 11.993484,21.96875 Z M55.993484,21.96875 C54.962234,22.082031 54.188797,22.964844 54.212234,24 L54.212234,42 C54.200515,42.722656 54.579422,43.390625 55.204422,43.753906 C55.825515,44.121094 56.598953,44.121094 57.220047,43.753906 C57.845047,43.390625 58.223953,42.722656 58.212234,42 L58.212234,24 C58.220047,23.457031 58.009109,22.9375 57.626297,22.554688 C57.243484,22.171875 56.723953,21.960938 56.180984,21.96875 C56.118484,21.964844 56.055984,21.964844 55.993484,21.96875 Z M16.212234,22 C15.661453,22 15.212234,22.449219 15.212234,23 C15.212234,23.550781 15.661453,24 16.212234,24 C16.763015,24 17.212234,23.550781 17.212234,23 C17.212234,22.449219 16.763015,22 16.212234,22 Z M20.212234,22 C19.661453,22 19.212234,22.449219 19.212234,23 C19.212234,23.550781 19.661453,24 20.212234,24 C20.763015,24 21.212234,23.550781 21.212234,23 C21.212234,22.449219 20.763015,22 20.212234,22 Z M24.212234,22 C23.661453,22 23.212234,22.449219 23.212234,23 C23.212234,23.550781 23.661453,24 24.212234,24 C24.763015,24 25.212234,23.550781 25.212234,23 C25.212234,22.449219 24.763015,22 24.212234,22 Z M28.212234,22 C27.661453,22 27.212234,22.449219 27.212234,23 C27.212234,23.550781 27.661453,24 28.212234,24 C28.763015,24 29.212234,23.550781 29.212234,23 C29.212234,22.449219 28.763015,22 28.212234,22 Z M32.212234,22 C31.661453,22 31.212234,22.449219 31.212234,23 C31.212234,23.550781 31.661453,24 32.212234,24 C32.763015,24 33.212234,23.550781 33.212234,23 C33.212234,22.449219 32.763015,22 32.212234,22 Z M36.212234,22 C35.661453,22 35.212234,22.449219 35.212234,23 C35.212234,23.550781 35.661453,24 36.212234,24 C36.763015,24 37.212234,23.550781 37.212234,23 C37.212234,22.449219 36.763015,22 36.212234,22 Z M40.212234,22 C39.661453,22 39.212234,22.449219 39.212234,23 C39.212234,23.550781 39.661453,24 40.212234,24 C40.763015,24 41.212234,23.550781 41.212234,23 C41.212234,22.449219 40.763015,22 40.212234,22 Z M44.212234,22 C43.661453,22 43.212234,22.449219 43.212234,23 C43.212234,23.550781 43.661453,24 44.212234,24 C44.763015,24 45.212234,23.550781 45.212234,23 C45.212234,22.449219 44.763015,22 44.212234,22 Z M48.212234,22 C47.661453,22 47.212234,22.449219 47.212234,23 C47.212234,23.550781 47.661453,24 48.212234,24 C48.763015,24 49.212234,23.550781 49.212234,23 C49.212234,22.449219 48.763015,22 48.212234,22 Z M52.212234,22 C51.661453,22 51.212234,22.449219 51.212234,23 C51.212234,23.550781 51.661453,24 52.212234,24 C52.763015,24 53.212234,23.550781 53.212234,23 C53.212234,22.449219 52.763015,22 52.212234,22 Z M21.462234,27.96875 C21.419265,27.976563 21.376297,27.988281 21.337234,28 C21.177078,28.027344 21.02864,28.089844 20.899734,28.1875 L15.618484,32.1875 C15.356765,32.375 15.200515,32.679688 15.200515,33 C15.200515,33.320313 15.356765,33.625 15.618484,33.8125 L20.899734,37.8125 C21.348953,38.148438 21.985672,38.058594 22.321609,37.609375 C22.657547,37.160156 22.567703,36.523438 22.118484,36.1875 L19.212234,34 L49.212234,34 L46.305984,36.1875 C45.856765,36.523438 45.766922,37.160156 46.102859,37.609375 C46.438797,38.058594 47.075515,38.148438 47.524734,37.8125 L52.805984,33.8125 C53.067703,33.625 53.223953,33.320313 53.223953,33 C53.223953,32.679688 53.067703,32.375 52.805984,32.1875 L47.524734,28.1875 C47.30989,28.027344 47.040359,27.960938 46.774734,28 C46.743484,28 46.712234,28 46.680984,28 C46.282547,28.074219 45.96614,28.382813 45.884109,28.78125 C45.802078,29.179688 45.970047,29.585938 46.305984,29.8125 L49.212234,32 L19.212234,32 L22.118484,29.8125 C22.520828,29.566406 22.696609,29.070313 22.536453,28.625 C22.380203,28.179688 21.930984,27.90625 21.462234,27.96875 Z M16.212234,42 C15.661453,42 15.212234,42.449219 15.212234,43 C15.212234,43.550781 15.661453,44 16.212234,44 C16.763015,44 17.212234,43.550781 17.212234,43 C17.212234,42.449219 16.763015,42 16.212234,42 Z M20.212234,42 C19.661453,42 19.212234,42.449219 19.212234,43 C19.212234,43.550781 19.661453,44 20.212234,44 C20.763015,44 21.212234,43.550781 21.212234,43 C21.212234,42.449219 20.763015,42 20.212234,42 Z M24.212234,42 C23.661453,42 23.212234,42.449219 23.212234,43 C23.212234,43.550781 23.661453,44 24.212234,44 C24.763015,44 25.212234,43.550781 25.212234,43 C25.212234,42.449219 24.763015,42 24.212234,42 Z M28.212234,42 C27.661453,42 27.212234,42.449219 27.212234,43 C27.212234,43.550781 27.661453,44 28.212234,44 C28.763015,44 29.212234,43.550781 29.212234,43 C29.212234,42.449219 28.763015,42 28.212234,42 Z M32.212234,42 C31.661453,42 31.212234,42.449219 31.212234,43 C31.212234,43.550781 31.661453,44 32.212234,44 C32.763015,44 33.212234,43.550781 33.212234,43 C33.212234,42.449219 32.763015,42 32.212234,42 Z M36.212234,42 C35.661453,42 35.212234,42.449219 35.212234,43 C35.212234,43.550781 35.661453,44 36.212234,44 C36.763015,44 37.212234,43.550781 37.212234,43 C37.212234,42.449219 36.763015,42 36.212234,42 Z M40.212234,42 C39.661453,42 39.212234,42.449219 39.212234,43 C39.212234,43.550781 39.661453,44 40.212234,44 C40.763015,44 41.212234,43.550781 41.212234,43 C41.212234,42.449219 40.763015,42 40.212234,42 Z M44.212234,42 C43.661453,42 43.212234,42.449219 43.212234,43 C43.212234,43.550781 43.661453,44 44.212234,44 C44.763015,44 45.212234,43.550781 45.212234,43 C45.212234,42.449219 44.763015,42 44.212234,42 Z M48.212234,42 C47.661453,42 47.212234,42.449219 47.212234,43 C47.212234,43.550781 47.661453,44 48.212234,44 C48.763015,44 49.212234,43.550781 49.212234,43 C49.212234,42.449219 48.763015,42 48.212234,42 Z M52.212234,42 C51.661453,42 51.212234,42.449219 51.212234,43 C51.212234,43.550781 51.661453,44 52.212234,44 C52.763015,44 53.212234,43.550781 53.212234,43 C53.212234,42.449219 52.763015,42 52.212234,42 Z" id="inside_range" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_vals_between()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="VAL_ORIG_LAT" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>VAL_ORIG_LAT</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="[19, 65]" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>[19, 65]</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">12</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `VAL_DEST_LAT` should be between `19` and `65`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_between" transform="translate(-0.487938, 0.651308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M11.993484,21.96875 C10.962234,22.082031 10.188797,22.964844 10.212234,24 L10.212234,42 C10.200515,42.722656 10.579422,43.390625 11.204422,43.753906 C11.825515,44.121094 12.598953,44.121094 13.220047,43.753906 C13.845047,43.390625 14.223953,42.722656 14.212234,42 L14.212234,24 C14.220047,23.457031 14.009109,22.9375 13.626297,22.554688 C13.243484,22.171875 12.723953,21.960938 12.180984,21.96875 C12.118484,21.964844 12.055984,21.964844 11.993484,21.96875 Z M55.993484,21.96875 C54.962234,22.082031 54.188797,22.964844 54.212234,24 L54.212234,42 C54.200515,42.722656 54.579422,43.390625 55.204422,43.753906 C55.825515,44.121094 56.598953,44.121094 57.220047,43.753906 C57.845047,43.390625 58.223953,42.722656 58.212234,42 L58.212234,24 C58.220047,23.457031 58.009109,22.9375 57.626297,22.554688 C57.243484,22.171875 56.723953,21.960938 56.180984,21.96875 C56.118484,21.964844 56.055984,21.964844 55.993484,21.96875 Z M16.212234,22 C15.661453,22 15.212234,22.449219 15.212234,23 C15.212234,23.550781 15.661453,24 16.212234,24 C16.763015,24 17.212234,23.550781 17.212234,23 C17.212234,22.449219 16.763015,22 16.212234,22 Z M20.212234,22 C19.661453,22 19.212234,22.449219 19.212234,23 C19.212234,23.550781 19.661453,24 20.212234,24 C20.763015,24 21.212234,23.550781 21.212234,23 C21.212234,22.449219 20.763015,22 20.212234,22 Z M24.212234,22 C23.661453,22 23.212234,22.449219 23.212234,23 C23.212234,23.550781 23.661453,24 24.212234,24 C24.763015,24 25.212234,23.550781 25.212234,23 C25.212234,22.449219 24.763015,22 24.212234,22 Z M28.212234,22 C27.661453,22 27.212234,22.449219 27.212234,23 C27.212234,23.550781 27.661453,24 28.212234,24 C28.763015,24 29.212234,23.550781 29.212234,23 C29.212234,22.449219 28.763015,22 28.212234,22 Z M32.212234,22 C31.661453,22 31.212234,22.449219 31.212234,23 C31.212234,23.550781 31.661453,24 32.212234,24 C32.763015,24 33.212234,23.550781 33.212234,23 C33.212234,22.449219 32.763015,22 32.212234,22 Z M36.212234,22 C35.661453,22 35.212234,22.449219 35.212234,23 C35.212234,23.550781 35.661453,24 36.212234,24 C36.763015,24 37.212234,23.550781 37.212234,23 C37.212234,22.449219 36.763015,22 36.212234,22 Z M40.212234,22 C39.661453,22 39.212234,22.449219 39.212234,23 C39.212234,23.550781 39.661453,24 40.212234,24 C40.763015,24 41.212234,23.550781 41.212234,23 C41.212234,22.449219 40.763015,22 40.212234,22 Z M44.212234,22 C43.661453,22 43.212234,22.449219 43.212234,23 C43.212234,23.550781 43.661453,24 44.212234,24 C44.763015,24 45.212234,23.550781 45.212234,23 C45.212234,22.449219 44.763015,22 44.212234,22 Z M48.212234,22 C47.661453,22 47.212234,22.449219 47.212234,23 C47.212234,23.550781 47.661453,24 48.212234,24 C48.763015,24 49.212234,23.550781 49.212234,23 C49.212234,22.449219 48.763015,22 48.212234,22 Z M52.212234,22 C51.661453,22 51.212234,22.449219 51.212234,23 C51.212234,23.550781 51.661453,24 52.212234,24 C52.763015,24 53.212234,23.550781 53.212234,23 C53.212234,22.449219 52.763015,22 52.212234,22 Z M21.462234,27.96875 C21.419265,27.976563 21.376297,27.988281 21.337234,28 C21.177078,28.027344 21.02864,28.089844 20.899734,28.1875 L15.618484,32.1875 C15.356765,32.375 15.200515,32.679688 15.200515,33 C15.200515,33.320313 15.356765,33.625 15.618484,33.8125 L20.899734,37.8125 C21.348953,38.148438 21.985672,38.058594 22.321609,37.609375 C22.657547,37.160156 22.567703,36.523438 22.118484,36.1875 L19.212234,34 L49.212234,34 L46.305984,36.1875 C45.856765,36.523438 45.766922,37.160156 46.102859,37.609375 C46.438797,38.058594 47.075515,38.148438 47.524734,37.8125 L52.805984,33.8125 C53.067703,33.625 53.223953,33.320313 53.223953,33 C53.223953,32.679688 53.067703,32.375 52.805984,32.1875 L47.524734,28.1875 C47.30989,28.027344 47.040359,27.960938 46.774734,28 C46.743484,28 46.712234,28 46.680984,28 C46.282547,28.074219 45.96614,28.382813 45.884109,28.78125 C45.802078,29.179688 45.970047,29.585938 46.305984,29.8125 L49.212234,32 L19.212234,32 L22.118484,29.8125 C22.520828,29.566406 22.696609,29.070313 22.536453,28.625 C22.380203,28.179688 21.930984,27.90625 21.462234,27.96875 Z M16.212234,42 C15.661453,42 15.212234,42.449219 15.212234,43 C15.212234,43.550781 15.661453,44 16.212234,44 C16.763015,44 17.212234,43.550781 17.212234,43 C17.212234,42.449219 16.763015,42 16.212234,42 Z M20.212234,42 C19.661453,42 19.212234,42.449219 19.212234,43 C19.212234,43.550781 19.661453,44 20.212234,44 C20.763015,44 21.212234,43.550781 21.212234,43 C21.212234,42.449219 20.763015,42 20.212234,42 Z M24.212234,42 C23.661453,42 23.212234,42.449219 23.212234,43 C23.212234,43.550781 23.661453,44 24.212234,44 C24.763015,44 25.212234,43.550781 25.212234,43 C25.212234,42.449219 24.763015,42 24.212234,42 Z M28.212234,42 C27.661453,42 27.212234,42.449219 27.212234,43 C27.212234,43.550781 27.661453,44 28.212234,44 C28.763015,44 29.212234,43.550781 29.212234,43 C29.212234,42.449219 28.763015,42 28.212234,42 Z M32.212234,42 C31.661453,42 31.212234,42.449219 31.212234,43 C31.212234,43.550781 31.661453,44 32.212234,44 C32.763015,44 33.212234,43.550781 33.212234,43 C33.212234,42.449219 32.763015,42 32.212234,42 Z M36.212234,42 C35.661453,42 35.212234,42.449219 35.212234,43 C35.212234,43.550781 35.661453,44 36.212234,44 C36.763015,44 37.212234,43.550781 37.212234,43 C37.212234,42.449219 36.763015,42 36.212234,42 Z M40.212234,42 C39.661453,42 39.212234,42.449219 39.212234,43 C39.212234,43.550781 39.661453,44 40.212234,44 C40.763015,44 41.212234,43.550781 41.212234,43 C41.212234,42.449219 40.763015,42 40.212234,42 Z M44.212234,42 C43.661453,42 43.212234,42.449219 43.212234,43 C43.212234,43.550781 43.661453,44 44.212234,44 C44.763015,44 45.212234,43.550781 45.212234,43 C45.212234,42.449219 44.763015,42 44.212234,42 Z M48.212234,42 C47.661453,42 47.212234,42.449219 47.212234,43 C47.212234,43.550781 47.661453,44 48.212234,44 C48.763015,44 49.212234,43.550781 49.212234,43 C49.212234,42.449219 48.763015,42 48.212234,42 Z M52.212234,42 C51.661453,42 51.212234,42.449219 51.212234,43 C51.212234,43.550781 51.661453,44 52.212234,44 C52.763015,44 53.212234,43.550781 53.212234,43 C53.212234,42.449219 52.763015,42 52.212234,42 Z" id="inside_range" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_vals_between()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="VAL_DEST_LAT" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>VAL_DEST_LAT</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="[19, 65]" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>[19, 65]</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">○</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #CF142B; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">13</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `VAL_ORIG_LON` should be between `-162` and `-68`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_between" transform="translate(-0.487938, 0.651308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M11.993484,21.96875 C10.962234,22.082031 10.188797,22.964844 10.212234,24 L10.212234,42 C10.200515,42.722656 10.579422,43.390625 11.204422,43.753906 C11.825515,44.121094 12.598953,44.121094 13.220047,43.753906 C13.845047,43.390625 14.223953,42.722656 14.212234,42 L14.212234,24 C14.220047,23.457031 14.009109,22.9375 13.626297,22.554688 C13.243484,22.171875 12.723953,21.960938 12.180984,21.96875 C12.118484,21.964844 12.055984,21.964844 11.993484,21.96875 Z M55.993484,21.96875 C54.962234,22.082031 54.188797,22.964844 54.212234,24 L54.212234,42 C54.200515,42.722656 54.579422,43.390625 55.204422,43.753906 C55.825515,44.121094 56.598953,44.121094 57.220047,43.753906 C57.845047,43.390625 58.223953,42.722656 58.212234,42 L58.212234,24 C58.220047,23.457031 58.009109,22.9375 57.626297,22.554688 C57.243484,22.171875 56.723953,21.960938 56.180984,21.96875 C56.118484,21.964844 56.055984,21.964844 55.993484,21.96875 Z M16.212234,22 C15.661453,22 15.212234,22.449219 15.212234,23 C15.212234,23.550781 15.661453,24 16.212234,24 C16.763015,24 17.212234,23.550781 17.212234,23 C17.212234,22.449219 16.763015,22 16.212234,22 Z M20.212234,22 C19.661453,22 19.212234,22.449219 19.212234,23 C19.212234,23.550781 19.661453,24 20.212234,24 C20.763015,24 21.212234,23.550781 21.212234,23 C21.212234,22.449219 20.763015,22 20.212234,22 Z M24.212234,22 C23.661453,22 23.212234,22.449219 23.212234,23 C23.212234,23.550781 23.661453,24 24.212234,24 C24.763015,24 25.212234,23.550781 25.212234,23 C25.212234,22.449219 24.763015,22 24.212234,22 Z M28.212234,22 C27.661453,22 27.212234,22.449219 27.212234,23 C27.212234,23.550781 27.661453,24 28.212234,24 C28.763015,24 29.212234,23.550781 29.212234,23 C29.212234,22.449219 28.763015,22 28.212234,22 Z M32.212234,22 C31.661453,22 31.212234,22.449219 31.212234,23 C31.212234,23.550781 31.661453,24 32.212234,24 C32.763015,24 33.212234,23.550781 33.212234,23 C33.212234,22.449219 32.763015,22 32.212234,22 Z M36.212234,22 C35.661453,22 35.212234,22.449219 35.212234,23 C35.212234,23.550781 35.661453,24 36.212234,24 C36.763015,24 37.212234,23.550781 37.212234,23 C37.212234,22.449219 36.763015,22 36.212234,22 Z M40.212234,22 C39.661453,22 39.212234,22.449219 39.212234,23 C39.212234,23.550781 39.661453,24 40.212234,24 C40.763015,24 41.212234,23.550781 41.212234,23 C41.212234,22.449219 40.763015,22 40.212234,22 Z M44.212234,22 C43.661453,22 43.212234,22.449219 43.212234,23 C43.212234,23.550781 43.661453,24 44.212234,24 C44.763015,24 45.212234,23.550781 45.212234,23 C45.212234,22.449219 44.763015,22 44.212234,22 Z M48.212234,22 C47.661453,22 47.212234,22.449219 47.212234,23 C47.212234,23.550781 47.661453,24 48.212234,24 C48.763015,24 49.212234,23.550781 49.212234,23 C49.212234,22.449219 48.763015,22 48.212234,22 Z M52.212234,22 C51.661453,22 51.212234,22.449219 51.212234,23 C51.212234,23.550781 51.661453,24 52.212234,24 C52.763015,24 53.212234,23.550781 53.212234,23 C53.212234,22.449219 52.763015,22 52.212234,22 Z M21.462234,27.96875 C21.419265,27.976563 21.376297,27.988281 21.337234,28 C21.177078,28.027344 21.02864,28.089844 20.899734,28.1875 L15.618484,32.1875 C15.356765,32.375 15.200515,32.679688 15.200515,33 C15.200515,33.320313 15.356765,33.625 15.618484,33.8125 L20.899734,37.8125 C21.348953,38.148438 21.985672,38.058594 22.321609,37.609375 C22.657547,37.160156 22.567703,36.523438 22.118484,36.1875 L19.212234,34 L49.212234,34 L46.305984,36.1875 C45.856765,36.523438 45.766922,37.160156 46.102859,37.609375 C46.438797,38.058594 47.075515,38.148438 47.524734,37.8125 L52.805984,33.8125 C53.067703,33.625 53.223953,33.320313 53.223953,33 C53.223953,32.679688 53.067703,32.375 52.805984,32.1875 L47.524734,28.1875 C47.30989,28.027344 47.040359,27.960938 46.774734,28 C46.743484,28 46.712234,28 46.680984,28 C46.282547,28.074219 45.96614,28.382813 45.884109,28.78125 C45.802078,29.179688 45.970047,29.585938 46.305984,29.8125 L49.212234,32 L19.212234,32 L22.118484,29.8125 C22.520828,29.566406 22.696609,29.070313 22.536453,28.625 C22.380203,28.179688 21.930984,27.90625 21.462234,27.96875 Z M16.212234,42 C15.661453,42 15.212234,42.449219 15.212234,43 C15.212234,43.550781 15.661453,44 16.212234,44 C16.763015,44 17.212234,43.550781 17.212234,43 C17.212234,42.449219 16.763015,42 16.212234,42 Z M20.212234,42 C19.661453,42 19.212234,42.449219 19.212234,43 C19.212234,43.550781 19.661453,44 20.212234,44 C20.763015,44 21.212234,43.550781 21.212234,43 C21.212234,42.449219 20.763015,42 20.212234,42 Z M24.212234,42 C23.661453,42 23.212234,42.449219 23.212234,43 C23.212234,43.550781 23.661453,44 24.212234,44 C24.763015,44 25.212234,43.550781 25.212234,43 C25.212234,42.449219 24.763015,42 24.212234,42 Z M28.212234,42 C27.661453,42 27.212234,42.449219 27.212234,43 C27.212234,43.550781 27.661453,44 28.212234,44 C28.763015,44 29.212234,43.550781 29.212234,43 C29.212234,42.449219 28.763015,42 28.212234,42 Z M32.212234,42 C31.661453,42 31.212234,42.449219 31.212234,43 C31.212234,43.550781 31.661453,44 32.212234,44 C32.763015,44 33.212234,43.550781 33.212234,43 C33.212234,42.449219 32.763015,42 32.212234,42 Z M36.212234,42 C35.661453,42 35.212234,42.449219 35.212234,43 C35.212234,43.550781 35.661453,44 36.212234,44 C36.763015,44 37.212234,43.550781 37.212234,43 C37.212234,42.449219 36.763015,42 36.212234,42 Z M40.212234,42 C39.661453,42 39.212234,42.449219 39.212234,43 C39.212234,43.550781 39.661453,44 40.212234,44 C40.763015,44 41.212234,43.550781 41.212234,43 C41.212234,42.449219 40.763015,42 40.212234,42 Z M44.212234,42 C43.661453,42 43.212234,42.449219 43.212234,43 C43.212234,43.550781 43.661453,44 44.212234,44 C44.763015,44 45.212234,43.550781 45.212234,43 C45.212234,42.449219 44.763015,42 44.212234,42 Z M48.212234,42 C47.661453,42 47.212234,42.449219 47.212234,43 C47.212234,43.550781 47.661453,44 48.212234,44 C48.763015,44 49.212234,43.550781 49.212234,43 C49.212234,42.449219 48.763015,42 48.212234,42 Z M52.212234,42 C51.661453,42 51.212234,42.449219 51.212234,43 C51.212234,43.550781 51.661453,44 52.212234,44 C52.763015,44 53.212234,43.550781 53.212234,43 C53.212234,42.449219 52.763015,42 52.212234,42 Z" id="inside_range" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_vals_between()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="VAL_ORIG_LON" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>VAL_ORIG_LON</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="[-162, -68]" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>[−162, −68]</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">●</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><a href="data:text/csv;base64,IklEX0RSSVZFUiIsIklEX1JJREVSIiwiSURfVFJJUCIsIkRUX09SSUciLCJEVF9ERVNUIiwiTl9EUklWRVJfUEFTU0VOR0VSUyIsIk5fVFJJUF9PUklHIiwiTl9UUklQX0RFU1QiLCJBTVRfVFJJUF9ESVNUIiwiSU5EX1NVUkdFIiwiVkFMX0RSSVZFUl9SQVRJTkciLCJWQUxfUklERVJfUkFUSU5HIiwiVkFMX09SSUdfTEFUIiwiVkFMX0RFU1RfTEFUIiwiVkFMX09SSUdfTE9OIiwiVkFMX0RFU1RfTE9OIiwiQ0FUX1RSSVBfVFlQRSIsIkNBVF9SSURFUl9UWVBFIg0KMTAyOSwxNTIwLDc2ODIsMjAxOS0wOC0wNywyMDE5LTA4LTA3LDIsMSwxLDMyLjU1NjUyODkwNTQwNjYsMSwyLjM4NTAxMjA4ODM0MzUsMy4xMjM1Mjk4NTE0MzY2MSw0MS42MDcwNDA1NTU2ODIsNDEuMjA0ODcwODIxNDQyNSw4Ni43MjE5OTM0NjM1Nzk2LDk4Ljk1NDQ1MTE5MzU2NzQsIlN0YW5kYXJkIiwiQmFzaWMiDQo5Mjk0LDM0NjEsMTQ5MCwyMDE5LTAzLTMwLDIwMTktMDMtMzAsMiwxLDEsMzYuNDk3MzEwNTMwMzk0MywwLDIuNTI5NjgwNDU4ODI4ODEsNC44NTI5MDgzODk2NDI4Myw0MC41NTU1MDEzOTE2NDU1LDQwLjE0MDM1MjgwNzQ3MzQsODkuMjE0NDQ5OTYyNjAxMSwxMTAuNzY5Mjk5NDgwNTk4LCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KNDkwNCwyODI2LDE3NjQsMjAxOS0wOC0yNywyMDE5LTA4LTI3LDIsMSwxLDQwLjA0MTA5Mzk2NTk5MjMsMCw0LjQxNzA3NDMyNjQyNTc5LDEuOTY4MzY1MDI1NzA2NTksNDEuMTgyOTAwNTcxNzMsNDEuNzY1NTc4NjU5MjUxMyw5Mi41NjcwMTcyMzY3MjQ1LDExMC41MjAwNDE2NTcxNDYsIkVsaXRlIiwiQmFzaWMiDQo2OTM3LDgzNjQsMTg0MiwyMDE5LTA1LTAxLDIwMTktMDUtMDEsMiwxLDEsMzEuOTUwODc0OTgwNTM5MSwwLDQuMzEyMTQ1NDUxMDgzNzgsNC4wNzQ0MjU3MDc1NzEyMSw0MC42NDk3MTA2NjU0NTcsNDAuNDU4Njc5NDk2MzEwNyw3NS4wNjc0NjQ5ODg2Nzg3LDcyLjUzNTA4MzE3OTgyNzgsIlBvb2wiLCJCYXNpYyINCjEzNzcsOTIyMyw5MjI3LDIwMTktMDctMTQsMjAxOS0wNy0xNCwxLDEsMSw0MS44MjQ4NTQzMTQzMjcyLDEsMi43MzQ4MDUwODE5NzA5OSwzLjg4Njk1MDc2NjY2NzcyLDQwLjEwNDU4Mjg3MTMxMDQsNDAuMTU5MDg0ODg1MzgxMiw4Ni45MTE5OTk5Mzk0NzUyLDkyLjcwNjUxMDE3MzE1NjksIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KNTc2Nyw1MDA1LDU2MTYsMjAxOS0wNC0xNCwyMDE5LTA0LTE0LDEsMSwxLDMzLjkyMjE0Mzk5NzYyNDUsMCw0LjgyOTk3MTg3NDEzMjc1LDMuMzQ5ODYyMTU5MjI5ODIsNDAuNTMwNDA5ODIwODQzNSw0MC44MTYyMjEwNjI1NTk2LDExOC4xOTQ4MDk2MzA1MTMsMTA3LjYzOTYxNTc1NDU5NywiRWxpdGUiLCJCYXNpYyINCjM0NTQsNjA1NCwzNDI3LDIwMTktMDQtMTIsMjAxOS0wNC0xMiwyLDEsMSwzNS4wMTU4NTk3OTk0NTk2LDEsMi42MTQ3Mjc0NDk2MDMzOCw0LjM0Njc4MjA5MDE0MjM3LDQxLjgxMTg0NjIzODU2MSw0MC45MDU1NTY1NTI1Nzc4LDExOC4zOTQ3MTM2NjcyMjEsODUuODgwNTcwNTcyMzM1MywiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQoyNDQ2LDg3NTYsNTg1OSwyMDE5LTAxLTI3LDIwMTktMDEtMjcsMSwxLDEsMjAuMzY3ODE2NTY1NTU4MywxLDMuMjkzNzk3ODIzNjAwNDcsMS43ODExODAyMDI5NjA5Nyw0MC43NTY1MjYwNjE3OTk0LDQwLjgyOTQ5NzYyNDY1NDMsNzcuMDUzMjYzMTk0MzkzNCw5Ni4zMjk1OTU2NTM4MDU5LCJFbGl0ZSIsIkJhc2ljIg0KMzMwNSwxNTM2LDY3OTUsMjAxOS0xMS0yNCwyMDE5LTExLTI0LDEsMSwxLDI5Ljc3MTcxNDY5NDc5OCwxLDMuMTIxMjEzNDAyNTk5MSw0LjE3OTMzMzU2NjY4OCw0MS44MjM4Mzk1MTA3OTEsNDEuMzMwMzQxNzc4MjI5OSw5My4wNzc2NDQ5ODk4MjU4LDk0LjU1NDQ2OTkzNjk5MywiRWxpdGUiLCJGcmVxdWVudCINCjY3NDIsOTk2MCw1NjM2LDIwMTktMDQtMTUsMjAxOS0wNC0xNSwxLDEsMSwxOS43MzcwOTEzMDY1OTcsMSwyLjQ2MDU5Njk5OTE1MzQ5LDQuNzM4MDc5OTM1MzEyMjcsNDAuNzQ4ODc1MzU1MzQ4LDQwLjY5MDc2NzIwOTUxMTMsMTA3LjI5NTM4MDA3MTczNywxMDMuODk2NDc2NjU4OTkyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KMTg1NSw5NTA3LDc1OTgsMjAxOS0wOS0wNywyMDE5LTA5LTA3LDEsMSwxLDE3LjQxMDcxNDQ0OTM2MSwxLDIuMTQzNTQ1OTYwMDc2MTUsMi45MTQzNzE3ODEwNTExNiw0MS4zNTQzODI1ODcxMzExLDQxLjAwOTMzNDI2NDMyMzEsNzMuMzIwODk5MTA1MTY1MiwxMDQuNjk1NTI5NzI4MTk3LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNDkzMyw1NjMyLDY1OTgsMjAxOS0wNy0wNiwyMDE5LTA3LTA2LDEsMSwxLDE2LjQ4NzYwOTA0NTU4LDEsMi41NTY4ODA2NTAxMTA1NCw0LjgxNTY1ODY4NTc1MTI2LDQxLjE3NDAzMDgzNTI3NDYsNDEuMTMxNjU4NzE2NTkyOSw4Ny4zMzk2OTc1Mzg0MDk0LDk5LjE5NjczNTMzMTc4ODcsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KOTYyMCw5MzM2LDE4NTUsMjAxOS0wNC0xNywyMDE5LTA0LTE3LDIsMSwxLDI0Ljc4NjUwMDk5NTk3ODcsMSw0LjQ1MzM3NTAyNTY1MjM1LDEuOTM1NDM1MjQ1NzQ0ODgsNDAuNjczMDgxOTYxOTI2MSw0MC44MjY3NTczMTc4NzQ2LDExNi43ODMxMDcxMjMzMzgsOTMuMTg1MDYzNTAyNzUxMywiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQo0MzAyLDQ5OTUsMzg0NywyMDE5LTAyLTA2LDIwMTktMDItMDYsMiwxLDEsMzkuNTc1ODE2NjQ0MzU1NywxLDEuNDQwNDc2MDgzMTk2NywxLjUyMjM4NzM4MTY0MzA2LDQwLjkzMzUxOTM1OTIxMjQsNDAuMjEyNDc5OTQ4OTk3NSw4MC4zMzU1NjY4ODM0NDExLDk5LjYxOTEwOTM1MTE4NzksIkVsaXRlIiwiU3Vic2NyaXB0aW9uIg0KMTMxMyw3NDg5LDM4NTAsMjAxOS0wNy0wMiwyMDE5LTA3LTAyLDIsMSwxLDM2LjY0ODE3NzMzNjkwMTQsMCwyLjYzODM1MDEyOTEyNzUsMi43MzkwOTg3NTU2NDI3Nyw0MC42OTA0MTU3NzY4MDA0LDQxLjkzMzk3MjkxNzk2MjgsOTYuNTc4MjE1OTk4NTk3NCwxMDUuNTUyODI0NDUxNTg4LCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjU2MjUsODU2MSwzNjc3LDIwMTktMDUtMjYsMjAxOS0wNS0yNiwyLDEsMSwzMy42Mzk3Mzk3OTgzODE5LDEsMS44NjY4OTYzMzc4Mjk1MywzLjU3MzUwNzc1Nzg1NzQ0LDQxLjk3NjY4NjM2MjY0MjgsNDEuNjYzOTM0OTY0MjIxLDkzLjAzMzAwMjExMjA2MDgsNzMuODkwMTU2NzQ1OTEwNiwiU3RhbmRhcmQiLCJGcmVxdWVudCINCjMwNzgsMTYyOSwxMzQzLDIwMTktMTEtMjQsMjAxOS0xMS0yNCwxLDEsMSwxOS40ODgwNjAzMjUzODQxLDAsMy4zNDA3MDEwOTY2OTExOSw0LjI2OTk4MDE0NDY4Nyw0MC4xMjkyMjA5MjEwODA2LDQxLjkwNzQxODY5MTU1MzIsOTYuNDUzNzI2MDYzNDgyNSw4Mi40OTg1ODI2MDg1MzIyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KNDMyNCw5MTQ1LDU3ODksMjAxOS0wOC0xMywyMDE5LTA4LTEzLDEsMSwxLDMxLjU3Mzc4NzYwMTY2NDcsMSwxLjAzNTYxMjA0NTc4NzI3LDQuMTc1MjUzMzY4OTE0MTMsNDEuODcwMjk3NjUxMjcyMyw0MC44MDUyNzc4NzcwMjE2LDk0LjYxNTYzNjk1Njg3OCwxMTkuMTMwNDk4MTE3MzAyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KOTkxNCw3NjYwLDgxNzAsMjAxOS0xMC0yOCwyMDE5LTEwLTI4LDIsMSwxLDQxLjU5NzI4NDcwMjU4NDEsMSw0LjU3NDg1NTE5NTM1ODQsMy4zMDYzMDM2Mzg5NjQ4OSw0MS4wODE1OTUzNjYzNTUsNDEuNTU5NTEzMTAxMzU0Miw5Ni41NzU1Mjk4ODk2NjkzLDg5LjUyNjc4OTc5MTQxNjQsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQoyNzk1LDk3MDksNzYxMSwyMDE5LTA3LTE5LDIwMTktMDctMTksMSwxLDEsMTQuMzc3MTcwODk0Mjk1LDEsMy40MDQ0NDE4NDI4MDkzMiwzLjA5NTk2MDUxNzQxMzkxLDQxLjMzMTE1NDY2OTYzNSw0MC41ODk3Njc1MjYzNjk1LDc2Ljc4Njc2Njk4NTg5NywxMDkuOTgzNDUxNzI3MzEyLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KMTYzNiwyMzg4LDMyNjAsMjAxOS0wNi0xNSwyMDE5LTA2LTE1LDEsMSwxLDQ4LjI0ODQyNDc0NDIzMzUsMSwxLjI4MTc2OTU0MTA5MjIyLDQuNDE5NTUzMzUzNDUxMTksNDEuMzUwNzUyMzA5NDMwNCw0MS4yNTg5MTAxNzIxNTMzLDcwLjI5NjQ3MDkzMDMzNDIsMTA2LjA2NDA2NjQzNTIxLCJTdGFuZGFyZCIsIlN1YnNjcmlwdGlvbiINCjEyMjQsMzI1MCw4MzIzLDIwMTktMDItMTQsMjAxOS0wMi0xNCwxLDEsMSwxMi41NTgwMDg2MzcyNzkzLDAsMi4wMTAwMDM2MTE0NDU0Myw0LjE0NzQxOTk1MDkyNDgxLDQwLjc4Mzg1MTU5MzczMjgsNDAuMDUzOTczODEyNjA5OSw5OS4zNzA2MDYwNjIwMDI1LDgyLjIzMTQyMTU1MjEzMjgsIkVsaXRlIiwiRnJlcXVlbnQiDQo3MTc2LDEyNDgsOTIxMCwyMDE5LTA0LTI5LDIwMTktMDQtMjksMiwxLDEsMzEuMTk5MjMyMzExOTE5MywxLDQuOTMwMzE5ODMxNzA2NTgsMS4zODU0MzQwMzI0MTc4Myw0MS45Njk2NzA5MzEzNDMsNDAuNjkyNjAwMDc3MDE4MSwxMTguNDEyMTM0ODI0MzIxLDc4LjM1MjI2Mjg0MTA3MTksIlBvb2wiLCJTdWJzY3JpcHRpb24iDQozNjE4LDQ3NTcsODgyNSwyMDE5LTExLTE3LDIwMTktMTEtMTcsMiwxLDEsMTguNzI3MDMxMzU5NDQ5LDAsMy41ODM1NjYxOTQ0MDAxOSwxLjgyNTkwMTU5MjE1MDMzLDQwLjM3OTk4NTY3NjYxMjcsNDAuMTYzNzc2NDgwNTkyOCw3My4yNDA4ODI5Nzc4NDMzLDgxLjg1MjMwODg0MDAyNTIsIkVsaXRlIiwiQmFzaWMiDQo4NzQyLDcyMTIsMjY2OCwyMDE5LTExLTIyLDIwMTktMTEtMjIsMSwxLDEsMzUuNDMwNTIyNTcwMzg2NSwwLDQuNTE5MzgwNjEwNDM2MiwxLjI1ODQzNzQ3ODkxNDg2LDQwLjQ2MDkyNTk4MTQwMjQsNDAuODM2ODU4OTI5NjAwNiwxMDAuNTk5NjQ3OTU4Mjk3LDc0Ljg3OTA1NjQxNzg0ODksIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo1ODUyLDM0NTIsMjU1MiwyMDE5LTA1LTAzLDIwMTktMDUtMDMsMiwxLDEsMzUuMTY0NTQwNzE3Mzc4MywxLDIuNTg0OTQ1Mzc2OTYyNDIsMi4wMzg4ODQzNDgyMzYwMiw0MC44MTU3ODczMDEzOTg4LDQxLjgwMzQzNDIxMjIyNjQsMTEyLjkwMTE4NTkzNDg5OCwxMDUuOTE2NDA5NDU1MjQsIlBvb2wiLCJGcmVxdWVudCINCjU4NjAsODgzMSw0NjQ2LDIwMTktMDEtMDIsMjAxOS0wMS0wMiwxLDEsMSw0NC42MDEzNzcxMDkwNjU3LDAsMS4zMTYzODE3MDY4NTYxOSwxLjAzNDAxNzg0NjkxOTYsNDAuOTc3NDc5MzUxMjE4OCw0MC43OTA2Mjc1NjYxNjYyLDExMi4xNTE5NDA2ODM4MzQsOTcuNzY3MzYxNzgyMDI1NSwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQozMjU4LDUxMDQsNjQ0OSwyMDE5LTA5LTAzLDIwMTktMDktMDMsMSwxLDEsMTYuNDg5NTQ0ODQ2MTE3NSwxLDMuNDA5OTAwNjgzOTA5NjUsNC40NDQ5NzE0MDY4MzIzNCw0MC45MjkxNTAwMjA3MDM3LDQxLjE1MDY0MDUxOTMzNTksOTYuMjEyNDExMDgyODE1NCw3OC4xMDA4OTczODgwNjcxLCJQb29sIiwiQmFzaWMiDQoyMTY3LDU0MDYsMjg4MCwyMDE5LTA1LTI4LDIwMTktMDUtMjgsMSwxLDEsMTkuNzI3Njg1MjQ2NjE2NiwxLDIuNjE0MTgwMzIyNzM2NSwzLjIzNzg4NjQyOTc2NDMzLDQxLjkwNDQ3ODcwNTk1MzgsNDEuNzU3MzE1Nzg3NDg2Nyw3MS40MjYzMzIxOTk0ODA0LDc2LjM3ODkxODY5OTkyMDIsIlN0YW5kYXJkIiwiQmFzaWMiDQo2MDk0LDM4NDUsNTkwNywyMDIwLTAxLTAxLDIwMjAtMDEtMDEsMSwxLDEsMjIuODA5MzY2NzIzNTIyNSwwLDMuNjI3ODQwNDcyMzg1MjksNC40NDY2NzcwMDk1NzUwNyw0MC44MzIxNDAxMjY3MzEyLDQwLjM1NjA2MDI0MDQxNzcsMTE2LjgwMDQ2MDA4NDM0MSw4Ny40MDgwODI2MTA5Mjc1LCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjg1OTIsODUyNCw3MDU5LDIwMTktMTEtMjgsMjAxOS0xMS0yOCwxLDEsMSwyOS45NDY3MzY2MDk1NjMyLDEsMi41MzAzNjczNzA2OTQ4OCwxLjg3MDI5MDc5MDY4NDUyLDQxLjc1NTY2MTYxMzc3MzYsNDAuMzQ2NzQyMDkwMzAzNSw3OC4yMjMzMDMwNDY1NDMyLDEwNi4xNTI5MDk3MDc3NDQsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo1MjE2LDY4MzQsODMyOSwyMDE5LTAxLTE0LDIwMTktMDEtMTQsMSwxLDEsMzQuOTY5MzQ0NjA0NzYwNCwxLDMuNjU4MTMxOTM5MzU5MDEsNC43MTIwNDA4ODgxNDU1Nyw0MS43MjY1ODQ2NDg3MTM1LDQwLjU3MzI5ODEzODEwMDcsNzcuMjI0MDM3NzE5NDI0OCw4OS45MTA2ODU4NTc3NTc5LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNDkwMiwzNzQ3LDMwMjUsMjAxOS0wMi0xMiwyMDE5LTAyLTEyLDEsMSwxLDQ3LjUxODM5Nzc1NTkyMDksMSw0LjI0MDA1OTgwNTEwMjY1LDEuNTQ2Njk3NjAxNjc1OTksNDEuMTAyMDkzMjgxNjksNDEuODkxMDkwMTY4NjE3Nyw4Ni44MzM4MjUxNTMyOTg3LDExNi45ODQ0MzE1MjAxMDQsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo2OTUzLDk1MzUsMjczOCwyMDE5LTA3LTIxLDIwMTktMDctMjEsMSwxLDEsMTEuMDEyNTM4MzI2OTA0MiwxLDEuNDE3MzM4NTU0NzQ3NCwxLjcyMTM4MzY0NzA2MTg4LDQxLjIyMDY1NTIyOTg3NCw0MS4xMjUzNDY5MTE2MDU0LDg0Ljg4Mjc4NTcyMjE0NzcsOTkuNDMyNTI4Mzk2MTM3MSwiRWxpdGUiLCJGcmVxdWVudCINCjg2ODMsNTE2NCw1NzY3LDIwMTktMTAtMTksMjAxOS0xMC0xOSwyLDEsMSwxMy45MjcwNDU0NDU4ODkyLDEsMS45ODI0Mzg4Njk3NzQzNCwyLjE5NDY0ODE4MjAxOTU5LDQxLjk2OTEyMDgzMDc2MzEsNDEuNzE2Mzc3OTY3MDM3Myw4OS4zNDM5NDM2ODQzNjE5LDExNi4zODY5NTMwMTI1NTIsIkVsaXRlIiwiU3Vic2NyaXB0aW9uIg0KNzY2OSwzOTY5LDY2MTAsMjAxOS0xMC0yMSwyMDE5LTEwLTIxLDEsMSwxLDMzLjQ1NDk5MjQzNTg3MjYsMCwxLjI4MDIwOTIxNzIyMDU0LDIuNTM5OTAyNzAxMDQyNTksNDEuODA2MDE3OTU5NDkwNCw0MS43MTkxNDc2ODkxNzQ5LDk0LjU2MzU0OTYxMDMyMDUsNzMuMDQ3MDc3MjUyOTk1MiwiUG9vbCIsIkJhc2ljIg0KNTE2MSwyNTk4LDI1MTAsMjAxOS0wOS0xNywyMDE5LTA5LTE3LDEsMSwxLDMwLjI4NTcyOTc3NTIwNTMsMSwxLjc2MjIzMTM3NDE1OTQ2LDQuMjgzODYwNDA0OTc1NzEsNDEuODYwNzU2Njg4Mjg1Niw0MS44NTIzODUzNjU4Njk4LDkwLjE4ODg1MTAxNDI0NTMsMTA0LjQ0MTQwNjYxNzQwNywiU3RhbmRhcmQiLCJCYXNpYyINCjQ4NjcsMzM2OSw3NzI4LDIwMTktMDUtMzEsMjAxOS0wNS0zMSwyLDEsMSwzNi4wMTg0MjM0MDA4MTkzLDAsMy43NTcyNjkwOTA5NzI4NCwzLjQ5MzA1MzMyNzMxNDU2LDQxLjcxMTkwMjE3MzcwMTcsNDEuNzY2OTI2NzIyNjAxMSwxMTkuNzEwODA2ODU1MDAxLDg5LjY2OTYzNzI1ODYzMDIsIlBvb2wiLCJGcmVxdWVudCINCjg1NTMsODY3NiwzNzAyLDIwMTktMDktMTMsMjAxOS0wOS0xMywyLDEsMSwzOC41NDU1MTc4OTM1MDgxLDAsNC42MTYwODg5Njc3NzAzNCwyLjg2NTM5NjM0MDM3NzYzLDQwLjA0NTMzOTg4NzQ5NjEsNDEuNzY1MTcwOTk1NjExNyw3Ny4xNjg0NTUxNjU4MTA5LDgyLjY5ODQwNTMyOTEzOCwiU3RhbmRhcmQiLCJCYXNpYyINCjQyMzQsNjM3OSw4Njk1LDIwMTktMDUtMTgsMjAxOS0wNS0xOCwyLDEsMSwzMC4yMjcwMDY0NDA5ODIyLDEsMi4wNTAxMDg2NjM3Mzc3Nyw0LjEwMzc5OTA1NzE5MzEsNDAuNjY2MDcwNjQ0NzQzNyw0MC44ODUzODUzOTAzNzExLDcxLjA4NzY2OTg0MTk0NTIsODkuOTA3NTUyOTcwMTA3NiwiU3RhbmRhcmQiLCJCYXNpYyINCjc3NjUsODM3Nyw0ODgwLDIwMTktMDMtMDksMjAxOS0wMy0wOSwyLDEsMSwyMy4zODk0MzI3MjgyOTA2LDAsMy4zOTQxNzA2MDU1Nzc1Myw0Ljg0NDkxMDk2OTAyNjM5LDQxLjIwMDYwNzE5NTAzMDksNDEuNjQyMjk0MDQwODgxMSw4Mi41NzEyNzkyNjIxOTI1LDk3LjE4NjY0MTI2MDA1MDIsIlN0YW5kYXJkIiwiQmFzaWMiDQo2NjU5LDQzMTQsOTA3NSwyMDE5LTExLTEzLDIwMTktMTEtMTMsMSwxLDEsMTcuOTUyNjUzNjM1MjkzMiwxLDQuNjg0ODY4NTA1MjI0NTksMi43NzcxNzAzNDA1MzA1Nyw0MC41MzI3MzQwNTA4ODExLDQwLjI2NTkwMjA5MjIxNDcsMTA4LjE2NTg0MTY3MDcwNyw3My41MTc5MTM3NDg1MTAyLCJQb29sIiwiRnJlcXVlbnQiDQoxNzE1LDk0NTAsMjk5MywyMDE5LTAyLTI3LDIwMTktMDItMjcsMSwxLDEsMzcuNDk0NTg5MTkyNzkyOCwxLDQuMTkzMDIxMjIyMDE3NzEsMy4zMjg2MDc1NjEwNjY3NSw0MC41NDg5NDc0ODUxNjM4LDQxLjkwNjQ5MjQ0NjU0OTIsODQuMDM3NzIyMjc5MzE3NywxMTAuNjk3MDYwNDU1NTY4LCJTdGFuZGFyZCIsIkJhc2ljIg0KODA1OCw2OTcyLDc1NzMsMjAxOS0wNi0xOCwyMDE5LTA2LTE4LDEsMSwxLDM3LjExMjA1ODEwMzA4NDYsMSwxLjI4MjM5NjI3NDYxODgsMi4wMzUxNzQ1NzA5Nzc2OSw0MS44NjA3NzMzODM2Mzk4LDQwLjYwMDk5ODMwMTA1OSwxMDAuMTY4MTcyMDg4NDUyLDkwLjM5NTEzMDg2MjAxNjIsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo2MTY2LDQ1MzEsODU2MywyMDE5LTAyLTExLDIwMTktMDItMTEsMiwxLDEsMjkuMDIyNzU2OTM2MDI4NiwwLDQuNjUyNTQ5NjkxNDk4MjgsMi41MTY5NDczNzAwMjI1NCw0MC42MTc2MzMxMzc4NTIsNDAuMzU4NDQ1MzE0MjI0OCwxMTQuOTAzODg3NjY4NjI1LDc1LjI0NTAzMzEwNDQzODMsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo0MzU4LDEwMTIsNTUzNiwyMDE5LTAzLTE5LDIwMTktMDMtMTksMiwxLDEsMjguNzcxNjAyMzQzNzY3OSwwLDEuMzQwOTQ2NTUwNDgxMDIsMS42NzMxOTQyNTY2MTExNyw0MC4xODQ1NjM0ODEyNDg5LDQwLjkyODY5NzMyNDM1NzksNzQuNzc3MDMyMjMwMDQ5NCw5Mi42NzA4Mzg3MTQxMTE2LCJTdGFuZGFyZCIsIkJhc2ljIg0KMzUzMiwxMjE1LDczMDksMjAxOS0xMi0xNywyMDE5LTEyLTE3LDEsMSwxLDEyLjc2NjEwMzg5MzUxODQsMCwzLjkzNDUzNDY1NjgxNTIzLDIuNDcxMTQzMzg4MTg5MzgsNDEuMjQ4NzY2OTU5NjQ0OSw0MS44OTg4MDI5NjQ5NDgxLDExOS4yMDQxNjkyOTUyNjMsODkuOTg0NjA4NDQ2MjQ3OSwiUG9vbCIsIkJhc2ljIg0KODkzOSw1ODU3LDY4OTUsMjAxOS0xMi0yNSwyMDE5LTEyLTI1LDEsMSwxLDE2Ljg1MDkyODczODcxMzMsMSwzLjI5NjQ5MjAyNTI1NjE2LDIuODg4OTc5MzEzODk1MTEsNDEuNDY0NDI3NzA5NTc5NSw0MC4xNzE3Mzk0NzIwNzYzLDczLjM0OTQ0MzE1MjU0NjksMTAzLjg0Mzc1NzgwNTg4LCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KOTY1OSw5NzU3LDM5NDksMjAxOS0xMC0wNywyMDE5LTEwLTA3LDEsMSwxLDE5Ljk4NDQ1MTgzMDM4NzEsMSwzLjAyNTkyNjc0MzYzNDA1LDIuMjkyNTc5MzAyNTY0MjYsNDAuMzQ4MzQwMTQ0MzgwOSw0MC4xMjQ4MTQzMDA3OTc5LDc3LjA2NjY2ODYzOTg5MDgsMTExLjExNzM5ODYyNzEwMiwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo0NTUyLDcyMjYsNzE0OSwyMDE5LTAxLTA2LDIwMTktMDEtMDYsMSwxLDEsMjcuOTE3NDc4MTc3Njk2NSwxLDQuMjU4MTQ0MzY5MzQ4ODgsMi44OTk5OTYyNDE1NTQ2Miw0MC41NjY4Mzg1NDk0NSw0MC4zNTM2NzQwMDUyNTE0LDk5LjQ5NzEyMjA3NzczNywxMTUuMjg0NjQyMjc5MTQ4LCJTdGFuZGFyZCIsIlN1YnNjcmlwdGlvbiINCjE0NzUsNjAwNCwzMzAwLDIwMTktMDEtMTYsMjAxOS0wMS0xNiwyLDEsMSwxOS4yNjAzMzEyODA1Mjk1LDAsMy41OTc4NTAxNTYwMTY2NSw0Ljk5MzM3NDI4OTAxMzQ1LDQwLjQ3MzY2Mjc4MDU5NzgsNDEuMjQyNzgxNTM4OTgxOSwxMTkuMjY2MzA2MzkyMzgzLDEwNy44MTM3MTQyMTY0NjMsIkVsaXRlIiwiQmFzaWMiDQo2ODYwLDEzNTQsMzA1MiwyMDE5LTExLTA0LDIwMTktMTEtMDQsMSwxLDEsMjEuNzI5Mjk3MDc5MTQ1OSwxLDIuNjUzMzc0OTEzMTQ4NTgsMi41NjgzMzg0MDkwNjYyLDQwLjg4NTY3NTA2NDc1MzcsNDAuMjk2MTA4MTEwODA3OCw5Ny4yNzczODMzMDE0MDcxLDgxLjM2OTM2OTA1MDk1MzUsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5MDc2LDE3MzUsNTA3OSwyMDE5LTEwLTI3LDIwMTktMTAtMjcsMSwxLDEsNDYuNjc2MjU5OTE2Mjc1NywwLDMuNzcwMDQ4NDA4NzY5MDcsMi41ODI3OTM1MTIzODE2MSw0MC44NTg2MzczNzYyMjI4LDQxLjUwNDU2NDMyOTUxNjEsMTA0Ljk2NzU0NjU2MDgwMiw4MS44OTkxMjM4NjQ3MTQxLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KODU5NCw1MTE3LDQ2NjIsMjAxOS0wNS0wOSwyMDE5LTA1LTA5LDEsMSwxLDI4LjAzMjAwNDk0NDk4MDEsMSwzLjU3MTUwODM2NDc1MTk0LDEuMjc5NDA2MzUxMDM3MzIsNDEuMzg2MTE5NDUwOTA4Miw0MS45NTAzMjE3ODc1MDI2LDgxLjk4NzgwODc1NDIwMiw3OS44NjI3ODMzOTk4NzYyLCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjE0MjksNjY0Niw0NDQ3LDIwMTktMDgtMDUsMjAxOS0wOC0wNSwxLDEsMSwzMS43NDQ0ODIwODg4MzQsMSwyLjM2NDk0NjY2ODAzNjI4LDQuMTczNTQwMTIwOTQ0MzgsNDEuNTQ4MDM4MjM2Nzk2OSw0MC4wNzQ1MDIyMjE3NzQzLDkxLjk4NDE2OTU5NzI3MTgsMTA5LjM4NDU4NTg4NjcyOCwiRWxpdGUiLCJCYXNpYyINCjE0ODEsNDMxNSw4MTI4LDIwMTktMDEtMTEsMjAxOS0wMS0xMSwyLDEsMSwyMi43MzE4MDY5MTUyNTM0LDAsNC44MjMxNDgyNTk4OTMwNiwzLjk4MDM3OTYzNTQ2ODEzLDQxLjAxNTEwNzUwNDU1NzgsNDEuMjM0NjE3NjY1NDEsMTE0LjQ3MjYzNjQ5MTk5Miw4Ni40MDg4MDM5MDc2ODg3LCJTdGFuZGFyZCIsIkJhc2ljIg0KODgzMyw1NzMyLDkwOTEsMjAxOS0wNC0wOCwyMDE5LTA0LTA4LDEsMSwxLDQ0LjYzMjY4MTY4MjcwNTksMSw0LjMxODA5NjE0MjI2MjIyLDEuODQ5NzI5Mjc5OTg3NTEsNDEuNjI4NDA4OTIwNDg1NSw0MS4zNDcyMTAxODM3Mzk3LDcxLjUwMTYyNzEyNjcwODYsOTUuMDczOTE2MjMyMjEzNCwiRWxpdGUiLCJCYXNpYyINCjQ5NDMsMjI1OCw0ODQ4LDIwMTktMDktMDQsMjAxOS0wOS0wNCwyLDEsMSwxMC44NTcwNDg0MTY1MTAyLDEsMy4xOTgzOTgxMzE4NzcxOCw0LjUzNzgxMTA5OTU1MTYyLDQxLjY1NDY0NjQzNDM1NTUsNDEuOTMwMzc5NTA1NzM0OSw5MC4wOTcxMjIwMDM3OSw3MC4wOTA2NDc4NDk3MiwiUG9vbCIsIlN1YnNjcmlwdGlvbiINCjQzODIsNTc2OCw0Njg4LDIwMTktMDctMDEsMjAxOS0wNy0wMSwxLDEsMSwxMi4yMTc2MDAzMjY5ODUxLDAsMi4wNzIxNjQwNTc3NTM5OCwxLjI1ODU1MDk5MDM3MjksNDEuODg5MzU5MDI4MDc4Niw0MC4yNzAyMjEzODkzNjQ1LDEwNy4zOTY2NzkwNjE5MzEsNzguMTMxMDQwMTc4NzA1LCJQb29sIiwiQmFzaWMiDQoyMTAxLDg3OTMsNDQ0OCwyMDE5LTA5LTE5LDIwMTktMDktMTksMiwxLDEsMTEuMTA1NTA1NTQ0NjkyMywwLDMuNTE1ODMzNTc1Mjc4NTIsMS4xMDcxMzk1NTIwMTIwOSw0MS44MDcxNTcwMjEwMTU5LDQwLjcxNjMwMTQ3MDk5NDksOTEuMjQ0OTU1NTUxODEwNiw5OC4zNTUwMTE3MjgxMjY2LCJQb29sIiwiRnJlcXVlbnQiDQoxMTI4LDg2OTEsNzA3MSwyMDE5LTA3LTI4LDIwMTktMDctMjgsMiwxLDEsMzYuMjk1NTMzNzY2OTcsMCwyLjc5OTcwNDA0NTk4ODYyLDEuODk3NTIzNTcyNjY4NDMsNDEuMDgzOTAyMDYyMzgyNSw0MS44MTEwNzMzMzExNjIzLDcxLjIyMzE0NjY3MDk2MzYsMTA4Ljg3MTQ0MDQ0Mjc0NSwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo4MTY3LDY2NTEsOTcyNSwyMDE5LTA4LTMwLDIwMTktMDgtMzAsMSwxLDEsNDUuMTI0MjQ2OTUzMDU1MywwLDQuMjgxMzMzMDQ5NzU5MjcsMy42OTc4Mjg3OTg1NTQ4NCw0MS43MDE0NDkzNjk1NDYsNDEuODQ1Nzg4MTcxNTE0OSw3MS4xNTkzNDQ4OTI5NDg5LDEwNi45NjY2NDM0MDA5NTYsIlBvb2wiLCJCYXNpYyINCjM4MjksOTgxNCw5NDU3LDIwMTktMTAtMDQsMjAxOS0xMC0wNCwxLDEsMSwyMS45OTE5NjczNDQ2NTY2LDEsNC4yNzQ5NTk3MjgxMjE3Niw0Ljk3OTUyNjAyOTg5OTcyLDQwLjQzNDQ1NzI3ODgxMDQsNDEuNzk0ODkyNDM3MjkwNCw4MS4zMTI4MTg3MTM0ODYyLDExMi4zNDE2Mzc5OTU1NiwiRWxpdGUiLCJCYXNpYyINCjY3MTksMzA3MSw4NjM5LDIwMTktMTItMTgsMjAxOS0xMi0xOCwyLDEsMSwxMi42NjczODU0Nzk0MzUzLDEsMi44NTQ2ODg2ODQ0NTYwNSwzLjMwODQ2MTk2NTk5MzA1LDQwLjYzNTgyMTczMDgyOTgsNDEuMjU4MzQ0MTY2NDQ2NSwxMTguOTA4Mjg3NDYxMzgxLDExMi4zNDUyNjI2NDQ4MTIsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5OTc0LDE4OTEsMzY2MCwyMDE5LTAzLTI2LDIwMTktMDMtMjYsMiwxLDEsNDcuMTc3Mzg0ODIxNjk4MSwwLDEuMTI1MDM2NDk0ODA2NDEsMi40NjEyMTg2MDM4ODY2Niw0MC44MjQ2NzIyNjU0NDQsNDEuMDk0MDM1ODczMTg5Niw4OS4wNDk1MDU2NTY1ODUxLDkyLjI4ODgwMTkyODUxNjUsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KMTM4Miw4OTU0LDM4OTUsMjAxOS0wOS0yNiwyMDE5LTA5LTI2LDEsMSwxLDI3LjczMDUzMjI0MTk4NTIsMCwxLjkyNDY2Mjg1ODI0Nzc2LDMuNjg0MTQyMjY3MzMxNDgsNDEuMzUxNzMyMDMwMDQ1Miw0MS43Mjk1MzE3MjAyODA2LDEwNC4xNjg0Mzg2MDE3NzMsODUuNjQ2Nzc4Mzk2MzMwOCwiUG9vbCIsIkZyZXF1ZW50Ig0KNzUyOCw5NDg4LDQxMzgsMjAxOS0wMS0yOSwyMDE5LTAxLTI5LDIsMSwxLDMzLjU5MDIzOTE0NjcyNDMsMCwxLjMyMDQxNjg0MTY1NTk3LDEuNTA4Mjk1ODAzMzMwODQsNDAuMDA4ODQ4OTU2Nzg2MSw0MS4zNjEyOTg4OTk2MzE5LDk4LjgxMDEwNjE0ODAxMiw5MS4yNzIwMDQzNzI0NDAzLCJQb29sIiwiQmFzaWMiDQo5NjUyLDcxNzksNTY2MywyMDE5LTA3LTA1LDIwMTktMDctMDUsMiwxLDEsMjEuNjA0MDAzMzI4ODMsMSw0Ljk4MjkzMzEwODY5NDg1LDEuNzgxMTcwNTM5NTU3OTMsNDEuNjU0MDgxNjE1MTUzNyw0MS41MTYzMzYyNDI2NjgzLDExNS4yNTE1NzkzMTQ5MzYsMTE1LjM1ODQ1MzY2NzcyMywiUG9vbCIsIkJhc2ljIg0KODk2NSwxNTUyLDU5MzYsMjAxOS0wNC0xNCwyMDE5LTA0LTE0LDEsMSwxLDMxLjMyNjYwMDkxODU0NjMsMSwxLjMyNjk5NDU1NjAwMjMyLDMuNDY1NTEzMTUzOTMyOTksNDAuNDIyNjYwOTcyOTIzLDQwLjQzNTk1NTE2NDQ4ODQsODAuNTA1ODAwNTMxMjQ1OCw3MC4wMzAzMDA2NDk4MTQzLCJQb29sIiwiRnJlcXVlbnQiDQo5ODczLDcwNDMsMTYxMiwyMDE5LTAyLTE5LDIwMTktMDItMTksMiwxLDEsNDQuNzYzODk5NzI0OTMwNSwwLDMuNzE3MzcyOTk0ODY5OTUsMy43MDI1NjkzMDk2MjIwNSw0MC42ODg3NjM0ODY2ODcxLDQxLjM5OTEwMTMyODEwNDcsMTE1LjA1ODQwODU1NDE3OCwxMDYuNDQyNjAwNDQ2NzUzLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNTg1MCw3OTY2LDg4OTksMjAxOS0xMi0yNiwyMDE5LTEyLTI2LDIsMSwxLDEyLjU2Nzk3NDY5MjIxMDYsMSwzLjY5MjgyMTQwOTU1MzI5LDMuODA2NjAwMzI4NTM0ODQsNDAuNTg1ODM0NDc3NTYyNSw0MS4xNDE5NTE5ODU2NTcyLDEwNC44MDQ2Mjc4NDY0NjEsMTA0LjY4NzQ5MTQwMTU2NCwiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQoyNzQ2LDExMTAsNTY0OSwyMDE5LTExLTIwLDIwMTktMTEtMjAsMSwxLDEsMTYuMTc1NDk0MTU2Nzc3OSwwLDEuMDA0MzM5NTk2MjU2NjEsNC4zNjkyNDU0MjQ4NjY2OCw0MS4wMTg5NTUxNjIyNjA3LDQwLjUwODk2MDQzMTQ0MTcsOTkuMjY5NjI3NzcyNzM3MywxMTkuMDc3MTAxNDI0MzM2LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNTM4NCwyNDIxLDQ4MjMsMjAxOS0wNi0wNSwyMDE5LTA2LTA1LDEsMSwxLDMxLjAxMzU5MzA1OTAzMzIsMCwzLjMzODAzMTg1MzU0OTE4LDEuNjU1NzkxMTU5NzE5MjMsNDAuMTk1MzcwNDkyOTkxMSw0MC44MzQyNDM4MDA5NTY4LDEwNi4xMDY1OTIzNTg1NTYsODEuMzc3NzY2OTM3OTQ4OCwiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQo1NDE0LDU3MDgsNDE0MSwyMDE5LTExLTEwLDIwMTktMTEtMTAsMiwxLDEsMTMuODQzNTg3MTQzMzQ2NywwLDEuNzg4NDYyODQ3NDcxMjQsMi45MzE0MzMxOTUyNDgyNSw0MS40MDg5NDc1MjEzNTUsNDEuODMyMDExMDk1NzEzOCw4NC45MTU5OTgxMTcwNjY5LDk0Ljk2Njg1NzQ0MjYzMjMsIlN0YW5kYXJkIiwiQmFzaWMiDQoyMjYzLDMyNDQsNDE4NCwyMDE5LTAyLTA4LDIwMTktMDItMDgsMSwxLDEsMjcuOTc4MTYwMzcyMDAzOSwwLDQuMjIyMTk0NDY1ODA4NTcsMi4xMTUxNjUxMjA5MjIwMyw0MC4xNDU4NTk0NzY2NDQ1LDQxLjgzMDkwMDY4MTIwNTEsMTAyLjk4NTQ1MDAwMTQzMyw5Ni4xNjgyNjM0ODIzOTU2LCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KMjIxMiwyNDA5LDMxMjEsMjAxOS0wNS0wMywyMDE5LTA1LTAzLDEsMSwxLDQ3LjEwODMwODgyMTkxNjYsMCwzLjAzNjgzNTI4NDkwMzY1LDQuMTI5OTg4NTUyMDcxMTUsNDAuNDA2MzgyMzA3NDEwMiw0MS44MzU4NzgzNDc5NzgsNzMuOTg5NzY0MDQ2ODU1Myw4Ni44OTA5NjE2MzAyNjk5LCJFbGl0ZSIsIkJhc2ljIg0KMzU3MiwxOTE4LDQ4NzQsMjAxOS0wNC0yMiwyMDE5LTA0LTIyLDEsMSwxLDQzLjcwMjcxODQ5NDQ2LDAsMy41NzIyMTQ5MjE5MzYzOSwyLjcxNDk3OTk5NjkwNDczLDQxLjg3ODk2MzE1MTQ4MSw0MS40NTkwMTgxNjg1MDUzLDc0LjI0NDAxNjE0NTgyMTcsMTEzLjE5MDc5MDE4ODk2NCwiRWxpdGUiLCJCYXNpYyINCjg5MjQsOTIzMiwzODYzLDIwMTktMDEtMDYsMjAxOS0wMS0wNiwyLDEsMSw0Ni4wOTU1NTIwMjUzNjI4LDEsMy41NDQzNTY2MDAzODE0MywzLjc5MTYzODMzODkzODM2LDQwLjk2MzQ0NDQ1OTcxNzcsNDAuMzMyMDk2MzY2Njc3NCw5NS42MTk1MDkwOTQzOTQ3LDExNC4yODU2OTIwNjUwMjMsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KMTE0NSwzNzQzLDkyOTIsMjAxOS0wOS0xOSwyMDE5LTA5LTE5LDEsMSwxLDEyLjcwMjg5MzA4MzkxNTEsMCwzLjE2NTQ2NTI2MjcxODUsNC4yNjAwNDc5OTkyMTA2Niw0MS4wNDM2MTEyOTIyNjE2LDQxLjgzMDA4NzMxNzE1MzgsMTE4LjIzNDUzMTQyMzA3NywxMDYuNDU4Nzg4Mjg4MjkyLCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KNDMyOSwzMDg1LDg4ODcsMjAxOS0wOC0wOCwyMDE5LTA4LTA4LDIsMSwxLDI5LjY1Mzk5MzIzMDMxMzEsMCwyLjE4OTIyMTM4ODY2MDM3LDEuNTY4NzM0MTAzODEzNzcsNDEuNjAyMjA5MjQ5MDQ1Nyw0MC41NjU5OTM1NTM5NTg4LDc3LjIzMzQ1MDE3NzU5MTMsODcuNjUzMjIyODAxMTYzOCwiUG9vbCIsIlN1YnNjcmlwdGlvbiINCjg3ODcsMTgwNCw0MzE2LDIwMTktMDMtMTAsMjAxOS0wMy0xMCwxLDEsMSwxMy41MDU2OTAyOTMzODY2LDEsMy40NDkwOTAyODg5NTE5OSwxLjk4MzQ5ODQxNjg0MTAzLDQwLjMwNjk2ODQ3MTAzNTQsNDEuNTYxNTU4ODQ5MTc4MywxMDYuNzE5MzY4NzQ3NDM2LDExNy44ODg5MTQ5OTYyOTIsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5MjY0LDc3MTksMTE3NCwyMDE5LTAyLTA2LDIwMTktMDItMDYsMiwxLDEsMTkuNDI3OTUzNDM2OTcwNywxLDQuNTgxMzY2MzQyNDkyNCw0LjE3MjQwMTIwOTM2MTg1LDQwLjY1MTgyNjY1MjY5ODIsNDEuMDAzMzQ0MzM3OTIxNiw4Mi4zODYxOTg2NDQ1MjYzLDg1LjI0NzM1Mzg1MzE5MjIsIlBvb2wiLCJCYXNpYyINCjU2ODcsMzEyOSw4OTMwLDIwMTktMDctMjksMjAxOS0wNy0yOSwyLDEsMSwyMC40MjMxNzE4MzY4ODI4LDEsNC4wNzMwMzY3ODI0NDM1MiwzLjc0MDUxMzk2MDgzMDg3LDQxLjc5NDg5ODEyNDQxMTcsNDEuOTY3Mjc1Mzc5MjI1Niw5My41ODM4MzA5ODYxNzIsMTAwLjg0MDA4MzE1MzQ1MywiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo4MDg1LDMzMzYsODk5MiwyMDE5LTA4LTAzLDIwMTktMDgtMDMsMSwxLDEsMTguNDAwNzgyMjcyMjE5NywwLDIuNjIyNTgyOTU2MjE3MjMsMS45MjM2NjM0ODk1MjA1NSw0MC42MDg3ODY0OTQ0NzExLDQwLjgxMzA5OTE2MTcyMTgsMTAwLjQ1OTQ3NDQ5MjgxOCw3NC44Mjc4MDgyODYwNjM0LCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KNDkzOCw1MDU2LDY2MDMsMjAxOS0wOC0yMiwyMDE5LTA4LTIyLDIsMSwxLDQ1LjQ4ODUzMTIxNjk3OSwwLDMuMzU0ODM1Mzk3NTYzODcsMi44OTgzODA3NzMxNDE5OCw0MS4yNTY0NjgyNDM0MzEzLDQwLjM3NzA5NDAyNzEyMDYsODguNzc3OTMyMzQzMDczMiw4OC43NTkzMjA4NTA5NDk3LCJQb29sIiwiQmFzaWMiDQo1NjEyLDgwNDQsMzgzNCwyMDE5LTA5LTIzLDIwMTktMDktMjMsMSwxLDEsMjMuNTM4ODc0NjIwNTcxNywwLDEuNzIxNjc1NDM1MDgxMTIsNC43MjcyNzAwMDQzMzk1Miw0MS4wMjk4MjY0MTcwOTk3LDQxLjY3ODIwMTE3MjAzNTIsNzkuNTI3Mjc5NTc2Mjg2Nyw3OC41NjIzNjMxMjUzODM5LCJFbGl0ZSIsIkJhc2ljIg0KNjM4NSwxNDQxLDg5NDcsMjAxOS0wOS0xOSwyMDE5LTA5LTE5LDEsMSwxLDI3LjkxODg2MzkyOTgwODEsMCwxLjI4MTY5OTM0MTcyMTgzLDEuNjE1MDY5MTcwNDgyNDYsNDAuODM2MTUxMTU3MDQwMSw0MS45MTgyOTExNjk2ODQ0LDEwOC4yMTEyMzI1Mjg1NTYsOTQuMTg5NTMyODk3NDM1MSwiRWxpdGUiLCJCYXNpYyINCjI3NDQsOTkzMCw0MzgwLDIwMTktMDktMjYsMjAxOS0wOS0yNiwyLDEsMSwzMS40MzM2MTI0NTI4MTk5LDEsNC42NTc1NDI0NzY0MzA1NCwzLjg1MzMyMDg4NTQ0OTY1LDQxLjc4MjIwMjcyNTI5ODcsNDEuMzQ0OTg5NTE1ODQxLDgyLjU1NTcxMDkxMzE0NzgsNzkuNzk3OTEwOTk2NzEyNywiUG9vbCIsIkJhc2ljIg0KNjQxMiw5NDc5LDg0MzEsMjAxOS0wMi0xMSwyMDE5LTAyLTExLDEsMSwxLDQxLjA4OTc4NzYwNDI4NzMsMCwzLjIzMTUwMDk0NDEyMjY3LDEuNTQyNzMzNzc3MzE0NDIsNDAuNjgzNTc3NzkwMzkwNyw0MC45MTA1NTgzNzY5MjY5LDk3LjExODg1OTMwMDM4OTksOTcuMDU5Nzk0ODgwOTE1NCwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQoyMDg5LDE2MzksNDc1MiwyMDE5LTA4LTE0LDIwMTktMDgtMTQsMSwxLDEsNDYuOTA5MDYwOTA2NjE4OCwxLDMuNjU2MTAzOTA3MTUzMDEsMi40MDgyNTA0MDA3OTY1Myw0MS40MjcyMjc1NzU3OTc2LDQwLjM0OTQ4NjM1MTk0NDUsMTE2Ljg4MjkzNTAwODAzNCw3Ny4xNDM0NTcxNjQwNTY2LCJQb29sIiwiQmFzaWMiDQo5MzI5LDE4NDksNDQ4NCwyMDE5LTA1LTA2LDIwMTktMDUtMDYsMiwxLDEsNDIuNjE0MTA3NjkwNzUxNiwwLDMuMjc3OTUwOTE5MjMzMjYsMi44MTI1ODQ1OTAxNjY4MSw0MC4yMzk2OTAxNTUyNTY1LDQwLjUxMDI3MDQ0NTYwNzYsOTkuNjM2NDA5NDU5NjM1Niw4Ni40MjEyNjY5MDEzMDY4LCJQb29sIiwiRnJlcXVlbnQiDQo2MTgzLDI3NjgsNTM1NCwyMDE5LTA2LTE0LDIwMTktMDYtMTQsMiwxLDEsNDUuODMyMDQ5Mzk5NjE0MywxLDMuMDgxNjQ4MjU0NzY3MDYsNC4yNTMzNzE3OTU2Mzk0LDQxLjM3NDk2MjY5NzI3MTMsNDAuNjg4NjA0MDk2NDE2NCwxMDMuOTY5OTA3OTUxNTQxLDEwNi42NjA4Mzc1NDUwNiwiU3RhbmRhcmQiLCJGcmVxdWVudCINCjMxNjYsMjA1Miw0OTAzLDIwMTktMDgtMjAsMjAxOS0wOC0yMCwxLDEsMSwzMC44NTI3MzE4Mzg4MjI0LDAsNC45MjE4MzAxNTQ5NTUzOSw0LjYyMTU0MDEyMjY2NTQ2LDQwLjAwMDY3NjQ2MTQ5NTUsNDEuNTcxNDkzNzQ2NzEyOCw5MS40OTc2NDE0MzM5NjE3LDkxLjE1NzcyNzU2NTE1MDcsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo4MDY2LDM2NTIsNTg2MCwyMDE5LTA5LTA1LDIwMTktMDktMDUsMSwxLDEsNDcuOTQ3MDEzMzk2NzY5OCwwLDQuMzA5Njk4MTQ0OTA1MjcsMi45MTcxNDI3MzQ4NjI4Niw0MS4wMDMwMzUyMTAwNzMsNDEuNTQ0NzQ1NjU4OTksMTE0Ljk1NzQzMTMzNTkzNCw4Mi4wNjQ1MDA3MTE4NTgzLCJFbGl0ZSIsIkJhc2ljIg0KNjI4MCw1ODI4LDU1ODksMjAxOS0wNS0xNywyMDE5LTA1LTE3LDEsMSwxLDIxLjYxNjU0MDM5Mjg2MDgsMSwxLjU1MjI0MTc2MDMwNjA2LDIuNzMxMDYzMDE4NTUyOTYsNDEuMTAwNzA3MDE1NDg4Myw0MS4xOTAyMTU5NjEwNzYzLDExMy45MDMzNDA3NDg1MTEsMTAxLjA4NTE4MjA5Nzc0LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNjI4Nyw5NjY1LDYzODIsMjAxOS0xMi0yNCwyMDE5LTEyLTI0LDEsMSwxLDQ3LjE2NTE4MDU5MzcyOSwxLDQuOTE3MDA2MzEyODY5NDksMS44NzY4MDQ2MzEyMDM0MSw0MS40ODk0MzUzOTMzNjMyLDQxLjE5ODExNDc5MzI4Miw3NS4zNzkwNjM2OTQyNzIyLDExMC4zMzk5NDQzMjUzODcsIkVsaXRlIiwiRnJlcXVlbnQiDQoyNjQ3LDc5NDUsMjg1MCwyMDE5LTA2LTExLDIwMTktMDYtMTEsMiwxLDEsMTcuNTU5MzY5MjE1NzQxOCwwLDIuNTMwMTE2NTg2OTQ1OTUsMi4wMDcxNDI5OTI2OTAyMSw0MC40NDk2NjIwNjAwMTEyLDQwLjExMjQwNTc5NjA2OTcsODYuMDEyMDk5OTIwNzcyLDc4LjQ4NDQ2NjMxNTcxMjgsIlBvb2wiLCJCYXNpYyINCjUxMjgsMTMxMSw0MDgwLDIwMTktMDUtMTUsMjAxOS0wNS0xNSwyLDEsMSwyNS40NTY3ODk0OTkxNDg3LDAsMi4zMDczNDM0NjI0ODIwOSwxLjE4MDk1MTk4NDU5OTIzLDQxLjkyMDQ3NTg5NjQ0NzksNDAuODAzNTc2NTcxODY2OSw5MS44NTUyNjA2Mjk2NzI2LDExNS45ODI0ODMzMzIwNDUsIlBvb2wiLCJGcmVxdWVudCINCjU1MDcsOTUyMiw1NjIyLDIwMTktMDgtMjgsMjAxOS0wOC0yOCwyLDEsMSwzMS4zNTcyNDYyMDg5MzYsMSwyLjc3MTc4ODMzNDQ3Mzk3LDEuNzU0NjMwMTk5NjMzNTQsNDEuMTQ3NDM5MTg4Nzg5Niw0MS45MDgwOTAxOTkzNDM5LDExMC4wNzA2Nzg5ODA1NTUsMTE1LjA2NzQyMjc2NzE3LCJTdGFuZGFyZCIsIkJhc2ljIg0KNTA5Miw3ODI0LDQxOTIsMjAxOS0xMC0wNiwyMDE5LTEwLTA2LDIsMSwxLDQwLjIxNTIzNjIzNzI3MjYsMCwxLjYyMzExMDk4NjMxNDcxLDQuODEwNzM3NzY0NDYyODMsNDAuOTg3ODIzNTAxNjk0OSw0MC4yMzgyMTc0NTI1NDEsODYuODMzMzk3MzYxOTE1Niw4My44NTU5NjQwMjY4Nzk1LCJTdGFuZGFyZCIsIkJhc2ljIg0K" download="extract_0013.csv">
  <button aria-label="There are 100 'fail' rows available as a CSV file." data-balloon-pos="left" style="background-color:#67C2DC;color:#FFFFFF;border:none;padding:5px;font-weight:bold;cursor:pointer;border-radius:4px;">CSV</button>
</a>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #CF142B; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">14</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `VAL_DEST_LON` should be between `-162` and `-68`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_between" transform="translate(-0.487938, 0.651308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M11.993484,21.96875 C10.962234,22.082031 10.188797,22.964844 10.212234,24 L10.212234,42 C10.200515,42.722656 10.579422,43.390625 11.204422,43.753906 C11.825515,44.121094 12.598953,44.121094 13.220047,43.753906 C13.845047,43.390625 14.223953,42.722656 14.212234,42 L14.212234,24 C14.220047,23.457031 14.009109,22.9375 13.626297,22.554688 C13.243484,22.171875 12.723953,21.960938 12.180984,21.96875 C12.118484,21.964844 12.055984,21.964844 11.993484,21.96875 Z M55.993484,21.96875 C54.962234,22.082031 54.188797,22.964844 54.212234,24 L54.212234,42 C54.200515,42.722656 54.579422,43.390625 55.204422,43.753906 C55.825515,44.121094 56.598953,44.121094 57.220047,43.753906 C57.845047,43.390625 58.223953,42.722656 58.212234,42 L58.212234,24 C58.220047,23.457031 58.009109,22.9375 57.626297,22.554688 C57.243484,22.171875 56.723953,21.960938 56.180984,21.96875 C56.118484,21.964844 56.055984,21.964844 55.993484,21.96875 Z M16.212234,22 C15.661453,22 15.212234,22.449219 15.212234,23 C15.212234,23.550781 15.661453,24 16.212234,24 C16.763015,24 17.212234,23.550781 17.212234,23 C17.212234,22.449219 16.763015,22 16.212234,22 Z M20.212234,22 C19.661453,22 19.212234,22.449219 19.212234,23 C19.212234,23.550781 19.661453,24 20.212234,24 C20.763015,24 21.212234,23.550781 21.212234,23 C21.212234,22.449219 20.763015,22 20.212234,22 Z M24.212234,22 C23.661453,22 23.212234,22.449219 23.212234,23 C23.212234,23.550781 23.661453,24 24.212234,24 C24.763015,24 25.212234,23.550781 25.212234,23 C25.212234,22.449219 24.763015,22 24.212234,22 Z M28.212234,22 C27.661453,22 27.212234,22.449219 27.212234,23 C27.212234,23.550781 27.661453,24 28.212234,24 C28.763015,24 29.212234,23.550781 29.212234,23 C29.212234,22.449219 28.763015,22 28.212234,22 Z M32.212234,22 C31.661453,22 31.212234,22.449219 31.212234,23 C31.212234,23.550781 31.661453,24 32.212234,24 C32.763015,24 33.212234,23.550781 33.212234,23 C33.212234,22.449219 32.763015,22 32.212234,22 Z M36.212234,22 C35.661453,22 35.212234,22.449219 35.212234,23 C35.212234,23.550781 35.661453,24 36.212234,24 C36.763015,24 37.212234,23.550781 37.212234,23 C37.212234,22.449219 36.763015,22 36.212234,22 Z M40.212234,22 C39.661453,22 39.212234,22.449219 39.212234,23 C39.212234,23.550781 39.661453,24 40.212234,24 C40.763015,24 41.212234,23.550781 41.212234,23 C41.212234,22.449219 40.763015,22 40.212234,22 Z M44.212234,22 C43.661453,22 43.212234,22.449219 43.212234,23 C43.212234,23.550781 43.661453,24 44.212234,24 C44.763015,24 45.212234,23.550781 45.212234,23 C45.212234,22.449219 44.763015,22 44.212234,22 Z M48.212234,22 C47.661453,22 47.212234,22.449219 47.212234,23 C47.212234,23.550781 47.661453,24 48.212234,24 C48.763015,24 49.212234,23.550781 49.212234,23 C49.212234,22.449219 48.763015,22 48.212234,22 Z M52.212234,22 C51.661453,22 51.212234,22.449219 51.212234,23 C51.212234,23.550781 51.661453,24 52.212234,24 C52.763015,24 53.212234,23.550781 53.212234,23 C53.212234,22.449219 52.763015,22 52.212234,22 Z M21.462234,27.96875 C21.419265,27.976563 21.376297,27.988281 21.337234,28 C21.177078,28.027344 21.02864,28.089844 20.899734,28.1875 L15.618484,32.1875 C15.356765,32.375 15.200515,32.679688 15.200515,33 C15.200515,33.320313 15.356765,33.625 15.618484,33.8125 L20.899734,37.8125 C21.348953,38.148438 21.985672,38.058594 22.321609,37.609375 C22.657547,37.160156 22.567703,36.523438 22.118484,36.1875 L19.212234,34 L49.212234,34 L46.305984,36.1875 C45.856765,36.523438 45.766922,37.160156 46.102859,37.609375 C46.438797,38.058594 47.075515,38.148438 47.524734,37.8125 L52.805984,33.8125 C53.067703,33.625 53.223953,33.320313 53.223953,33 C53.223953,32.679688 53.067703,32.375 52.805984,32.1875 L47.524734,28.1875 C47.30989,28.027344 47.040359,27.960938 46.774734,28 C46.743484,28 46.712234,28 46.680984,28 C46.282547,28.074219 45.96614,28.382813 45.884109,28.78125 C45.802078,29.179688 45.970047,29.585938 46.305984,29.8125 L49.212234,32 L19.212234,32 L22.118484,29.8125 C22.520828,29.566406 22.696609,29.070313 22.536453,28.625 C22.380203,28.179688 21.930984,27.90625 21.462234,27.96875 Z M16.212234,42 C15.661453,42 15.212234,42.449219 15.212234,43 C15.212234,43.550781 15.661453,44 16.212234,44 C16.763015,44 17.212234,43.550781 17.212234,43 C17.212234,42.449219 16.763015,42 16.212234,42 Z M20.212234,42 C19.661453,42 19.212234,42.449219 19.212234,43 C19.212234,43.550781 19.661453,44 20.212234,44 C20.763015,44 21.212234,43.550781 21.212234,43 C21.212234,42.449219 20.763015,42 20.212234,42 Z M24.212234,42 C23.661453,42 23.212234,42.449219 23.212234,43 C23.212234,43.550781 23.661453,44 24.212234,44 C24.763015,44 25.212234,43.550781 25.212234,43 C25.212234,42.449219 24.763015,42 24.212234,42 Z M28.212234,42 C27.661453,42 27.212234,42.449219 27.212234,43 C27.212234,43.550781 27.661453,44 28.212234,44 C28.763015,44 29.212234,43.550781 29.212234,43 C29.212234,42.449219 28.763015,42 28.212234,42 Z M32.212234,42 C31.661453,42 31.212234,42.449219 31.212234,43 C31.212234,43.550781 31.661453,44 32.212234,44 C32.763015,44 33.212234,43.550781 33.212234,43 C33.212234,42.449219 32.763015,42 32.212234,42 Z M36.212234,42 C35.661453,42 35.212234,42.449219 35.212234,43 C35.212234,43.550781 35.661453,44 36.212234,44 C36.763015,44 37.212234,43.550781 37.212234,43 C37.212234,42.449219 36.763015,42 36.212234,42 Z M40.212234,42 C39.661453,42 39.212234,42.449219 39.212234,43 C39.212234,43.550781 39.661453,44 40.212234,44 C40.763015,44 41.212234,43.550781 41.212234,43 C41.212234,42.449219 40.763015,42 40.212234,42 Z M44.212234,42 C43.661453,42 43.212234,42.449219 43.212234,43 C43.212234,43.550781 43.661453,44 44.212234,44 C44.763015,44 45.212234,43.550781 45.212234,43 C45.212234,42.449219 44.763015,42 44.212234,42 Z M48.212234,42 C47.661453,42 47.212234,42.449219 47.212234,43 C47.212234,43.550781 47.661453,44 48.212234,44 C48.763015,44 49.212234,43.550781 49.212234,43 C49.212234,42.449219 48.763015,42 48.212234,42 Z M52.212234,42 C51.661453,42 51.212234,42.449219 51.212234,43 C51.212234,43.550781 51.661453,44 52.212234,44 C52.763015,44 53.212234,43.550781 53.212234,43 C53.212234,42.449219 52.763015,42 52.212234,42 Z" id="inside_range" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_vals_between()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="VAL_DEST_LON" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>VAL_DEST_LON</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="[-162, -68]" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>[−162, −68]</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>100</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>100</code><br><code>1.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="color: #CF142B;">●</span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><a href="data:text/csv;base64,IklEX0RSSVZFUiIsIklEX1JJREVSIiwiSURfVFJJUCIsIkRUX09SSUciLCJEVF9ERVNUIiwiTl9EUklWRVJfUEFTU0VOR0VSUyIsIk5fVFJJUF9PUklHIiwiTl9UUklQX0RFU1QiLCJBTVRfVFJJUF9ESVNUIiwiSU5EX1NVUkdFIiwiVkFMX0RSSVZFUl9SQVRJTkciLCJWQUxfUklERVJfUkFUSU5HIiwiVkFMX09SSUdfTEFUIiwiVkFMX0RFU1RfTEFUIiwiVkFMX09SSUdfTE9OIiwiVkFMX0RFU1RfTE9OIiwiQ0FUX1RSSVBfVFlQRSIsIkNBVF9SSURFUl9UWVBFIg0KMTAyOSwxNTIwLDc2ODIsMjAxOS0wOC0wNywyMDE5LTA4LTA3LDIsMSwxLDMyLjU1NjUyODkwNTQwNjYsMSwyLjM4NTAxMjA4ODM0MzUsMy4xMjM1Mjk4NTE0MzY2MSw0MS42MDcwNDA1NTU2ODIsNDEuMjA0ODcwODIxNDQyNSw4Ni43MjE5OTM0NjM1Nzk2LDk4Ljk1NDQ1MTE5MzU2NzQsIlN0YW5kYXJkIiwiQmFzaWMiDQo5Mjk0LDM0NjEsMTQ5MCwyMDE5LTAzLTMwLDIwMTktMDMtMzAsMiwxLDEsMzYuNDk3MzEwNTMwMzk0MywwLDIuNTI5NjgwNDU4ODI4ODEsNC44NTI5MDgzODk2NDI4Myw0MC41NTU1MDEzOTE2NDU1LDQwLjE0MDM1MjgwNzQ3MzQsODkuMjE0NDQ5OTYyNjAxMSwxMTAuNzY5Mjk5NDgwNTk4LCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KNDkwNCwyODI2LDE3NjQsMjAxOS0wOC0yNywyMDE5LTA4LTI3LDIsMSwxLDQwLjA0MTA5Mzk2NTk5MjMsMCw0LjQxNzA3NDMyNjQyNTc5LDEuOTY4MzY1MDI1NzA2NTksNDEuMTgyOTAwNTcxNzMsNDEuNzY1NTc4NjU5MjUxMyw5Mi41NjcwMTcyMzY3MjQ1LDExMC41MjAwNDE2NTcxNDYsIkVsaXRlIiwiQmFzaWMiDQo2OTM3LDgzNjQsMTg0MiwyMDE5LTA1LTAxLDIwMTktMDUtMDEsMiwxLDEsMzEuOTUwODc0OTgwNTM5MSwwLDQuMzEyMTQ1NDUxMDgzNzgsNC4wNzQ0MjU3MDc1NzEyMSw0MC42NDk3MTA2NjU0NTcsNDAuNDU4Njc5NDk2MzEwNyw3NS4wNjc0NjQ5ODg2Nzg3LDcyLjUzNTA4MzE3OTgyNzgsIlBvb2wiLCJCYXNpYyINCjEzNzcsOTIyMyw5MjI3LDIwMTktMDctMTQsMjAxOS0wNy0xNCwxLDEsMSw0MS44MjQ4NTQzMTQzMjcyLDEsMi43MzQ4MDUwODE5NzA5OSwzLjg4Njk1MDc2NjY2NzcyLDQwLjEwNDU4Mjg3MTMxMDQsNDAuMTU5MDg0ODg1MzgxMiw4Ni45MTE5OTk5Mzk0NzUyLDkyLjcwNjUxMDE3MzE1NjksIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KNTc2Nyw1MDA1LDU2MTYsMjAxOS0wNC0xNCwyMDE5LTA0LTE0LDEsMSwxLDMzLjkyMjE0Mzk5NzYyNDUsMCw0LjgyOTk3MTg3NDEzMjc1LDMuMzQ5ODYyMTU5MjI5ODIsNDAuNTMwNDA5ODIwODQzNSw0MC44MTYyMjEwNjI1NTk2LDExOC4xOTQ4MDk2MzA1MTMsMTA3LjYzOTYxNTc1NDU5NywiRWxpdGUiLCJCYXNpYyINCjM0NTQsNjA1NCwzNDI3LDIwMTktMDQtMTIsMjAxOS0wNC0xMiwyLDEsMSwzNS4wMTU4NTk3OTk0NTk2LDEsMi42MTQ3Mjc0NDk2MDMzOCw0LjM0Njc4MjA5MDE0MjM3LDQxLjgxMTg0NjIzODU2MSw0MC45MDU1NTY1NTI1Nzc4LDExOC4zOTQ3MTM2NjcyMjEsODUuODgwNTcwNTcyMzM1MywiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQoyNDQ2LDg3NTYsNTg1OSwyMDE5LTAxLTI3LDIwMTktMDEtMjcsMSwxLDEsMjAuMzY3ODE2NTY1NTU4MywxLDMuMjkzNzk3ODIzNjAwNDcsMS43ODExODAyMDI5NjA5Nyw0MC43NTY1MjYwNjE3OTk0LDQwLjgyOTQ5NzYyNDY1NDMsNzcuMDUzMjYzMTk0MzkzNCw5Ni4zMjk1OTU2NTM4MDU5LCJFbGl0ZSIsIkJhc2ljIg0KMzMwNSwxNTM2LDY3OTUsMjAxOS0xMS0yNCwyMDE5LTExLTI0LDEsMSwxLDI5Ljc3MTcxNDY5NDc5OCwxLDMuMTIxMjEzNDAyNTk5MSw0LjE3OTMzMzU2NjY4OCw0MS44MjM4Mzk1MTA3OTEsNDEuMzMwMzQxNzc4MjI5OSw5My4wNzc2NDQ5ODk4MjU4LDk0LjU1NDQ2OTkzNjk5MywiRWxpdGUiLCJGcmVxdWVudCINCjY3NDIsOTk2MCw1NjM2LDIwMTktMDQtMTUsMjAxOS0wNC0xNSwxLDEsMSwxOS43MzcwOTEzMDY1OTcsMSwyLjQ2MDU5Njk5OTE1MzQ5LDQuNzM4MDc5OTM1MzEyMjcsNDAuNzQ4ODc1MzU1MzQ4LDQwLjY5MDc2NzIwOTUxMTMsMTA3LjI5NTM4MDA3MTczNywxMDMuODk2NDc2NjU4OTkyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KMTg1NSw5NTA3LDc1OTgsMjAxOS0wOS0wNywyMDE5LTA5LTA3LDEsMSwxLDE3LjQxMDcxNDQ0OTM2MSwxLDIuMTQzNTQ1OTYwMDc2MTUsMi45MTQzNzE3ODEwNTExNiw0MS4zNTQzODI1ODcxMzExLDQxLjAwOTMzNDI2NDMyMzEsNzMuMzIwODk5MTA1MTY1MiwxMDQuNjk1NTI5NzI4MTk3LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNDkzMyw1NjMyLDY1OTgsMjAxOS0wNy0wNiwyMDE5LTA3LTA2LDEsMSwxLDE2LjQ4NzYwOTA0NTU4LDEsMi41NTY4ODA2NTAxMTA1NCw0LjgxNTY1ODY4NTc1MTI2LDQxLjE3NDAzMDgzNTI3NDYsNDEuMTMxNjU4NzE2NTkyOSw4Ny4zMzk2OTc1Mzg0MDk0LDk5LjE5NjczNTMzMTc4ODcsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KOTYyMCw5MzM2LDE4NTUsMjAxOS0wNC0xNywyMDE5LTA0LTE3LDIsMSwxLDI0Ljc4NjUwMDk5NTk3ODcsMSw0LjQ1MzM3NTAyNTY1MjM1LDEuOTM1NDM1MjQ1NzQ0ODgsNDAuNjczMDgxOTYxOTI2MSw0MC44MjY3NTczMTc4NzQ2LDExNi43ODMxMDcxMjMzMzgsOTMuMTg1MDYzNTAyNzUxMywiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQo0MzAyLDQ5OTUsMzg0NywyMDE5LTAyLTA2LDIwMTktMDItMDYsMiwxLDEsMzkuNTc1ODE2NjQ0MzU1NywxLDEuNDQwNDc2MDgzMTk2NywxLjUyMjM4NzM4MTY0MzA2LDQwLjkzMzUxOTM1OTIxMjQsNDAuMjEyNDc5OTQ4OTk3NSw4MC4zMzU1NjY4ODM0NDExLDk5LjYxOTEwOTM1MTE4NzksIkVsaXRlIiwiU3Vic2NyaXB0aW9uIg0KMTMxMyw3NDg5LDM4NTAsMjAxOS0wNy0wMiwyMDE5LTA3LTAyLDIsMSwxLDM2LjY0ODE3NzMzNjkwMTQsMCwyLjYzODM1MDEyOTEyNzUsMi43MzkwOTg3NTU2NDI3Nyw0MC42OTA0MTU3NzY4MDA0LDQxLjkzMzk3MjkxNzk2MjgsOTYuNTc4MjE1OTk4NTk3NCwxMDUuNTUyODI0NDUxNTg4LCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjU2MjUsODU2MSwzNjc3LDIwMTktMDUtMjYsMjAxOS0wNS0yNiwyLDEsMSwzMy42Mzk3Mzk3OTgzODE5LDEsMS44NjY4OTYzMzc4Mjk1MywzLjU3MzUwNzc1Nzg1NzQ0LDQxLjk3NjY4NjM2MjY0MjgsNDEuNjYzOTM0OTY0MjIxLDkzLjAzMzAwMjExMjA2MDgsNzMuODkwMTU2NzQ1OTEwNiwiU3RhbmRhcmQiLCJGcmVxdWVudCINCjMwNzgsMTYyOSwxMzQzLDIwMTktMTEtMjQsMjAxOS0xMS0yNCwxLDEsMSwxOS40ODgwNjAzMjUzODQxLDAsMy4zNDA3MDEwOTY2OTExOSw0LjI2OTk4MDE0NDY4Nyw0MC4xMjkyMjA5MjEwODA2LDQxLjkwNzQxODY5MTU1MzIsOTYuNDUzNzI2MDYzNDgyNSw4Mi40OTg1ODI2MDg1MzIyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KNDMyNCw5MTQ1LDU3ODksMjAxOS0wOC0xMywyMDE5LTA4LTEzLDEsMSwxLDMxLjU3Mzc4NzYwMTY2NDcsMSwxLjAzNTYxMjA0NTc4NzI3LDQuMTc1MjUzMzY4OTE0MTMsNDEuODcwMjk3NjUxMjcyMyw0MC44MDUyNzc4NzcwMjE2LDk0LjYxNTYzNjk1Njg3OCwxMTkuMTMwNDk4MTE3MzAyLCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KOTkxNCw3NjYwLDgxNzAsMjAxOS0xMC0yOCwyMDE5LTEwLTI4LDIsMSwxLDQxLjU5NzI4NDcwMjU4NDEsMSw0LjU3NDg1NTE5NTM1ODQsMy4zMDYzMDM2Mzg5NjQ4OSw0MS4wODE1OTUzNjYzNTUsNDEuNTU5NTEzMTAxMzU0Miw5Ni41NzU1Mjk4ODk2NjkzLDg5LjUyNjc4OTc5MTQxNjQsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQoyNzk1LDk3MDksNzYxMSwyMDE5LTA3LTE5LDIwMTktMDctMTksMSwxLDEsMTQuMzc3MTcwODk0Mjk1LDEsMy40MDQ0NDE4NDI4MDkzMiwzLjA5NTk2MDUxNzQxMzkxLDQxLjMzMTE1NDY2OTYzNSw0MC41ODk3Njc1MjYzNjk1LDc2Ljc4Njc2Njk4NTg5NywxMDkuOTgzNDUxNzI3MzEyLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KMTYzNiwyMzg4LDMyNjAsMjAxOS0wNi0xNSwyMDE5LTA2LTE1LDEsMSwxLDQ4LjI0ODQyNDc0NDIzMzUsMSwxLjI4MTc2OTU0MTA5MjIyLDQuNDE5NTUzMzUzNDUxMTksNDEuMzUwNzUyMzA5NDMwNCw0MS4yNTg5MTAxNzIxNTMzLDcwLjI5NjQ3MDkzMDMzNDIsMTA2LjA2NDA2NjQzNTIxLCJTdGFuZGFyZCIsIlN1YnNjcmlwdGlvbiINCjEyMjQsMzI1MCw4MzIzLDIwMTktMDItMTQsMjAxOS0wMi0xNCwxLDEsMSwxMi41NTgwMDg2MzcyNzkzLDAsMi4wMTAwMDM2MTE0NDU0Myw0LjE0NzQxOTk1MDkyNDgxLDQwLjc4Mzg1MTU5MzczMjgsNDAuMDUzOTczODEyNjA5OSw5OS4zNzA2MDYwNjIwMDI1LDgyLjIzMTQyMTU1MjEzMjgsIkVsaXRlIiwiRnJlcXVlbnQiDQo3MTc2LDEyNDgsOTIxMCwyMDE5LTA0LTI5LDIwMTktMDQtMjksMiwxLDEsMzEuMTk5MjMyMzExOTE5MywxLDQuOTMwMzE5ODMxNzA2NTgsMS4zODU0MzQwMzI0MTc4Myw0MS45Njk2NzA5MzEzNDMsNDAuNjkyNjAwMDc3MDE4MSwxMTguNDEyMTM0ODI0MzIxLDc4LjM1MjI2Mjg0MTA3MTksIlBvb2wiLCJTdWJzY3JpcHRpb24iDQozNjE4LDQ3NTcsODgyNSwyMDE5LTExLTE3LDIwMTktMTEtMTcsMiwxLDEsMTguNzI3MDMxMzU5NDQ5LDAsMy41ODM1NjYxOTQ0MDAxOSwxLjgyNTkwMTU5MjE1MDMzLDQwLjM3OTk4NTY3NjYxMjcsNDAuMTYzNzc2NDgwNTkyOCw3My4yNDA4ODI5Nzc4NDMzLDgxLjg1MjMwODg0MDAyNTIsIkVsaXRlIiwiQmFzaWMiDQo4NzQyLDcyMTIsMjY2OCwyMDE5LTExLTIyLDIwMTktMTEtMjIsMSwxLDEsMzUuNDMwNTIyNTcwMzg2NSwwLDQuNTE5MzgwNjEwNDM2MiwxLjI1ODQzNzQ3ODkxNDg2LDQwLjQ2MDkyNTk4MTQwMjQsNDAuODM2ODU4OTI5NjAwNiwxMDAuNTk5NjQ3OTU4Mjk3LDc0Ljg3OTA1NjQxNzg0ODksIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo1ODUyLDM0NTIsMjU1MiwyMDE5LTA1LTAzLDIwMTktMDUtMDMsMiwxLDEsMzUuMTY0NTQwNzE3Mzc4MywxLDIuNTg0OTQ1Mzc2OTYyNDIsMi4wMzg4ODQzNDgyMzYwMiw0MC44MTU3ODczMDEzOTg4LDQxLjgwMzQzNDIxMjIyNjQsMTEyLjkwMTE4NTkzNDg5OCwxMDUuOTE2NDA5NDU1MjQsIlBvb2wiLCJGcmVxdWVudCINCjU4NjAsODgzMSw0NjQ2LDIwMTktMDEtMDIsMjAxOS0wMS0wMiwxLDEsMSw0NC42MDEzNzcxMDkwNjU3LDAsMS4zMTYzODE3MDY4NTYxOSwxLjAzNDAxNzg0NjkxOTYsNDAuOTc3NDc5MzUxMjE4OCw0MC43OTA2Mjc1NjYxNjYyLDExMi4xNTE5NDA2ODM4MzQsOTcuNzY3MzYxNzgyMDI1NSwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQozMjU4LDUxMDQsNjQ0OSwyMDE5LTA5LTAzLDIwMTktMDktMDMsMSwxLDEsMTYuNDg5NTQ0ODQ2MTE3NSwxLDMuNDA5OTAwNjgzOTA5NjUsNC40NDQ5NzE0MDY4MzIzNCw0MC45MjkxNTAwMjA3MDM3LDQxLjE1MDY0MDUxOTMzNTksOTYuMjEyNDExMDgyODE1NCw3OC4xMDA4OTczODgwNjcxLCJQb29sIiwiQmFzaWMiDQoyMTY3LDU0MDYsMjg4MCwyMDE5LTA1LTI4LDIwMTktMDUtMjgsMSwxLDEsMTkuNzI3Njg1MjQ2NjE2NiwxLDIuNjE0MTgwMzIyNzM2NSwzLjIzNzg4NjQyOTc2NDMzLDQxLjkwNDQ3ODcwNTk1MzgsNDEuNzU3MzE1Nzg3NDg2Nyw3MS40MjYzMzIxOTk0ODA0LDc2LjM3ODkxODY5OTkyMDIsIlN0YW5kYXJkIiwiQmFzaWMiDQo2MDk0LDM4NDUsNTkwNywyMDIwLTAxLTAxLDIwMjAtMDEtMDEsMSwxLDEsMjIuODA5MzY2NzIzNTIyNSwwLDMuNjI3ODQwNDcyMzg1MjksNC40NDY2NzcwMDk1NzUwNyw0MC44MzIxNDAxMjY3MzEyLDQwLjM1NjA2MDI0MDQxNzcsMTE2LjgwMDQ2MDA4NDM0MSw4Ny40MDgwODI2MTA5Mjc1LCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjg1OTIsODUyNCw3MDU5LDIwMTktMTEtMjgsMjAxOS0xMS0yOCwxLDEsMSwyOS45NDY3MzY2MDk1NjMyLDEsMi41MzAzNjczNzA2OTQ4OCwxLjg3MDI5MDc5MDY4NDUyLDQxLjc1NTY2MTYxMzc3MzYsNDAuMzQ2NzQyMDkwMzAzNSw3OC4yMjMzMDMwNDY1NDMyLDEwNi4xNTI5MDk3MDc3NDQsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo1MjE2LDY4MzQsODMyOSwyMDE5LTAxLTE0LDIwMTktMDEtMTQsMSwxLDEsMzQuOTY5MzQ0NjA0NzYwNCwxLDMuNjU4MTMxOTM5MzU5MDEsNC43MTIwNDA4ODgxNDU1Nyw0MS43MjY1ODQ2NDg3MTM1LDQwLjU3MzI5ODEzODEwMDcsNzcuMjI0MDM3NzE5NDI0OCw4OS45MTA2ODU4NTc3NTc5LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNDkwMiwzNzQ3LDMwMjUsMjAxOS0wMi0xMiwyMDE5LTAyLTEyLDEsMSwxLDQ3LjUxODM5Nzc1NTkyMDksMSw0LjI0MDA1OTgwNTEwMjY1LDEuNTQ2Njk3NjAxNjc1OTksNDEuMTAyMDkzMjgxNjksNDEuODkxMDkwMTY4NjE3Nyw4Ni44MzM4MjUxNTMyOTg3LDExNi45ODQ0MzE1MjAxMDQsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo2OTUzLDk1MzUsMjczOCwyMDE5LTA3LTIxLDIwMTktMDctMjEsMSwxLDEsMTEuMDEyNTM4MzI2OTA0MiwxLDEuNDE3MzM4NTU0NzQ3NCwxLjcyMTM4MzY0NzA2MTg4LDQxLjIyMDY1NTIyOTg3NCw0MS4xMjUzNDY5MTE2MDU0LDg0Ljg4Mjc4NTcyMjE0NzcsOTkuNDMyNTI4Mzk2MTM3MSwiRWxpdGUiLCJGcmVxdWVudCINCjg2ODMsNTE2NCw1NzY3LDIwMTktMTAtMTksMjAxOS0xMC0xOSwyLDEsMSwxMy45MjcwNDU0NDU4ODkyLDEsMS45ODI0Mzg4Njk3NzQzNCwyLjE5NDY0ODE4MjAxOTU5LDQxLjk2OTEyMDgzMDc2MzEsNDEuNzE2Mzc3OTY3MDM3Myw4OS4zNDM5NDM2ODQzNjE5LDExNi4zODY5NTMwMTI1NTIsIkVsaXRlIiwiU3Vic2NyaXB0aW9uIg0KNzY2OSwzOTY5LDY2MTAsMjAxOS0xMC0yMSwyMDE5LTEwLTIxLDEsMSwxLDMzLjQ1NDk5MjQzNTg3MjYsMCwxLjI4MDIwOTIxNzIyMDU0LDIuNTM5OTAyNzAxMDQyNTksNDEuODA2MDE3OTU5NDkwNCw0MS43MTkxNDc2ODkxNzQ5LDk0LjU2MzU0OTYxMDMyMDUsNzMuMDQ3MDc3MjUyOTk1MiwiUG9vbCIsIkJhc2ljIg0KNTE2MSwyNTk4LDI1MTAsMjAxOS0wOS0xNywyMDE5LTA5LTE3LDEsMSwxLDMwLjI4NTcyOTc3NTIwNTMsMSwxLjc2MjIzMTM3NDE1OTQ2LDQuMjgzODYwNDA0OTc1NzEsNDEuODYwNzU2Njg4Mjg1Niw0MS44NTIzODUzNjU4Njk4LDkwLjE4ODg1MTAxNDI0NTMsMTA0LjQ0MTQwNjYxNzQwNywiU3RhbmRhcmQiLCJCYXNpYyINCjQ4NjcsMzM2OSw3NzI4LDIwMTktMDUtMzEsMjAxOS0wNS0zMSwyLDEsMSwzNi4wMTg0MjM0MDA4MTkzLDAsMy43NTcyNjkwOTA5NzI4NCwzLjQ5MzA1MzMyNzMxNDU2LDQxLjcxMTkwMjE3MzcwMTcsNDEuNzY2OTI2NzIyNjAxMSwxMTkuNzEwODA2ODU1MDAxLDg5LjY2OTYzNzI1ODYzMDIsIlBvb2wiLCJGcmVxdWVudCINCjg1NTMsODY3NiwzNzAyLDIwMTktMDktMTMsMjAxOS0wOS0xMywyLDEsMSwzOC41NDU1MTc4OTM1MDgxLDAsNC42MTYwODg5Njc3NzAzNCwyLjg2NTM5NjM0MDM3NzYzLDQwLjA0NTMzOTg4NzQ5NjEsNDEuNzY1MTcwOTk1NjExNyw3Ny4xNjg0NTUxNjU4MTA5LDgyLjY5ODQwNTMyOTEzOCwiU3RhbmRhcmQiLCJCYXNpYyINCjQyMzQsNjM3OSw4Njk1LDIwMTktMDUtMTgsMjAxOS0wNS0xOCwyLDEsMSwzMC4yMjcwMDY0NDA5ODIyLDEsMi4wNTAxMDg2NjM3Mzc3Nyw0LjEwMzc5OTA1NzE5MzEsNDAuNjY2MDcwNjQ0NzQzNyw0MC44ODUzODUzOTAzNzExLDcxLjA4NzY2OTg0MTk0NTIsODkuOTA3NTUyOTcwMTA3NiwiU3RhbmRhcmQiLCJCYXNpYyINCjc3NjUsODM3Nyw0ODgwLDIwMTktMDMtMDksMjAxOS0wMy0wOSwyLDEsMSwyMy4zODk0MzI3MjgyOTA2LDAsMy4zOTQxNzA2MDU1Nzc1Myw0Ljg0NDkxMDk2OTAyNjM5LDQxLjIwMDYwNzE5NTAzMDksNDEuNjQyMjk0MDQwODgxMSw4Mi41NzEyNzkyNjIxOTI1LDk3LjE4NjY0MTI2MDA1MDIsIlN0YW5kYXJkIiwiQmFzaWMiDQo2NjU5LDQzMTQsOTA3NSwyMDE5LTExLTEzLDIwMTktMTEtMTMsMSwxLDEsMTcuOTUyNjUzNjM1MjkzMiwxLDQuNjg0ODY4NTA1MjI0NTksMi43NzcxNzAzNDA1MzA1Nyw0MC41MzI3MzQwNTA4ODExLDQwLjI2NTkwMjA5MjIxNDcsMTA4LjE2NTg0MTY3MDcwNyw3My41MTc5MTM3NDg1MTAyLCJQb29sIiwiRnJlcXVlbnQiDQoxNzE1LDk0NTAsMjk5MywyMDE5LTAyLTI3LDIwMTktMDItMjcsMSwxLDEsMzcuNDk0NTg5MTkyNzkyOCwxLDQuMTkzMDIxMjIyMDE3NzEsMy4zMjg2MDc1NjEwNjY3NSw0MC41NDg5NDc0ODUxNjM4LDQxLjkwNjQ5MjQ0NjU0OTIsODQuMDM3NzIyMjc5MzE3NywxMTAuNjk3MDYwNDU1NTY4LCJTdGFuZGFyZCIsIkJhc2ljIg0KODA1OCw2OTcyLDc1NzMsMjAxOS0wNi0xOCwyMDE5LTA2LTE4LDEsMSwxLDM3LjExMjA1ODEwMzA4NDYsMSwxLjI4MjM5NjI3NDYxODgsMi4wMzUxNzQ1NzA5Nzc2OSw0MS44NjA3NzMzODM2Mzk4LDQwLjYwMDk5ODMwMTA1OSwxMDAuMTY4MTcyMDg4NDUyLDkwLjM5NTEzMDg2MjAxNjIsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo2MTY2LDQ1MzEsODU2MywyMDE5LTAyLTExLDIwMTktMDItMTEsMiwxLDEsMjkuMDIyNzU2OTM2MDI4NiwwLDQuNjUyNTQ5NjkxNDk4MjgsMi41MTY5NDczNzAwMjI1NCw0MC42MTc2MzMxMzc4NTIsNDAuMzU4NDQ1MzE0MjI0OCwxMTQuOTAzODg3NjY4NjI1LDc1LjI0NTAzMzEwNDQzODMsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo0MzU4LDEwMTIsNTUzNiwyMDE5LTAzLTE5LDIwMTktMDMtMTksMiwxLDEsMjguNzcxNjAyMzQzNzY3OSwwLDEuMzQwOTQ2NTUwNDgxMDIsMS42NzMxOTQyNTY2MTExNyw0MC4xODQ1NjM0ODEyNDg5LDQwLjkyODY5NzMyNDM1NzksNzQuNzc3MDMyMjMwMDQ5NCw5Mi42NzA4Mzg3MTQxMTE2LCJTdGFuZGFyZCIsIkJhc2ljIg0KMzUzMiwxMjE1LDczMDksMjAxOS0xMi0xNywyMDE5LTEyLTE3LDEsMSwxLDEyLjc2NjEwMzg5MzUxODQsMCwzLjkzNDUzNDY1NjgxNTIzLDIuNDcxMTQzMzg4MTg5MzgsNDEuMjQ4NzY2OTU5NjQ0OSw0MS44OTg4MDI5NjQ5NDgxLDExOS4yMDQxNjkyOTUyNjMsODkuOTg0NjA4NDQ2MjQ3OSwiUG9vbCIsIkJhc2ljIg0KODkzOSw1ODU3LDY4OTUsMjAxOS0xMi0yNSwyMDE5LTEyLTI1LDEsMSwxLDE2Ljg1MDkyODczODcxMzMsMSwzLjI5NjQ5MjAyNTI1NjE2LDIuODg4OTc5MzEzODk1MTEsNDEuNDY0NDI3NzA5NTc5NSw0MC4xNzE3Mzk0NzIwNzYzLDczLjM0OTQ0MzE1MjU0NjksMTAzLjg0Mzc1NzgwNTg4LCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KOTY1OSw5NzU3LDM5NDksMjAxOS0xMC0wNywyMDE5LTEwLTA3LDEsMSwxLDE5Ljk4NDQ1MTgzMDM4NzEsMSwzLjAyNTkyNjc0MzYzNDA1LDIuMjkyNTc5MzAyNTY0MjYsNDAuMzQ4MzQwMTQ0MzgwOSw0MC4xMjQ4MTQzMDA3OTc5LDc3LjA2NjY2ODYzOTg5MDgsMTExLjExNzM5ODYyNzEwMiwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo0NTUyLDcyMjYsNzE0OSwyMDE5LTAxLTA2LDIwMTktMDEtMDYsMSwxLDEsMjcuOTE3NDc4MTc3Njk2NSwxLDQuMjU4MTQ0MzY5MzQ4ODgsMi44OTk5OTYyNDE1NTQ2Miw0MC41NjY4Mzg1NDk0NSw0MC4zNTM2NzQwMDUyNTE0LDk5LjQ5NzEyMjA3NzczNywxMTUuMjg0NjQyMjc5MTQ4LCJTdGFuZGFyZCIsIlN1YnNjcmlwdGlvbiINCjE0NzUsNjAwNCwzMzAwLDIwMTktMDEtMTYsMjAxOS0wMS0xNiwyLDEsMSwxOS4yNjAzMzEyODA1Mjk1LDAsMy41OTc4NTAxNTYwMTY2NSw0Ljk5MzM3NDI4OTAxMzQ1LDQwLjQ3MzY2Mjc4MDU5NzgsNDEuMjQyNzgxNTM4OTgxOSwxMTkuMjY2MzA2MzkyMzgzLDEwNy44MTM3MTQyMTY0NjMsIkVsaXRlIiwiQmFzaWMiDQo2ODYwLDEzNTQsMzA1MiwyMDE5LTExLTA0LDIwMTktMTEtMDQsMSwxLDEsMjEuNzI5Mjk3MDc5MTQ1OSwxLDIuNjUzMzc0OTEzMTQ4NTgsMi41NjgzMzg0MDkwNjYyLDQwLjg4NTY3NTA2NDc1MzcsNDAuMjk2MTA4MTEwODA3OCw5Ny4yNzczODMzMDE0MDcxLDgxLjM2OTM2OTA1MDk1MzUsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5MDc2LDE3MzUsNTA3OSwyMDE5LTEwLTI3LDIwMTktMTAtMjcsMSwxLDEsNDYuNjc2MjU5OTE2Mjc1NywwLDMuNzcwMDQ4NDA4NzY5MDcsMi41ODI3OTM1MTIzODE2MSw0MC44NTg2MzczNzYyMjI4LDQxLjUwNDU2NDMyOTUxNjEsMTA0Ljk2NzU0NjU2MDgwMiw4MS44OTkxMjM4NjQ3MTQxLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KODU5NCw1MTE3LDQ2NjIsMjAxOS0wNS0wOSwyMDE5LTA1LTA5LDEsMSwxLDI4LjAzMjAwNDk0NDk4MDEsMSwzLjU3MTUwODM2NDc1MTk0LDEuMjc5NDA2MzUxMDM3MzIsNDEuMzg2MTE5NDUwOTA4Miw0MS45NTAzMjE3ODc1MDI2LDgxLjk4NzgwODc1NDIwMiw3OS44NjI3ODMzOTk4NzYyLCJFbGl0ZSIsIlN1YnNjcmlwdGlvbiINCjE0MjksNjY0Niw0NDQ3LDIwMTktMDgtMDUsMjAxOS0wOC0wNSwxLDEsMSwzMS43NDQ0ODIwODg4MzQsMSwyLjM2NDk0NjY2ODAzNjI4LDQuMTczNTQwMTIwOTQ0MzgsNDEuNTQ4MDM4MjM2Nzk2OSw0MC4wNzQ1MDIyMjE3NzQzLDkxLjk4NDE2OTU5NzI3MTgsMTA5LjM4NDU4NTg4NjcyOCwiRWxpdGUiLCJCYXNpYyINCjE0ODEsNDMxNSw4MTI4LDIwMTktMDEtMTEsMjAxOS0wMS0xMSwyLDEsMSwyMi43MzE4MDY5MTUyNTM0LDAsNC44MjMxNDgyNTk4OTMwNiwzLjk4MDM3OTYzNTQ2ODEzLDQxLjAxNTEwNzUwNDU1NzgsNDEuMjM0NjE3NjY1NDEsMTE0LjQ3MjYzNjQ5MTk5Miw4Ni40MDg4MDM5MDc2ODg3LCJTdGFuZGFyZCIsIkJhc2ljIg0KODgzMyw1NzMyLDkwOTEsMjAxOS0wNC0wOCwyMDE5LTA0LTA4LDEsMSwxLDQ0LjYzMjY4MTY4MjcwNTksMSw0LjMxODA5NjE0MjI2MjIyLDEuODQ5NzI5Mjc5OTg3NTEsNDEuNjI4NDA4OTIwNDg1NSw0MS4zNDcyMTAxODM3Mzk3LDcxLjUwMTYyNzEyNjcwODYsOTUuMDczOTE2MjMyMjEzNCwiRWxpdGUiLCJCYXNpYyINCjQ5NDMsMjI1OCw0ODQ4LDIwMTktMDktMDQsMjAxOS0wOS0wNCwyLDEsMSwxMC44NTcwNDg0MTY1MTAyLDEsMy4xOTgzOTgxMzE4NzcxOCw0LjUzNzgxMTA5OTU1MTYyLDQxLjY1NDY0NjQzNDM1NTUsNDEuOTMwMzc5NTA1NzM0OSw5MC4wOTcxMjIwMDM3OSw3MC4wOTA2NDc4NDk3MiwiUG9vbCIsIlN1YnNjcmlwdGlvbiINCjQzODIsNTc2OCw0Njg4LDIwMTktMDctMDEsMjAxOS0wNy0wMSwxLDEsMSwxMi4yMTc2MDAzMjY5ODUxLDAsMi4wNzIxNjQwNTc3NTM5OCwxLjI1ODU1MDk5MDM3MjksNDEuODg5MzU5MDI4MDc4Niw0MC4yNzAyMjEzODkzNjQ1LDEwNy4zOTY2NzkwNjE5MzEsNzguMTMxMDQwMTc4NzA1LCJQb29sIiwiQmFzaWMiDQoyMTAxLDg3OTMsNDQ0OCwyMDE5LTA5LTE5LDIwMTktMDktMTksMiwxLDEsMTEuMTA1NTA1NTQ0NjkyMywwLDMuNTE1ODMzNTc1Mjc4NTIsMS4xMDcxMzk1NTIwMTIwOSw0MS44MDcxNTcwMjEwMTU5LDQwLjcxNjMwMTQ3MDk5NDksOTEuMjQ0OTU1NTUxODEwNiw5OC4zNTUwMTE3MjgxMjY2LCJQb29sIiwiRnJlcXVlbnQiDQoxMTI4LDg2OTEsNzA3MSwyMDE5LTA3LTI4LDIwMTktMDctMjgsMiwxLDEsMzYuMjk1NTMzNzY2OTcsMCwyLjc5OTcwNDA0NTk4ODYyLDEuODk3NTIzNTcyNjY4NDMsNDEuMDgzOTAyMDYyMzgyNSw0MS44MTEwNzMzMzExNjIzLDcxLjIyMzE0NjY3MDk2MzYsMTA4Ljg3MTQ0MDQ0Mjc0NSwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo4MTY3LDY2NTEsOTcyNSwyMDE5LTA4LTMwLDIwMTktMDgtMzAsMSwxLDEsNDUuMTI0MjQ2OTUzMDU1MywwLDQuMjgxMzMzMDQ5NzU5MjcsMy42OTc4Mjg3OTg1NTQ4NCw0MS43MDE0NDkzNjk1NDYsNDEuODQ1Nzg4MTcxNTE0OSw3MS4xNTkzNDQ4OTI5NDg5LDEwNi45NjY2NDM0MDA5NTYsIlBvb2wiLCJCYXNpYyINCjM4MjksOTgxNCw5NDU3LDIwMTktMTAtMDQsMjAxOS0xMC0wNCwxLDEsMSwyMS45OTE5NjczNDQ2NTY2LDEsNC4yNzQ5NTk3MjgxMjE3Niw0Ljk3OTUyNjAyOTg5OTcyLDQwLjQzNDQ1NzI3ODgxMDQsNDEuNzk0ODkyNDM3MjkwNCw4MS4zMTI4MTg3MTM0ODYyLDExMi4zNDE2Mzc5OTU1NiwiRWxpdGUiLCJCYXNpYyINCjY3MTksMzA3MSw4NjM5LDIwMTktMTItMTgsMjAxOS0xMi0xOCwyLDEsMSwxMi42NjczODU0Nzk0MzUzLDEsMi44NTQ2ODg2ODQ0NTYwNSwzLjMwODQ2MTk2NTk5MzA1LDQwLjYzNTgyMTczMDgyOTgsNDEuMjU4MzQ0MTY2NDQ2NSwxMTguOTA4Mjg3NDYxMzgxLDExMi4zNDUyNjI2NDQ4MTIsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5OTc0LDE4OTEsMzY2MCwyMDE5LTAzLTI2LDIwMTktMDMtMjYsMiwxLDEsNDcuMTc3Mzg0ODIxNjk4MSwwLDEuMTI1MDM2NDk0ODA2NDEsMi40NjEyMTg2MDM4ODY2Niw0MC44MjQ2NzIyNjU0NDQsNDEuMDk0MDM1ODczMTg5Niw4OS4wNDk1MDU2NTY1ODUxLDkyLjI4ODgwMTkyODUxNjUsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KMTM4Miw4OTU0LDM4OTUsMjAxOS0wOS0yNiwyMDE5LTA5LTI2LDEsMSwxLDI3LjczMDUzMjI0MTk4NTIsMCwxLjkyNDY2Mjg1ODI0Nzc2LDMuNjg0MTQyMjY3MzMxNDgsNDEuMzUxNzMyMDMwMDQ1Miw0MS43Mjk1MzE3MjAyODA2LDEwNC4xNjg0Mzg2MDE3NzMsODUuNjQ2Nzc4Mzk2MzMwOCwiUG9vbCIsIkZyZXF1ZW50Ig0KNzUyOCw5NDg4LDQxMzgsMjAxOS0wMS0yOSwyMDE5LTAxLTI5LDIsMSwxLDMzLjU5MDIzOTE0NjcyNDMsMCwxLjMyMDQxNjg0MTY1NTk3LDEuNTA4Mjk1ODAzMzMwODQsNDAuMDA4ODQ4OTU2Nzg2MSw0MS4zNjEyOTg4OTk2MzE5LDk4LjgxMDEwNjE0ODAxMiw5MS4yNzIwMDQzNzI0NDAzLCJQb29sIiwiQmFzaWMiDQo5NjUyLDcxNzksNTY2MywyMDE5LTA3LTA1LDIwMTktMDctMDUsMiwxLDEsMjEuNjA0MDAzMzI4ODMsMSw0Ljk4MjkzMzEwODY5NDg1LDEuNzgxMTcwNTM5NTU3OTMsNDEuNjU0MDgxNjE1MTUzNyw0MS41MTYzMzYyNDI2NjgzLDExNS4yNTE1NzkzMTQ5MzYsMTE1LjM1ODQ1MzY2NzcyMywiUG9vbCIsIkJhc2ljIg0KODk2NSwxNTUyLDU5MzYsMjAxOS0wNC0xNCwyMDE5LTA0LTE0LDEsMSwxLDMxLjMyNjYwMDkxODU0NjMsMSwxLjMyNjk5NDU1NjAwMjMyLDMuNDY1NTEzMTUzOTMyOTksNDAuNDIyNjYwOTcyOTIzLDQwLjQzNTk1NTE2NDQ4ODQsODAuNTA1ODAwNTMxMjQ1OCw3MC4wMzAzMDA2NDk4MTQzLCJQb29sIiwiRnJlcXVlbnQiDQo5ODczLDcwNDMsMTYxMiwyMDE5LTAyLTE5LDIwMTktMDItMTksMiwxLDEsNDQuNzYzODk5NzI0OTMwNSwwLDMuNzE3MzcyOTk0ODY5OTUsMy43MDI1NjkzMDk2MjIwNSw0MC42ODg3NjM0ODY2ODcxLDQxLjM5OTEwMTMyODEwNDcsMTE1LjA1ODQwODU1NDE3OCwxMDYuNDQyNjAwNDQ2NzUzLCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNTg1MCw3OTY2LDg4OTksMjAxOS0xMi0yNiwyMDE5LTEyLTI2LDIsMSwxLDEyLjU2Nzk3NDY5MjIxMDYsMSwzLjY5MjgyMTQwOTU1MzI5LDMuODA2NjAwMzI4NTM0ODQsNDAuNTg1ODM0NDc3NTYyNSw0MS4xNDE5NTE5ODU2NTcyLDEwNC44MDQ2Mjc4NDY0NjEsMTA0LjY4NzQ5MTQwMTU2NCwiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQoyNzQ2LDExMTAsNTY0OSwyMDE5LTExLTIwLDIwMTktMTEtMjAsMSwxLDEsMTYuMTc1NDk0MTU2Nzc3OSwwLDEuMDA0MzM5NTk2MjU2NjEsNC4zNjkyNDU0MjQ4NjY2OCw0MS4wMTg5NTUxNjIyNjA3LDQwLjUwODk2MDQzMTQ0MTcsOTkuMjY5NjI3NzcyNzM3MywxMTkuMDc3MTAxNDI0MzM2LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNTM4NCwyNDIxLDQ4MjMsMjAxOS0wNi0wNSwyMDE5LTA2LTA1LDEsMSwxLDMxLjAxMzU5MzA1OTAzMzIsMCwzLjMzODAzMTg1MzU0OTE4LDEuNjU1NzkxMTU5NzE5MjMsNDAuMTk1MzcwNDkyOTkxMSw0MC44MzQyNDM4MDA5NTY4LDEwNi4xMDY1OTIzNTg1NTYsODEuMzc3NzY2OTM3OTQ4OCwiRWxpdGUiLCJTdWJzY3JpcHRpb24iDQo1NDE0LDU3MDgsNDE0MSwyMDE5LTExLTEwLDIwMTktMTEtMTAsMiwxLDEsMTMuODQzNTg3MTQzMzQ2NywwLDEuNzg4NDYyODQ3NDcxMjQsMi45MzE0MzMxOTUyNDgyNSw0MS40MDg5NDc1MjEzNTUsNDEuODMyMDExMDk1NzEzOCw4NC45MTU5OTgxMTcwNjY5LDk0Ljk2Njg1NzQ0MjYzMjMsIlN0YW5kYXJkIiwiQmFzaWMiDQoyMjYzLDMyNDQsNDE4NCwyMDE5LTAyLTA4LDIwMTktMDItMDgsMSwxLDEsMjcuOTc4MTYwMzcyMDAzOSwwLDQuMjIyMTk0NDY1ODA4NTcsMi4xMTUxNjUxMjA5MjIwMyw0MC4xNDU4NTk0NzY2NDQ1LDQxLjgzMDkwMDY4MTIwNTEsMTAyLjk4NTQ1MDAwMTQzMyw5Ni4xNjgyNjM0ODIzOTU2LCJTdGFuZGFyZCIsIkZyZXF1ZW50Ig0KMjIxMiwyNDA5LDMxMjEsMjAxOS0wNS0wMywyMDE5LTA1LTAzLDEsMSwxLDQ3LjEwODMwODgyMTkxNjYsMCwzLjAzNjgzNTI4NDkwMzY1LDQuMTI5OTg4NTUyMDcxMTUsNDAuNDA2MzgyMzA3NDEwMiw0MS44MzU4NzgzNDc5NzgsNzMuOTg5NzY0MDQ2ODU1Myw4Ni44OTA5NjE2MzAyNjk5LCJFbGl0ZSIsIkJhc2ljIg0KMzU3MiwxOTE4LDQ4NzQsMjAxOS0wNC0yMiwyMDE5LTA0LTIyLDEsMSwxLDQzLjcwMjcxODQ5NDQ2LDAsMy41NzIyMTQ5MjE5MzYzOSwyLjcxNDk3OTk5NjkwNDczLDQxLjg3ODk2MzE1MTQ4MSw0MS40NTkwMTgxNjg1MDUzLDc0LjI0NDAxNjE0NTgyMTcsMTEzLjE5MDc5MDE4ODk2NCwiRWxpdGUiLCJCYXNpYyINCjg5MjQsOTIzMiwzODYzLDIwMTktMDEtMDYsMjAxOS0wMS0wNiwyLDEsMSw0Ni4wOTU1NTIwMjUzNjI4LDEsMy41NDQzNTY2MDAzODE0MywzLjc5MTYzODMzODkzODM2LDQwLjk2MzQ0NDQ1OTcxNzcsNDAuMzMyMDk2MzY2Njc3NCw5NS42MTk1MDkwOTQzOTQ3LDExNC4yODU2OTIwNjUwMjMsIlN0YW5kYXJkIiwiU3Vic2NyaXB0aW9uIg0KMTE0NSwzNzQzLDkyOTIsMjAxOS0wOS0xOSwyMDE5LTA5LTE5LDEsMSwxLDEyLjcwMjg5MzA4MzkxNTEsMCwzLjE2NTQ2NTI2MjcxODUsNC4yNjAwNDc5OTkyMTA2Niw0MS4wNDM2MTEyOTIyNjE2LDQxLjgzMDA4NzMxNzE1MzgsMTE4LjIzNDUzMTQyMzA3NywxMDYuNDU4Nzg4Mjg4MjkyLCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KNDMyOSwzMDg1LDg4ODcsMjAxOS0wOC0wOCwyMDE5LTA4LTA4LDIsMSwxLDI5LjY1Mzk5MzIzMDMxMzEsMCwyLjE4OTIyMTM4ODY2MDM3LDEuNTY4NzM0MTAzODEzNzcsNDEuNjAyMjA5MjQ5MDQ1Nyw0MC41NjU5OTM1NTM5NTg4LDc3LjIzMzQ1MDE3NzU5MTMsODcuNjUzMjIyODAxMTYzOCwiUG9vbCIsIlN1YnNjcmlwdGlvbiINCjg3ODcsMTgwNCw0MzE2LDIwMTktMDMtMTAsMjAxOS0wMy0xMCwxLDEsMSwxMy41MDU2OTAyOTMzODY2LDEsMy40NDkwOTAyODg5NTE5OSwxLjk4MzQ5ODQxNjg0MTAzLDQwLjMwNjk2ODQ3MTAzNTQsNDEuNTYxNTU4ODQ5MTc4MywxMDYuNzE5MzY4NzQ3NDM2LDExNy44ODg5MTQ5OTYyOTIsIlBvb2wiLCJTdWJzY3JpcHRpb24iDQo5MjY0LDc3MTksMTE3NCwyMDE5LTAyLTA2LDIwMTktMDItMDYsMiwxLDEsMTkuNDI3OTUzNDM2OTcwNywxLDQuNTgxMzY2MzQyNDkyNCw0LjE3MjQwMTIwOTM2MTg1LDQwLjY1MTgyNjY1MjY5ODIsNDEuMDAzMzQ0MzM3OTIxNiw4Mi4zODYxOTg2NDQ1MjYzLDg1LjI0NzM1Mzg1MzE5MjIsIlBvb2wiLCJCYXNpYyINCjU2ODcsMzEyOSw4OTMwLDIwMTktMDctMjksMjAxOS0wNy0yOSwyLDEsMSwyMC40MjMxNzE4MzY4ODI4LDEsNC4wNzMwMzY3ODI0NDM1MiwzLjc0MDUxMzk2MDgzMDg3LDQxLjc5NDg5ODEyNDQxMTcsNDEuOTY3Mjc1Mzc5MjI1Niw5My41ODM4MzA5ODYxNzIsMTAwLjg0MDA4MzE1MzQ1MywiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQo4MDg1LDMzMzYsODk5MiwyMDE5LTA4LTAzLDIwMTktMDgtMDMsMSwxLDEsMTguNDAwNzgyMjcyMjE5NywwLDIuNjIyNTgyOTU2MjE3MjMsMS45MjM2NjM0ODk1MjA1NSw0MC42MDg3ODY0OTQ0NzExLDQwLjgxMzA5OTE2MTcyMTgsMTAwLjQ1OTQ3NDQ5MjgxOCw3NC44Mjc4MDgyODYwNjM0LCJQb29sIiwiU3Vic2NyaXB0aW9uIg0KNDkzOCw1MDU2LDY2MDMsMjAxOS0wOC0yMiwyMDE5LTA4LTIyLDIsMSwxLDQ1LjQ4ODUzMTIxNjk3OSwwLDMuMzU0ODM1Mzk3NTYzODcsMi44OTgzODA3NzMxNDE5OCw0MS4yNTY0NjgyNDM0MzEzLDQwLjM3NzA5NDAyNzEyMDYsODguNzc3OTMyMzQzMDczMiw4OC43NTkzMjA4NTA5NDk3LCJQb29sIiwiQmFzaWMiDQo1NjEyLDgwNDQsMzgzNCwyMDE5LTA5LTIzLDIwMTktMDktMjMsMSwxLDEsMjMuNTM4ODc0NjIwNTcxNywwLDEuNzIxNjc1NDM1MDgxMTIsNC43MjcyNzAwMDQzMzk1Miw0MS4wMjk4MjY0MTcwOTk3LDQxLjY3ODIwMTE3MjAzNTIsNzkuNTI3Mjc5NTc2Mjg2Nyw3OC41NjIzNjMxMjUzODM5LCJFbGl0ZSIsIkJhc2ljIg0KNjM4NSwxNDQxLDg5NDcsMjAxOS0wOS0xOSwyMDE5LTA5LTE5LDEsMSwxLDI3LjkxODg2MzkyOTgwODEsMCwxLjI4MTY5OTM0MTcyMTgzLDEuNjE1MDY5MTcwNDgyNDYsNDAuODM2MTUxMTU3MDQwMSw0MS45MTgyOTExNjk2ODQ0LDEwOC4yMTEyMzI1Mjg1NTYsOTQuMTg5NTMyODk3NDM1MSwiRWxpdGUiLCJCYXNpYyINCjI3NDQsOTkzMCw0MzgwLDIwMTktMDktMjYsMjAxOS0wOS0yNiwyLDEsMSwzMS40MzM2MTI0NTI4MTk5LDEsNC42NTc1NDI0NzY0MzA1NCwzLjg1MzMyMDg4NTQ0OTY1LDQxLjc4MjIwMjcyNTI5ODcsNDEuMzQ0OTg5NTE1ODQxLDgyLjU1NTcxMDkxMzE0NzgsNzkuNzk3OTEwOTk2NzEyNywiUG9vbCIsIkJhc2ljIg0KNjQxMiw5NDc5LDg0MzEsMjAxOS0wMi0xMSwyMDE5LTAyLTExLDEsMSwxLDQxLjA4OTc4NzYwNDI4NzMsMCwzLjIzMTUwMDk0NDEyMjY3LDEuNTQyNzMzNzc3MzE0NDIsNDAuNjgzNTc3NzkwMzkwNyw0MC45MTA1NTgzNzY5MjY5LDk3LjExODg1OTMwMDM4OTksOTcuMDU5Nzk0ODgwOTE1NCwiU3RhbmRhcmQiLCJTdWJzY3JpcHRpb24iDQoyMDg5LDE2MzksNDc1MiwyMDE5LTA4LTE0LDIwMTktMDgtMTQsMSwxLDEsNDYuOTA5MDYwOTA2NjE4OCwxLDMuNjU2MTAzOTA3MTUzMDEsMi40MDgyNTA0MDA3OTY1Myw0MS40MjcyMjc1NzU3OTc2LDQwLjM0OTQ4NjM1MTk0NDUsMTE2Ljg4MjkzNTAwODAzNCw3Ny4xNDM0NTcxNjQwNTY2LCJQb29sIiwiQmFzaWMiDQo5MzI5LDE4NDksNDQ4NCwyMDE5LTA1LTA2LDIwMTktMDUtMDYsMiwxLDEsNDIuNjE0MTA3NjkwNzUxNiwwLDMuMjc3OTUwOTE5MjMzMjYsMi44MTI1ODQ1OTAxNjY4MSw0MC4yMzk2OTAxNTUyNTY1LDQwLjUxMDI3MDQ0NTYwNzYsOTkuNjM2NDA5NDU5NjM1Niw4Ni40MjEyNjY5MDEzMDY4LCJQb29sIiwiRnJlcXVlbnQiDQo2MTgzLDI3NjgsNTM1NCwyMDE5LTA2LTE0LDIwMTktMDYtMTQsMiwxLDEsNDUuODMyMDQ5Mzk5NjE0MywxLDMuMDgxNjQ4MjU0NzY3MDYsNC4yNTMzNzE3OTU2Mzk0LDQxLjM3NDk2MjY5NzI3MTMsNDAuNjg4NjA0MDk2NDE2NCwxMDMuOTY5OTA3OTUxNTQxLDEwNi42NjA4Mzc1NDUwNiwiU3RhbmRhcmQiLCJGcmVxdWVudCINCjMxNjYsMjA1Miw0OTAzLDIwMTktMDgtMjAsMjAxOS0wOC0yMCwxLDEsMSwzMC44NTI3MzE4Mzg4MjI0LDAsNC45MjE4MzAxNTQ5NTUzOSw0LjYyMTU0MDEyMjY2NTQ2LDQwLjAwMDY3NjQ2MTQ5NTUsNDEuNTcxNDkzNzQ2NzEyOCw5MS40OTc2NDE0MzM5NjE3LDkxLjE1NzcyNzU2NTE1MDcsIlN0YW5kYXJkIiwiRnJlcXVlbnQiDQo4MDY2LDM2NTIsNTg2MCwyMDE5LTA5LTA1LDIwMTktMDktMDUsMSwxLDEsNDcuOTQ3MDEzMzk2NzY5OCwwLDQuMzA5Njk4MTQ0OTA1MjcsMi45MTcxNDI3MzQ4NjI4Niw0MS4wMDMwMzUyMTAwNzMsNDEuNTQ0NzQ1NjU4OTksMTE0Ljk1NzQzMTMzNTkzNCw4Mi4wNjQ1MDA3MTE4NTgzLCJFbGl0ZSIsIkJhc2ljIg0KNjI4MCw1ODI4LDU1ODksMjAxOS0wNS0xNywyMDE5LTA1LTE3LDEsMSwxLDIxLjYxNjU0MDM5Mjg2MDgsMSwxLjU1MjI0MTc2MDMwNjA2LDIuNzMxMDYzMDE4NTUyOTYsNDEuMTAwNzA3MDE1NDg4Myw0MS4xOTAyMTU5NjEwNzYzLDExMy45MDMzNDA3NDg1MTEsMTAxLjA4NTE4MjA5Nzc0LCJFbGl0ZSIsIkZyZXF1ZW50Ig0KNjI4Nyw5NjY1LDYzODIsMjAxOS0xMi0yNCwyMDE5LTEyLTI0LDEsMSwxLDQ3LjE2NTE4MDU5MzcyOSwxLDQuOTE3MDA2MzEyODY5NDksMS44NzY4MDQ2MzEyMDM0MSw0MS40ODk0MzUzOTMzNjMyLDQxLjE5ODExNDc5MzI4Miw3NS4zNzkwNjM2OTQyNzIyLDExMC4zMzk5NDQzMjUzODcsIkVsaXRlIiwiRnJlcXVlbnQiDQoyNjQ3LDc5NDUsMjg1MCwyMDE5LTA2LTExLDIwMTktMDYtMTEsMiwxLDEsMTcuNTU5MzY5MjE1NzQxOCwwLDIuNTMwMTE2NTg2OTQ1OTUsMi4wMDcxNDI5OTI2OTAyMSw0MC40NDk2NjIwNjAwMTEyLDQwLjExMjQwNTc5NjA2OTcsODYuMDEyMDk5OTIwNzcyLDc4LjQ4NDQ2NjMxNTcxMjgsIlBvb2wiLCJCYXNpYyINCjUxMjgsMTMxMSw0MDgwLDIwMTktMDUtMTUsMjAxOS0wNS0xNSwyLDEsMSwyNS40NTY3ODk0OTkxNDg3LDAsMi4zMDczNDM0NjI0ODIwOSwxLjE4MDk1MTk4NDU5OTIzLDQxLjkyMDQ3NTg5NjQ0NzksNDAuODAzNTc2NTcxODY2OSw5MS44NTUyNjA2Mjk2NzI2LDExNS45ODI0ODMzMzIwNDUsIlBvb2wiLCJGcmVxdWVudCINCjU1MDcsOTUyMiw1NjIyLDIwMTktMDgtMjgsMjAxOS0wOC0yOCwyLDEsMSwzMS4zNTcyNDYyMDg5MzYsMSwyLjc3MTc4ODMzNDQ3Mzk3LDEuNzU0NjMwMTk5NjMzNTQsNDEuMTQ3NDM5MTg4Nzg5Niw0MS45MDgwOTAxOTkzNDM5LDExMC4wNzA2Nzg5ODA1NTUsMTE1LjA2NzQyMjc2NzE3LCJTdGFuZGFyZCIsIkJhc2ljIg0KNTA5Miw3ODI0LDQxOTIsMjAxOS0xMC0wNiwyMDE5LTEwLTA2LDIsMSwxLDQwLjIxNTIzNjIzNzI3MjYsMCwxLjYyMzExMDk4NjMxNDcxLDQuODEwNzM3NzY0NDYyODMsNDAuOTg3ODIzNTAxNjk0OSw0MC4yMzgyMTc0NTI1NDEsODYuODMzMzk3MzYxOTE1Niw4My44NTU5NjQwMjY4Nzk1LCJTdGFuZGFyZCIsIkJhc2ljIg0K" download="extract_0014.csv">
  <button aria-label="There are 100 'fail' rows available as a CSV file." data-balloon-pos="left" style="background-color:#67C2DC;color:#FFFFFF;border:none;padding:5px;font-weight:bold;cursor:pointer;border-radius:4px;">CSV</button>
</a>
</div></td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="14"><span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin-left:10px;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;padding:2px 10px 2px 10px;">2023-10-12 20:31:46 CDT</span>
<span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;margin:5px 1px 5px 0;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;">1.9 s</span>
<span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 1px 5px -1px;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;">2023-10-12 20:31:48 CDT</span></td>
    </tr>
  </tfoot>
  
</table>
</div>
</div>
<p>In the example above, just 7 lines of portable table-agnostic code end up creating 14 data validation checks. The results catch two errors. Upon investigation, we might find that our geocoder is incorrectly flipping the sign on longitude!</p>
<p>One could also imagine writing a linter or validator of the variables names themselves to check for typos, outliers that don’t follow common stubs, etc.</p>
</section>
<section id="data-discoverability" class="level2">
<h2 class="anchored" data-anchor-id="data-discoverability">Data Discoverability</h2>
<p>On the user side, a controlled vocabulary makes new data easier to explore. Although is is not and should not be a replacement for a true data dictionary, imagine how relatively easy it is to understand the following variables’ intent and navigate either a searchable tab of visualization of the output.</p>
<p>To make some accessible outputs, we can first wrangle the column names into a table of their own.</p>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">cols_trips <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(data_trips)</span>
<span id="cb5-2">cols_trips_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(cols_trips, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb5-3">cols_components <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable =</span> cols_trips,</span>
<span id="cb5-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vapply</span>(cols_trips_split, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN.VALUE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">character</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb5-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vapply</span>(cols_trips_split, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN.VALUE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">character</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb5-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vapply</span>(cols_trips_split, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN.VALUE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">character</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-8">)</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(cols_components)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             variable level1 level2     level3
1           ID_DRIVER     ID DRIVER       &lt;NA&gt;
2            ID_RIDER     ID  RIDER       &lt;NA&gt;
3             ID_TRIP     ID   TRIP       &lt;NA&gt;
4             DT_ORIG     DT   ORIG       &lt;NA&gt;
5             DT_DEST     DT   DEST       &lt;NA&gt;
6 N_DRIVER_PASSENGERS      N DRIVER PASSENGERS</code></pre>
</div>
<p>Part of the metadata, then, could make it particularly easy to search by various stubs – whether that be the measure type (e.g.&nbsp;<code>N</code> or <code>AMT</code>) or the measure subject (e.g.&nbsp;<code>RIDER</code> or <code>DRIVER</code>).</p>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DT)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(cols_components,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'top'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clear =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span></code></pre></div>
<div class="cell-output-display">

<div id="htmlwidget-d01ef4a8316905a0a04b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d01ef4a8316905a0a04b">{"x":{"filter":"top","filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["ID_DRIVER","ID_RIDER","ID_TRIP","DT_ORIG","DT_DEST","N_DRIVER_PASSENGERS","N_TRIP_ORIG","N_TRIP_DEST","AMT_TRIP_DIST","IND_SURGE","VAL_DRIVER_RATING","VAL_RIDER_RATING","VAL_ORIG_LAT","VAL_DEST_LAT","VAL_ORIG_LON","VAL_DEST_LON","CAT_TRIP_TYPE","CAT_RIDER_TYPE"],["ID","ID","ID","DT","DT","N","N","N","AMT","IND","VAL","VAL","VAL","VAL","VAL","VAL","CAT","CAT"],["DRIVER","RIDER","TRIP","ORIG","DEST","DRIVER","TRIP","TRIP","TRIP","SURGE","DRIVER","RIDER","ORIG","DEST","ORIG","DEST","TRIP","RIDER"],[null,null,null,null,null,"PASSENGERS","ORIG","DEST","DIST",null,"RATING","RATING","LAT","LAT","LON","LON","TYPE","TYPE"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>variable<\/th>\n      <th>level1<\/th>\n      <th>level2<\/th>\n      <th>level3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}],"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<p>Similarly, we can use visualization to both validate and explore the available fields. Below, data fields are illustrated in a tree.</p>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(collapsibleTree)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collapsibleTree</span>(cols_components, </span>
<span id="cb8-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hierarchy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb8-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodeSize =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leafCount"</span></span>
<span id="cb8-5">                )</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-d7935c83d4241ebc745f" style="width:100%;height:464px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-d7935c83d4241ebc745f">{"x":{"data":{"name":"cols_components","SizeOfNode":29.8,"children":[{"name":"ID","SizeOfNode":12.17,"children":[{"name":"DRIVER","SizeOfNode":7.02},{"name":"RIDER","SizeOfNode":7.02},{"name":"TRIP","SizeOfNode":7.02}]},{"name":"DT","SizeOfNode":9.93,"children":[{"name":"ORIG","SizeOfNode":7.02},{"name":"DEST","SizeOfNode":7.02}]},{"name":"N","SizeOfNode":12.17,"children":[{"name":"DRIVER","SizeOfNode":7.02,"children":[{"name":"PASSENGERS","SizeOfNode":7.02}]},{"name":"TRIP","SizeOfNode":9.93,"children":[{"name":"ORIG","SizeOfNode":7.02},{"name":"DEST","SizeOfNode":7.02}]}]},{"name":"AMT","SizeOfNode":7.02,"children":[{"name":"TRIP","SizeOfNode":7.02,"children":[{"name":"DIST","SizeOfNode":7.02}]}]},{"name":"IND","SizeOfNode":7.02,"children":[{"name":"SURGE","SizeOfNode":7.02}]},{"name":"VAL","SizeOfNode":17.21,"children":[{"name":"DRIVER","SizeOfNode":7.02,"children":[{"name":"RATING","SizeOfNode":7.02}]},{"name":"RIDER","SizeOfNode":7.02,"children":[{"name":"RATING","SizeOfNode":7.02}]},{"name":"ORIG","SizeOfNode":9.93,"children":[{"name":"LAT","SizeOfNode":7.02},{"name":"LON","SizeOfNode":7.02}]},{"name":"DEST","SizeOfNode":9.93,"children":[{"name":"LAT","SizeOfNode":7.02},{"name":"LON","SizeOfNode":7.02}]}]},{"name":"CAT","SizeOfNode":9.93,"children":[{"name":"TRIP","SizeOfNode":7.02,"children":[{"name":"TYPE","SizeOfNode":7.02}]},{"name":"RIDER","SizeOfNode":7.02,"children":[{"name":"TYPE","SizeOfNode":7.02}]}]}]},"options":{"hierarchy":["level1","level2","level3"],"input":null,"attribute":"leafCount","linkLength":null,"fontSize":10,"tooltip":false,"collapsed":true,"zoomable":true,"margin":{"top":20,"bottom":20,"left":119.8,"right":75},"fill":"lightsteelblue"}},"evals":[],"jsHooks":[]}</script>
</div>
<p>Depending on the type of exploraion being done, it might be more convenient to drilldown first by measure subject. <code>collapsibleTree</code> flexibly lets us control this by specifying the <code>hierarchy</code>.</p>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collapsibleTree</span>(cols_components, </span>
<span id="cb9-2">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hierarchy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)),</span>
<span id="cb9-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodeSize =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leafCount"</span></span>
<span id="cb9-4">                )</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-c163542a71b37b3ea38c" style="width:100%;height:464px;" class="collapsibleTree html-widget"></div>
<script type="application/json" data-for="htmlwidget-c163542a71b37b3ea38c">{"x":{"data":{"name":"cols_components","SizeOfNode":24.33,"children":[{"name":"DRIVER","SizeOfNode":9.93,"children":[{"name":"ID","SizeOfNode":5.74},{"name":"N","SizeOfNode":5.74,"children":[{"name":"PASSENGERS","SizeOfNode":5.74}]},{"name":"VAL","SizeOfNode":5.74,"children":[{"name":"RATING","SizeOfNode":5.74}]}]},{"name":"RIDER","SizeOfNode":9.93,"children":[{"name":"ID","SizeOfNode":5.74},{"name":"VAL","SizeOfNode":5.74,"children":[{"name":"RATING","SizeOfNode":5.74}]},{"name":"CAT","SizeOfNode":5.74,"children":[{"name":"TYPE","SizeOfNode":5.74}]}]},{"name":"TRIP","SizeOfNode":12.83,"children":[{"name":"ID","SizeOfNode":5.74},{"name":"N","SizeOfNode":8.11,"children":[{"name":"ORIG","SizeOfNode":5.74},{"name":"DEST","SizeOfNode":5.74}]},{"name":"AMT","SizeOfNode":5.74,"children":[{"name":"DIST","SizeOfNode":5.74}]},{"name":"CAT","SizeOfNode":5.74,"children":[{"name":"TYPE","SizeOfNode":5.74}]}]},{"name":"ORIG","SizeOfNode":9.93,"children":[{"name":"DT","SizeOfNode":5.74},{"name":"VAL","SizeOfNode":8.11,"children":[{"name":"LAT","SizeOfNode":5.74},{"name":"LON","SizeOfNode":5.74}]}]},{"name":"DEST","SizeOfNode":9.93,"children":[{"name":"DT","SizeOfNode":5.74},{"name":"VAL","SizeOfNode":8.11,"children":[{"name":"LAT","SizeOfNode":5.74},{"name":"LON","SizeOfNode":5.74}]}]},{"name":"SURGE","SizeOfNode":5.74,"children":[{"name":"IND","SizeOfNode":5.74}]}]},"options":{"hierarchy":["level2","level1","level3"],"input":null,"attribute":"leafCount","linkLength":null,"fontSize":10,"tooltip":false,"collapsed":true,"zoomable":true,"margin":{"top":20,"bottom":20,"left":114.33,"right":75},"fill":"lightsteelblue"}},"evals":[],"jsHooks":[]}</script>
</div>
<p>These naming conventions are particularly friendly to a “passive search” via an IDE with autocomplete functionality. Simply typing “<code>N_</code>” and pausing or hitting tab might elicit a list of potential options of count variables in the data set.</p>
<p>More broadly, driving this standardization opens up interesting possibility for variable-first documentation. As our grammar for describing fields becomes richer and less ambiguous, it’s increasingly possible for users to explore a variable-first web of quantities and work their way back to the appropriate tables which contain them.</p>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h2>
<p>Controlled, hierarchical vocabularies also make basic data wrangling pipelines a breeze. By programming on the column names, we can appropriately summarize multiple pieces of data in the most relevant way.</p>
<p>For example, the following code uses <code>dplyr</code>’s “select helpers” to sum up count variables where we might reasonably be interested in the total and find the arithmetic average of indicator variables to help us calculate the proportion of occurrences of an event (here, the incidence of surge pricing).</p>
<p>Note what our controlled vocabulary and the implied “contracts” have given us. We aren’t summing up fields like latitude and longitude which would have no inherent meaning. Conversely, we can confidently calculate proportions which we couldn’t do if there was a chance our indicator variable contained nulls or occasionally used other numbers (e.g.&nbsp;<code>2</code>) to denote something like the surge severity instead of pure incidence.</p>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb10-2"></span>
<span id="cb10-3">data_trips <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(CAT_RIDER_TYPE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb10-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N_"</span>), sum),</span>
<span id="cb10-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND_"</span>), mean)</span>
<span id="cb10-8">  )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 5
  CAT_RIDER_TYPE N_DRIVER_PASSENGERS N_TRIP_ORIG N_TRIP_DEST IND_SURGE
  &lt;chr&gt;                        &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Basic                           57          38          38     0.395
2 Frequent                        42          31          31     0.548
3 Subscription                    45          31          31     0.645</code></pre>
</div>
</section>
<section id="addendum-on-other-languages" class="level2">
<h2 class="anchored" data-anchor-id="addendum-on-other-languages">Addendum on Other Languages</h2>
<p>The above examples use a few specific R packages with helpers that specifically operate on column names. However, the value of this approach is language agnostic since most popular languages for data manipulation support character pattern matching and wrangling operations specified by lists of variable names. We will conclude with a few examples.</p>
<section id="generating-sql" class="level3">
<h3 class="anchored" data-anchor-id="generating-sql">Generating SQL</h3>
<p>Although SQL is a hard language to “program on”, many programming-friendly tools offer SQL generators. For example, using <code>dbplyr</code>, we can use R to generate SQL code that sums up all of our count variables by rider type without having to type them out manually.</p>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dbplyr)</span>
<span id="cb12-2"></span>
<span id="cb12-3">df_mem <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memdb_frame</span>(data_trips, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"example_table"</span>)</span>
<span id="cb12-4"></span>
<span id="cb12-5">df_mem <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(CAT_RIDER_TYPE) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N_"</span>)), sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_query</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `CAT_RIDER_TYPE`, SUM(`N_DRIVER_PASSENGERS`) AS `N_DRIVER_PASSENGERS`, SUM(`N_TRIP_ORIG`) AS `N_TRIP_ORIG`, SUM(`N_TRIP_DEST`) AS `N_TRIP_DEST`
FROM `example_table`
GROUP BY `CAT_RIDER_TYPE`</code></pre>
</div>
</section>
<section id="r---base-data.table" class="level3">
<h3 class="anchored" data-anchor-id="r---base-data.table">R - <code>base</code> &amp; <code>data.table</code></h3>
<p>However, we aren’t of course limited just to <code>tidyverse</code> style coding. Similarly concise workflows exists in both <code>base</code> and <code>data.table</code> syntaxes. Suppose we wanted to summarize all numeric variables. First, we can use <code>base::grep</code> to find all column names that begin with <code>N_</code>.</p>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">cols_n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^N_"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(data_trips), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(cols_n)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "N_DRIVER_PASSENGERS" "N_TRIP_ORIG"         "N_TRIP_DEST"        </code></pre>
</div>
<p>We can define the variables we want to group by in another vector.</p>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">cols_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAT_RIDER_TYPE"</span>)</span></code></pre></div>
<p>These vectors can be used in aggregation operations such as <code>stats::aggregate</code>:</p>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aggregate</span>(data_trips[cols_n], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> data_trips[cols_grp], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FUN =</span> sum)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  CAT_RIDER_TYPE N_DRIVER_PASSENGERS N_TRIP_ORIG N_TRIP_DEST
1          Basic                  57          38          38
2       Frequent                  42          31          31
3   Subscription                  45          31          31</code></pre>
</div>
<p>Or with <code>data.table</code> syntax:</p>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb19-2">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.table</span>(data_trips)</span>
<span id="cb19-3">dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.SD, sum), by <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cols_grp, .SDcols <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cols_n]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   CAT_RIDER_TYPE N_DRIVER_PASSENGERS N_TRIP_ORIG N_TRIP_DEST
1:          Basic                  57          38          38
2:       Frequent                  42          31          31
3:   Subscription                  45          31          31</code></pre>
</div>
</section>
<section id="python-pandas" class="level3">
<h3 class="anchored" data-anchor-id="python-pandas">python <code>pandas</code></h3>
<p>Similarly, we can use list comprehensions in python to create a list of columns names matching a specific pattern (<code>cols_n</code>). This list and a list to define grouping variables can be passed to <code>pandas</code>’s data manipulation methods.</p>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb21-2">cols_n   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [vbl <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> vbl <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> data_trips.columns <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> vbl[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'N_'</span>]</span>
<span id="cb21-3">cols_grp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAT_RIDER_TYPE"</span>]</span>
<span id="cb21-4">data_trips.groupby(cols_grp)[cols_n].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                N_DRIVER_PASSENGERS  N_TRIP_ORIG  N_TRIP_DEST
CAT_RIDER_TYPE                                               
Basic                            57         38.0         38.0
Frequent                         42         31.0         31.0
Subscription                     45         31.0         31.0</code></pre>
</div>
</section>
</section>
<section id="updates" class="level2">
<h2 class="anchored" data-anchor-id="updates">Updates</h2>
<section id="concept-map" class="level3">
<h3 class="anchored" data-anchor-id="concept-map">Concept Map</h3>
<p>Thanks to Greg Wilson for helping illustrate the concepts from this post in a concept map:</p>
<p><img src="https://emilyriederer.com/post/column-name-contracts/concept-map.png" class="img-fluid"></p>
</section>
<section id="new-package-dec-2020" class="level3">
<h3 class="anchored" data-anchor-id="new-package-dec-2020">New Package (Dec 2020)</h3>
<p>Since writing this post, I have released the <a href="https://emilyriederer.github.io/convo/reference/index.html">convo</a> R package to facilitate maintenance and application of controlled vocabularies. Please check it out and let me know what you think!</p>
</section>
<section id="new-package-april-2021" class="level3">
<h3 class="anchored" data-anchor-id="new-package-april-2021">New Package (April 2021)</h3>
<p>I also released a dbt package called <a href="https://github.com/emilyriederer/dbtplyr">dbtplyr</a> to port <code>dplyr</code>’s useful select-helper semantics to SQL via <a href="http://getdbt.com/">dbt</a>.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Again, vocabularies should span a database – not just an individual dataset, but for simplicity we just talk through a smaller example.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>data</category>
  <category>workflow</category>
  <category>rstats</category>
  <guid>https://emilyriederer.com/post/column-name-contracts/index.html</guid>
  <pubDate>Sun, 06 Sep 2020 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/column-name-contracts/featured.png" medium="image" type="image/png" height="152" width="144"/>
</item>
<item>
  <title>R Markdown Cookbook</title>
  <link>https://emilyriederer.com/publication/rmarkdown-cookbook/index.html</link>
  <description><![CDATA[ 






 ]]></description>
  <category>rmarkdown</category>
  <category>rstats</category>
  <guid>https://emilyriederer.com/publication/rmarkdown-cookbook/index.html</guid>
  <pubDate>Tue, 01 Sep 2020 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/publication/rmarkdown-cookbook/featured.PNG" medium="image"/>
</item>
<item>
  <title>A beginner’s guide to Shiny modules</title>
  <dc:creator>Emily Riederer</dc:creator>
  <link>https://emilyriederer.com/post/shiny-modules/index.html</link>
  <description><![CDATA[ 




<p>Recently, I argued the case on Twitter that Shiny modules are not an advanced topic and can actually be a great way for novice Shiny developers to start building more complex applications.</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
My Shiny hot take is that modules are <strong>not</strong> an advanced topic. IMHO it’s so much easier and more natural for <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> users to write small, modular functions that they can independently play with and test than huge monolithic apps (1/3)
</p>
— Emily Riederer (<span class="citation" data-cites="EmilyRiederer">@EmilyRiederer</span>) <a href="https://twitter.com/EmilyRiederer/status/1286072799463911424?ref_src=twsrc%5Etfw">July 22, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>The good people of <a href="https://twitter.com/search?q=%23rstats">#rstats Twitter</a> helped me refine this thesis a bit with a few key caveats. If you already are an R user who likes to <strong>think and write functions</strong> and <strong>understand Shiny basics</strong> (i.e.&nbsp;the basics of reactivity come first no matter what), then modules <strong>for certain types of tasks</strong> (discussed at the end of this post) are an excellent way to up your game.</p>
<p>In fact, when I first tried to learn Shiny, the monolithic scripts and <em>lack</em> of function-based thinking in introductory materials was something that really tripped me up because it felt so unlike normal R programming. So, not only is it <em>possible</em> to learn modules early, it may actually be decidedly easier than the alternative depending on your frame of mind.</p>
<p>In this post, I walk through a toy example of building a reporting app from the <code>flights</code> data in the <code>nycflights13</code> package to demonstrate how modules help scale basic Shiny skills. The recurring theme we will discuss are that modules help novice developers:</p>
<ul>
<li>focus on smaller, narrower tasks at a time</li>
<li>test out and experiment with small pieces in isolation for easier debugging</li>
<li>avoid massively nested blocks of code that can arise in Shiny app development</li>
</ul>
<p>In effect, I aim to demonstrate a workflow and encourage use of modules for newer Shiny users. I do not aim to <em>teach</em> Shiny or module development itself, persay. For that, I recommend the <a href="https://shiny.rstudio.com/">Shiny documentation</a> and Hadley Wickham’s <a href="https://mastering-shiny.org/">Mastering Shiny book</a>.</p>
<section id="why-modules" class="level2">
<h2 class="anchored" data-anchor-id="why-modules">Why Modules?</h2>
<p>In effect, you can think of modules as the “function-ization” of a set of Shiny UI and server elements. You may wonder why you cannot just accomplish this with the normal functions as you use in other R programming. The reason for this is a bit more technical. If you are interested, it is explained well in <em>Mastering Shiny</em>. However, I believe that it’s only the “why functions won’t work” part of Shiny modules that make them appear to be an advanced topic. If you see the value of writing functions, you are more than ready to take advantage of modules in app development.</p>
</section>
<section id="motivating-example" class="level2">
<h2 class="anchored" data-anchor-id="motivating-example">Motivating Example</h2>
<p>For the sake of argument, let’s pretend that we work for an airline and are tasked with building a basic dashboard to track various measures of travel delays against preset thresholds. We have the following requirements:</p>
<ul>
<li>Let users pick a month of interest to visualize</li>
<li>For each<sup>1</sup> metric of interest, users should:
<ul>
<li>See a time-series plot of the average daily value of the metric</li>
<li>Click a download button to download a PNG of the plot</li>
<li>Read a text summary that reports the number of days the value breached the threshold</li>
</ul></li>
<li>The metrics of interest are:
<ul>
<li>Average departure delay</li>
<li>Average arrival delay</li>
<li>Proportion of daily flights with an arrival delay exceeding 5 minutes</li>
</ul></li>
</ul>
<p>The completed application is hosted <a href="https://emilyriederer.shinyapps.io/shiny-modules-demo/">here, on shinyapps.io,</a><sup>2</sup> and the underlying code can be read <a href="https://github.com/emilyriederer/demo-shiny-modules">on GitHub</a>.</p>
<p>Below is a preview of the final application. It isn’t going to win any beauty contests; I kept the layout and styling to a minimum so we could focus on modules in the code.</p>
<p><img src="https://emilyriederer.com/post/shiny-modules/app-photo.PNG" class="img-fluid"></p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set-Up</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(shiny)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(nycflights13)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span></code></pre></div>
</div>
<p>For any of the explanation below to make sense, it will help to familiarize yourself with the data. We filter the <code>flights</code> data down to a single airline and aggregate the results by day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">ua_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-2">  nycflights13<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>flights <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(carrier <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UA"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ind_arr_delay =</span> (arr_delay <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year, month, day) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb2-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb2-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delay"</span>), mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-9">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(ua_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 7
   year month   day     n dep_delay arr_delay ind_arr_delay
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1  2013     1     1   165      7.65     6.27          0.476
2  2013     1     2   170     12.8      7.04          0.458
3  2013     1     3   159      8.66    -2.76          0.357
4  2013     1     4   161      6.84    -9.86          0.180
5  2013     1     5   117      9.66     0.786         0.274
6  2013     1     6   137      9.79     3.53          0.409</code></pre>
</div>
</div>
<p>I’ve also defined the plotting function that we will want to visualize a month-long timeseries of data for each metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">viz_monthly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, y_var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshhold =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) {</span>
<span id="cb4-2">  </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>]],</span>
<span id="cb4-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[y_var]]</span>
<span id="cb4-7">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> threshhold, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span>
<span id="cb4-12">}</span></code></pre></div>
</div>
<p>For example, to visualize the average arrival delay by day for all of March and compare it to a threshhold of 10 minutes, we can write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">ua_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(month <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viz_monthly</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshhold =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://emilyriederer.com/post/shiny-modules/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="one-module-at-a-time" class="level2">
<h2 class="anchored" data-anchor-id="one-module-at-a-time">One Module at a Time</h2>
<p>Modules don’t just help organize your code; they help you organize your <em>thinking</em>. Given our list of requirements, it might feel overwhelming where to start. Filtering the data? Making the plots? Wiring up buttons? Inevitably, when juggling 10+ components (the reactive dataset plus a plot, button, and text summary for each of three metrics), you’re likely to introduce a bug by copy-pasting a line with the wrong <code>id</code> or getting nested parentheses out of whack.</p>
<p>Instead, modules essentially allow your to write <em>many simple Shiny apps</em> and compose them together.</p>
<p>For example, we might decide that first we just want to focus on a very simple app: given a monhthly subset of the data, a metric, and a threshold of interest. Let’s write a simple text summary of the flights performance. This task seems relatively straightforward. We now know we just need to define a UI (<code>text_ui</code>) with a single call to <code>textOutput()</code>, a server (<code>text_server</code>) that does a single calculation and calls <code>renderText()</code>. Best of all, we can immediately see whether or not our “app” works by writing a minimalistic testing function (<code>text_demo</code>) which renders the text for a small, fake dataset.<sup>3</sup></p>
<p>I saved the follow in a file called <code>mod-test.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># text module ----</span></span>
<span id="cb6-2">text_ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(id) {</span>
<span id="cb6-3">  </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(</span>
<span id="cb6-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">textOutput</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>))</span>
<span id="cb6-6">  )</span>
<span id="cb6-7">  </span>
<span id="cb6-8">}</span>
<span id="cb6-9"></span>
<span id="cb6-10">text_server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(id, df, vbl, threshhold) {</span>
<span id="cb6-11">  </span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moduleServer</span>(id, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb6-13">    </span>
<span id="cb6-14">    n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">df</span>()[[vbl]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> threshhold)})</span>
<span id="cb6-15">    output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderText</span>({</span>
<span id="cb6-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"In this month"</span>, </span>
<span id="cb6-17">            vbl, </span>
<span id="cb6-18">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exceeded the average daily threshhold of"</span>,</span>
<span id="cb6-19">            threshhold,</span>
<span id="cb6-20">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a total of"</span>, </span>
<span id="cb6-21">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), </span>
<span id="cb6-22">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>)</span>
<span id="cb6-23">    })</span>
<span id="cb6-24">    </span>
<span id="cb6-25">  })</span>
<span id="cb6-26">  </span>
<span id="cb6-27">}</span>
<span id="cb6-28"></span>
<span id="cb6-29">text_demo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb6-30">  </span>
<span id="cb6-31">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arr_delay =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb6-32">  ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text_ui</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>))</span>
<span id="cb6-33">  server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb6-34">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({df}), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb6-35">  }</span>
<span id="cb6-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyApp</span>(ui, server)</span>
<span id="cb6-37">  </span>
<span id="cb6-38">}</span></code></pre></div>
</div>
<p>We can follow the same pattern to create a module for the plot itself consisting of a UI (<code>plot_ui</code>), a server (<code>plot_server</code>), and a testing function (<code>plot_demo</code>). This module is responsible for showing the plot of a single metric and enabling users to download it. You can see this code on GitHub in the file <a href="https://github.com/emilyriederer/demo-shiny-modules/blob/master/mod-plot.R"><code>mod-plot.R</code></a>:</p>
<p>Once again, we can run that self-contained file and then execute <code>plot_demo()</code> to run our mini-application. This time, it is more interactive. We can click the “Download” button and ensure that our download feature is working.</p>
<p>We don’t have an application yet, but we have two components that build pretty easily off of our basic Shiny knowledge and that we can see working before our eyes<sup>4</sup>.</p>
<section id="composing-modules" class="level3">
<h3 class="anchored" data-anchor-id="composing-modules">Composing Modules</h3>
<p>We now have a text module and a plot module. However, recall for each metric of interest, we want to produce <em>both</em>. We could do this by simply calling these two modules one after the other in our final app, but if we want to, we can create another module that wraps our first two modules so that we can produce in single commands everything that we need for a given metric.</p>
<p>With all of the underlying plot and text module logic abstracted, our metric module definition is very clean and simple. I define it in the <code>mod-metr.R</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># metric module ----</span></span>
<span id="cb7-2">metric_ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(id) {</span>
<span id="cb7-3">  </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(</span>
<span id="cb7-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text_ui</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>)),</span>
<span id="cb7-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_ui</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>))</span>
<span id="cb7-7">  )</span>
<span id="cb7-8">  </span>
<span id="cb7-9">}</span>
<span id="cb7-10"></span>
<span id="cb7-11">metric_server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(id, df, vbl, threshhold) {</span>
<span id="cb7-12">  </span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moduleServer</span>(id, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb7-14">    </span>
<span id="cb7-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>, df, vbl, threshhold)</span>
<span id="cb7-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>, df, vbl, threshhold)</span>
<span id="cb7-17">    </span>
<span id="cb7-18">  })</span>
<span id="cb7-19">  </span>
<span id="cb7-20">}</span>
<span id="cb7-21"></span>
<span id="cb7-22">metric_demo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb7-23">  </span>
<span id="cb7-24">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arr_delay =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb7-25">  ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_ui</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>))</span>
<span id="cb7-26">  server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb7-27">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({df}), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb7-28">  }</span>
<span id="cb7-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyApp</span>(ui, server)</span>
<span id="cb7-30">  </span>
<span id="cb7-31">}</span></code></pre></div>
</div>
<p>Again, we can test that these components went together as we intended by running the <code>metric_demo()</code> function. We will see the text from our text module on top of the plot and button from our plot module. Here’s what our module looks like so far:</p>
<p><img src="https://emilyriederer.com/post/shiny-modules/mod-demo.PNG" class="img-fluid"></p>
<p>For this app, this might seem like overkill, but I wanted to illustrate the ability to compose modules because it’s very useful as your application grows in complexity. In essence, everything you bundle into a module gives you a license to forget about how the next layer lower is implemented and frees up your mind to take on the next challenge.</p>
</section>
<section id="putting-it-all-together" class="level3">
<h3 class="anchored" data-anchor-id="putting-it-all-together">Putting it all together</h3>
<p>Finally, we are ready to write our complete application in a file called <code>flights-app.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load libraries ----</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(nycflights13)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(shiny)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load resources ----</span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viz-mtly.R"</span>)</span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod-plot.R"</span>)</span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod-text.R"</span>)</span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod-metr.R"</span>)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data prep ----</span></span>
<span id="cb8-14">ua_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb8-15">  nycflights13<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>flights <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(carrier <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UA"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ind_arr_delay =</span> (arr_delay <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year, month, day) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb8-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb8-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delay"</span>), mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-22">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb8-24"></span>
<span id="cb8-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># full application ----</span></span>
<span id="cb8-26">ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb8-27">  </span>
<span id="cb8-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">titlePanel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flight Delay Report"</span>),</span>
<span id="cb8-29">  </span>
<span id="cb8-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sidebarLayout</span>(</span>
<span id="cb8-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sidebarPanel =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sidebarPanel</span>(</span>
<span id="cb8-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selectInput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Month"</span>, </span>
<span id="cb8-33">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, month.abb),</span>
<span id="cb8-34">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selected =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-35">    )</span>
<span id="cb8-36">  ),</span>
<span id="cb8-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mainPanel =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mainPanel</span>(</span>
<span id="cb8-38">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">h2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">textOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>)),</span>
<span id="cb8-39">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">h3</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average Departure Delay"</span>),</span>
<span id="cb8-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_ui</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dep_delay"</span>),</span>
<span id="cb8-41">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">h3</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average Arrival Delay"</span>),</span>
<span id="cb8-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_ui</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>),</span>
<span id="cb8-43">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">h3</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion Flights with &gt;5 Min Arrival Delay"</span>),</span>
<span id="cb8-44">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_ui</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ind_arr_delay"</span>)</span>
<span id="cb8-45">  )</span>
<span id="cb8-46">)</span>
<span id="cb8-47">)</span>
<span id="cb8-48"></span>
<span id="cb8-49">server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb8-50">  </span>
<span id="cb8-51">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>title <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderText</span>({<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(month.abb[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>month)], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Report"</span>)})</span>
<span id="cb8-52">  df_month <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ua_data, month <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>month)})</span>
<span id="cb8-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dep_delay"</span>, df_month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbl =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dep_delay"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshhold =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb8-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>, df_month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbl =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arr_delay"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshhold =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb8-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_server</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ind_arr_delay"</span>, df_month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbl =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ind_arr_delay"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshhold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb8-56">  </span>
<span id="cb8-57">}</span>
<span id="cb8-58"></span>
<span id="cb8-59"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<p>Notice how few lines of code this file requires to create all of our various components and interactions! We’ve eliminated much of the dense code, nesting, and potential duplication we might have encountered if trying to write our application without modules. Whether you were trying to maintain this app or reading someone else’s code, the top-level code is accessible, semantic, and declarative. We can fairly easily infer the intent of each line and note which pieces of UI and server logic are responsible for which components.</p>
<p>Additionally, we also have all of the typical benefits afforded by functions. For example, if we were asked to change the plot download feature to download an <code>.svg</code> file instead of a <code>.png</code>, we could make a single change to the <code>plot_server()</code> function instead of having to change many pieces of our code for each metric.</p>
</section>
<section id="caveats" class="level3">
<h3 class="anchored" data-anchor-id="caveats">Caveats</h3>
<p>Not all modules are made alike, and in this walk-through I intentionally chose relatively easy pieces of logic to demonstrate. Note that our modules <em>consume</em> a reactive variable (data) from the global environment, but they themselves do not attempt to <em>alter</em> the global environment or <em>exchange</em> information between them. Both of those things are also very possible to do with modules, but they may feel a bit harder or more error prone at first. In my opinion, modules that simply consume reactives are the easiest way to start out.</p>
<p>I also intentionally did not discuss more advanced features of modules or more formal and automated testing of them. These topics are covered in both <a href="http://mastering-shiny.org/"><em>Mastering Shiny</em></a> and <a href="https://engineering-shiny.org/"><em>Engineering Production Grade Shiny Apps</em></a>. These books also introduce ways to share modules via R packages and to organize them in Shiny app projects built with the excellent <a href="https://cran.r-project.org/web/packages/golem/index.html"><code>golem</code> package</a> (the <code>usethis</code> of Shiny apps).</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>In the spirit of “don’t repeat yourself”, any time you have the phrase “for each” in your requirements, it’s a strong signal that modules might make your work a good bit easier.↩︎</p></li>
<li id="fn2"><p>If I stop hosting the app in the future and this link does not work, the easiest way to run the app is by going to the repo, copying the code in the file <code>flights-app-single-file.R</code> and running it locally.↩︎</p></li>
<li id="fn3"><p>In <em>Mastering Shiny</em>, Hadley points out its a good practice to always include such a demo function for testing: https://mastering-shiny.org/scaling-modules.html#updated-app↩︎</p></li>
<li id="fn4"><p>Of course, “working for one use case” is not a substitute for real testing, but that’s out of scope for this post↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>shiny</category>
  <category>rstats</category>
  <category>workflow</category>
  <category>tutorial</category>
  <guid>https://emilyriederer.com/post/shiny-modules/index.html</guid>
  <pubDate>Sun, 26 Jul 2020 05:00:00 GMT</pubDate>
  <media:content url="https://emilyriederer.com/post/shiny-modules/featured.png" medium="image" type="image/png" height="65" width="144"/>
</item>
</channel>
</rss>
